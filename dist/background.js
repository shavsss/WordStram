(()=>{"use strict";var e={};e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}();function t(e){return"iw"===e||"he-IL"===e?"he":"in"===e?"id":"jw"===e?"jv":e||"auto"}const n="AIzaSyCLBHKWu7l78tS2xVmizicObSb0PpUqsxM",r="gemini-pro-latest",s="gemini-1.5-pro",i="gemini-1.5-flash";const o=function(e){const t=[];let n=0;for(let r=0;r<e.length;r++){let s=e.charCodeAt(r);s<128?t[n++]=s:s<2048?(t[n++]=s>>6|192,t[n++]=63&s|128):55296==(64512&s)&&r+1<e.length&&56320==(64512&e.charCodeAt(r+1))?(s=65536+((1023&s)<<10)+(1023&e.charCodeAt(++r)),t[n++]=s>>18|240,t[n++]=s>>12&63|128,t[n++]=s>>6&63|128,t[n++]=63&s|128):(t[n++]=s>>12|224,t[n++]=s>>6&63|128,t[n++]=63&s|128)}return t},a={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let t=0;t<e.length;t+=3){const s=e[t],i=t+1<e.length,o=i?e[t+1]:0,a=t+2<e.length,c=a?e[t+2]:0,u=s>>2,l=(3&s)<<4|o>>4;let h=(15&o)<<2|c>>6,d=63&c;a||(d=64,i||(h=64)),r.push(n[u],n[l],n[h],n[d])}return r.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(o(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,r=0;for(;n<e.length;){const s=e[n++];if(s<128)t[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=e[n++];t[r++]=String.fromCharCode((31&s)<<6|63&i)}else if(s>239&&s<365){const i=((7&s)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[r++]=String.fromCharCode(55296+(i>>10)),t[r++]=String.fromCharCode(56320+(1023&i))}else{const i=e[n++],o=e[n++];t[r++]=String.fromCharCode((15&s)<<12|(63&i)<<6|63&o)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let t=0;t<e.length;){const s=n[e.charAt(t++)],i=t<e.length?n[e.charAt(t)]:0;++t;const o=t<e.length?n[e.charAt(t)]:64;++t;const a=t<e.length?n[e.charAt(t)]:64;if(++t,null==s||null==i||null==o||null==a)throw new c;const u=s<<2|i>>4;if(r.push(u),64!==o){const e=i<<4&240|o>>2;if(r.push(e),64!==a){const e=o<<6&192|a;r.push(e)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class c extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const u=function(e){return function(e){const t=o(e);return a.encodeByteArray(t,!0)}(e).replace(/\./g,"")},l=function(e){try{return a.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};const h=()=>function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==e.g)return e.g;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__,d=()=>{try{return h()||(()=>{const e={}.__FIREBASE_DEFAULTS__;if(e)return JSON.parse(e)})()||(()=>{if("undefined"==typeof document)return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}const t=e&&l(e[1]);return t&&JSON.parse(t)})()}catch(e){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`)}},f=e=>{var t,n;return null===(n=null===(t=d())||void 0===t?void 0:t.emulatorHosts)||void 0===n?void 0:n[e]},p=()=>{var e;return null===(e=d())||void 0===e?void 0:e.config},g=e=>{var t;return null===(t=d())||void 0===t?void 0:t[`_${e}`]};class m{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"==typeof e&&(this.promise.catch((()=>{})),1===e.length?e(t):e(t,n))}}}function y(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function v(){return!function(){var t;const n=null===(t=d())||void 0===t?void 0:t.forceEnvironment;if("node"===n)return!0;if("browser"===n)return!1;try{return"[object process]"===Object.prototype.toString.call(e.g.process)}catch(e){return!1}}()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function w(){try{return"object"==typeof indexedDB}catch(e){return!1}}class _ extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,_.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,E.prototype.create)}}class E{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){const n=t[0]||{},r=`${this.service}/${e}`,s=this.errors[e],i=s?function(e,t){return e.replace(I,((e,n)=>{const r=t[n];return null!=r?String(r):`<${n}?>`}))}(s,n):"Error",o=`${this.serviceName}: ${i} (${r}).`;return new _(r,o,n)}}const I=/\{\$([^}]+)}/g;function S(e,t){if(e===t)return!0;const n=Object.keys(e),r=Object.keys(t);for(const s of n){if(!r.includes(s))return!1;const n=e[s],i=t[s];if(b(n)&&b(i)){if(!S(n,i))return!1}else if(n!==i)return!1}for(const e of r)if(!n.includes(e))return!1;return!0}function b(e){return null!==e&&"object"==typeof e}function T(e){const t=[];for(const[n,r]of Object.entries(e))Array.isArray(r)?r.forEach((e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))})):t.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return t.length?"&"+t.join("&"):""}function A(e){const t={};return e.replace(/^\?/,"").split("&").forEach((e=>{if(e){const[n,r]=e.split("=");t[decodeURIComponent(n)]=decodeURIComponent(r)}})),t}function C(e){const t=e.indexOf("?");if(!t)return"";const n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)}class k{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then((()=>{e(this)})).catch((e=>{this.error(e)}))}next(e){this.forEachObserver((t=>{t.next(e)}))}error(e){this.forEachObserver((t=>{t.error(e)})),this.close(e)}complete(){this.forEachObserver((e=>{e.complete()})),this.close()}subscribe(e,t,n){let r;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");r=function(e,t){if("object"!=typeof e||null===e)return!1;for(const n of t)if(n in e&&"function"==typeof e[n])return!0;return!1}(e,["next","error","complete"])?e:{next:e,error:t,complete:n},void 0===r.next&&(r.next=N),void 0===r.error&&(r.error=N),void 0===r.complete&&(r.complete=N);const s=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then((()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch(e){}})),this.observers.push(r),s}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then((()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}}))}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then((()=>{this.observers=void 0,this.onNoObservers=void 0})))}}function N(){}function D(e){return e&&e._delegate?e._delegate:e}class R{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const O="[DEFAULT]";class P{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new m;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const n=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),r=null!==(t=null==e?void 0:e.optional)&&void 0!==t&&t;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(r)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(e){if(r)return null;throw e}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:O})}catch(e){}for(const[e,t]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:n});t.resolve(e)}catch(e){}}}}clearInstance(e=O){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter((e=>"INTERNAL"in e)).map((e=>e.INTERNAL.delete())),...e.filter((e=>"_delete"in e)).map((e=>e._delete()))])}isComponentSet(){return null!=this.component}isInitialized(e=O){return this.instances.has(e)}getOptions(e=O){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[e,t]of this.instancesDeferred.entries()){n===this.normalizeInstanceIdentifier(e)&&t.resolve(r)}return r}onInit(e,t){var n;const r=this.normalizeInstanceIdentifier(t),s=null!==(n=this.onInitCallbacks.get(r))&&void 0!==n?n:new Set;s.add(e),this.onInitCallbacks.set(r,s);const i=this.instances.get(r);return i&&e(i,r),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const r of n)try{r(e,t)}catch(e){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(r=e,r===O?void 0:r),options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch(e){}var r;return n||null}normalizeInstanceIdentifier(e=O){return this.component?this.component.multipleInstances?e:O:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class L{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new P(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}const M=[];var x;!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(x||(x={}));const U={debug:x.DEBUG,verbose:x.VERBOSE,info:x.INFO,warn:x.WARN,error:x.ERROR,silent:x.SILENT},F=x.INFO,V={[x.DEBUG]:"log",[x.VERBOSE]:"log",[x.INFO]:"info",[x.WARN]:"warn",[x.ERROR]:"error"},W=(e,t,...n)=>{if(t<e.logLevel)return;const r=(new Date).toISOString(),s=V[t];if(!s)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);console[s](`[${r}]  ${e.name}:`,...n)};class j{constructor(e){this.name=e,this._logLevel=F,this._logHandler=W,this._userLogHandler=null,M.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in x))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?U[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,x.DEBUG,...e),this._logHandler(this,x.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,x.VERBOSE,...e),this._logHandler(this,x.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,x.INFO,...e),this._logHandler(this,x.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,x.WARN,...e),this._logHandler(this,x.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,x.ERROR,...e),this._logHandler(this,x.ERROR,...e)}}let $,B;const q=new WeakMap,z=new WeakMap,H=new WeakMap,G=new WeakMap,K=new WeakMap;let Q={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return z.get(e);if("objectStoreNames"===t)return e.objectStoreNames||H.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return X(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function J(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(B||(B=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(Z(this),t),X(q.get(this))}:function(...t){return X(e.apply(Z(this),t))}:function(t,...n){const r=e.call(Z(this),t,...n);return H.set(r,t.sort?t.sort():[t]),X(r)}}function Y(e){return"function"==typeof e?J(e):(e instanceof IDBTransaction&&function(e){if(z.has(e))return;const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("complete",s),e.removeEventListener("error",i),e.removeEventListener("abort",i)},s=()=>{t(),r()},i=()=>{n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",s),e.addEventListener("error",i),e.addEventListener("abort",i)}));z.set(e,t)}(e),t=e,($||($=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some((e=>t instanceof e))?new Proxy(e,Q):e);var t}function X(e){if(e instanceof IDBRequest)return function(e){const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("success",s),e.removeEventListener("error",i)},s=()=>{t(X(e.result)),r()},i=()=>{n(e.error),r()};e.addEventListener("success",s),e.addEventListener("error",i)}));return t.then((t=>{t instanceof IDBCursor&&q.set(t,e)})).catch((()=>{})),K.set(t,e),t}(e);if(G.has(e))return G.get(e);const t=Y(e);return t!==e&&(G.set(e,t),K.set(t,e)),t}const Z=e=>K.get(e);const ee=["get","getKey","getAll","getAllKeys","count"],te=["put","add","delete","clear"],ne=new Map;function re(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(ne.get(t))return ne.get(t);const n=t.replace(/FromIndex$/,""),r=t!==n,s=te.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!s&&!ee.includes(n))return;const i=async function(e,...t){const i=this.transaction(e,s?"readwrite":"readonly");let o=i.store;return r&&(o=o.index(t.shift())),(await Promise.all([o[n](...t),s&&i.done]))[0]};return ne.set(t,i),i}Q=(e=>({...e,get:(t,n,r)=>re(t,n)||e.get(t,n,r),has:(t,n)=>!!re(t,n)||e.has(t,n)}))(Q);class se{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map((e=>{if(function(e){const t=e.getComponent();return"VERSION"===(null==t?void 0:t.type)}(e)){const t=e.getImmediate();return`${t.library}/${t.version}`}return null})).filter((e=>e)).join(" ")}}const ie="@firebase/app",oe="0.11.3",ae=new j("@firebase/app"),ce="@firebase/app-compat",ue="@firebase/analytics-compat",le="@firebase/analytics",he="@firebase/app-check-compat",de="@firebase/app-check",fe="@firebase/auth",pe="@firebase/auth-compat",ge="@firebase/database",me="@firebase/data-connect",ye="@firebase/database-compat",ve="@firebase/functions",we="@firebase/functions-compat",_e="@firebase/installations",Ee="@firebase/installations-compat",Ie="@firebase/messaging",Se="@firebase/messaging-compat",be="@firebase/performance",Te="@firebase/performance-compat",Ae="@firebase/remote-config",Ce="@firebase/remote-config-compat",ke="@firebase/storage",Ne="@firebase/storage-compat",De="@firebase/firestore",Re="@firebase/vertexai",Oe="@firebase/firestore-compat",Pe="firebase",Le="[DEFAULT]",Me={[ie]:"fire-core",[ce]:"fire-core-compat",[le]:"fire-analytics",[ue]:"fire-analytics-compat",[de]:"fire-app-check",[he]:"fire-app-check-compat",[fe]:"fire-auth",[pe]:"fire-auth-compat",[ge]:"fire-rtdb",[me]:"fire-data-connect",[ye]:"fire-rtdb-compat",[ve]:"fire-fn",[we]:"fire-fn-compat",[_e]:"fire-iid",[Ee]:"fire-iid-compat",[Ie]:"fire-fcm",[Se]:"fire-fcm-compat",[be]:"fire-perf",[Te]:"fire-perf-compat",[Ae]:"fire-rc",[Ce]:"fire-rc-compat",[ke]:"fire-gcs",[Ne]:"fire-gcs-compat",[De]:"fire-fst",[Oe]:"fire-fst-compat",[Re]:"fire-vertex","fire-js":"fire-js",[Pe]:"fire-js-all"},xe=new Map,Ue=new Map,Fe=new Map;function Ve(e,t){try{e.container.addComponent(t)}catch(n){ae.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function We(e){const t=e.name;if(Fe.has(t))return ae.debug(`There were multiple attempts to register component ${t}.`),!1;Fe.set(t,e);for(const t of xe.values())Ve(t,e);for(const t of Ue.values())Ve(t,e);return!0}function je(e,t){const n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}function $e(e){return null!=e&&void 0!==e.settings}const Be=new E("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class qe{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new R("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Be.create("app-deleted",{appName:this._name})}}const ze="11.5.0";function He(e,t={}){let n=e;if("object"!=typeof t){t={name:t}}const r=Object.assign({name:Le,automaticDataCollectionEnabled:!1},t),s=r.name;if("string"!=typeof s||!s)throw Be.create("bad-app-name",{appName:String(s)});if(n||(n=p()),!n)throw Be.create("no-options");const i=xe.get(s);if(i){if(S(n,i.options)&&S(r,i.config))return i;throw Be.create("duplicate-app",{appName:s})}const o=new L(s);for(const e of Fe.values())o.addComponent(e);const a=new qe(n,r,o);return xe.set(s,a),a}function Ge(e=Le){const t=xe.get(e);if(!t&&e===Le&&p())return He();if(!t)throw Be.create("no-app",{appName:e});return t}function Ke(e,t,n){var r;let s=null!==(r=Me[e])&&void 0!==r?r:e;n&&(s+=`-${n}`);const i=s.match(/\s|\//),o=t.match(/\s|\//);if(i||o){const e=[`Unable to register library "${s}" with version "${t}":`];return i&&e.push(`library name "${s}" contains illegal characters (whitespace or "/")`),i&&o&&e.push("and"),o&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),void ae.warn(e.join(" "))}We(new R(`${s}-version`,(()=>({library:s,version:t})),"VERSION"))}const Qe="firebase-heartbeat-store";let Je=null;function Ye(){return Je||(Je=function(e,t,{blocked:n,upgrade:r,blocking:s,terminated:i}={}){const o=indexedDB.open(e,t),a=X(o);return r&&o.addEventListener("upgradeneeded",(e=>{r(X(o.result),e.oldVersion,e.newVersion,X(o.transaction),e)})),n&&o.addEventListener("blocked",(e=>n(e.oldVersion,e.newVersion,e))),a.then((e=>{i&&e.addEventListener("close",(()=>i())),s&&e.addEventListener("versionchange",(e=>s(e.oldVersion,e.newVersion,e)))})).catch((()=>{})),a}("firebase-heartbeat-database",1,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(Qe)}catch(e){console.warn(e)}}}).catch((e=>{throw Be.create("idb-open",{originalErrorMessage:e.message})}))),Je}async function Xe(e,t){try{const n=(await Ye()).transaction(Qe,"readwrite"),r=n.objectStore(Qe);await r.put(t,Ze(e)),await n.done}catch(e){if(e instanceof _)ae.warn(e.message);else{const t=Be.create("idb-set",{originalErrorMessage:null==e?void 0:e.message});ae.warn(t.message)}}}function Ze(e){return`${e.name}!${e.options.appId}`}class et{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new nt(t),this._heartbeatsCachePromise=this._storage.read().then((e=>(this._heartbeatsCache=e,e)))}async triggerHeartbeat(){var e,t;try{const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=tt();if(null==(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)&&(this._heartbeatsCache=await this._heartbeatsCachePromise,null==(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)))return;if(this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some((e=>e.date===r)))return;if(this._heartbeatsCache.heartbeats.push({date:r,agent:n}),this._heartbeatsCache.heartbeats.length>30){const e=function(e){if(0===e.length)return-1;let t=0,n=e[0].date;for(let r=1;r<e.length;r++)e[r].date<n&&(n=e[r].date,t=r);return t}(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(e,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){ae.warn(e)}}async getHeartbeatsHeader(){var e;try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null==(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)||0===this._heartbeatsCache.heartbeats.length)return"";const t=tt(),{heartbeatsToSend:n,unsentEntries:r}=function(e,t=1024){const n=[];let r=e.slice();for(const s of e){const e=n.find((e=>e.agent===s.agent));if(e){if(e.dates.push(s.date),rt(n)>t){e.dates.pop();break}}else if(n.push({agent:s.agent,dates:[s.date]}),rt(n)>t){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}(this._heartbeatsCache.heartbeats),s=u(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=t,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(e){return ae.warn(e),""}}}function tt(){return(new Date).toISOString().substring(0,10)}class nt{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!w()&&new Promise(((e,t)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),n||self.indexedDB.deleteDatabase(r),e(!0)},s.onupgradeneeded=()=>{n=!1},s.onerror=()=>{var e;t((null===(e=s.error)||void 0===e?void 0:e.message)||"")}}catch(e){t(e)}})).then((()=>!0)).catch((()=>!1))}async read(){if(await this._canUseIndexedDBPromise){const e=await async function(e){try{const t=(await Ye()).transaction(Qe),n=await t.objectStore(Qe).get(Ze(e));return await t.done,n}catch(e){if(e instanceof _)ae.warn(e.message);else{const t=Be.create("idb-get",{originalErrorMessage:null==e?void 0:e.message});ae.warn(t.message)}}}(this.app);return(null==e?void 0:e.heartbeats)?e:{heartbeats:[]}}return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return Xe(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return Xe(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}}}function rt(e){return u(JSON.stringify({version:2,heartbeats:e})).length}var st;st="",We(new R("platform-logger",(e=>new se(e)),"PRIVATE")),We(new R("heartbeat",(e=>new et(e)),"PRIVATE")),Ke(ie,oe,st),Ke(ie,oe,"esm2017"),Ke("fire-js","");function it(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(r=Object.getOwnPropertySymbols(e);s<r.length;s++)t.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(e,r[s])&&(n[r[s]]=e[r[s]])}return n}Object.create;Object.create;"function"==typeof SuppressedError&&SuppressedError;function ot(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const at=ot,ct=new E("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),ut=new j("@firebase/auth");function lt(e,...t){ut.logLevel<=x.ERROR&&ut.error(`Auth (${ze}): ${e}`,...t)}function ht(e,...t){throw gt(e,...t)}function dt(e,...t){return gt(e,...t)}function ft(e,t,n){const r=Object.assign(Object.assign({},at()),{[t]:n});return new E("auth","Firebase",r).create(t,{appName:e.name})}function pt(e){return ft(e,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function gt(e,...t){if("string"!=typeof e){const n=t[0],r=[...t.slice(1)];return r[0]&&(r[0].appName=e.name),e._errorFactory.create(n,...r)}return ct.create(e,...t)}function mt(e,t,...n){if(!e)throw gt(t,...n)}function yt(e){const t="INTERNAL ASSERTION FAILED: "+e;throw lt(t),new Error(t)}function vt(e,t){e||yt(t)}function wt(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.href)||""}function _t(){return"http:"===Et()||"https:"===Et()}function Et(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.protocol)||null}function It(){return!("undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&(_t()||function(){const e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}()||"connection"in navigator))||navigator.onLine}class St{constructor(e,t){this.shortDelay=e,this.longDelay=t,vt(t>e,"Short delay should be less than long delay!"),this.isMobile="undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(y())||"object"==typeof navigator&&"ReactNative"===navigator.product}get(){return It()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function bt(e,t){vt(e.emulator,"Emulator should always be set here");const{url:n}=e.emulator;return t?`${n}${t.startsWith("/")?t.slice(1):t}`:n}class Tt{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:"undefined"!=typeof globalThis&&globalThis.fetch?globalThis.fetch:"undefined"!=typeof fetch?fetch:void yt("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:"undefined"!=typeof globalThis&&globalThis.Headers?globalThis.Headers:"undefined"!=typeof Headers?Headers:void yt("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:"undefined"!=typeof globalThis&&globalThis.Response?globalThis.Response:"undefined"!=typeof Response?Response:void yt("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const At={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},Ct=new St(3e4,6e4);function kt(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function Nt(e,t,n,r,s={}){return Dt(e,s,(async()=>{let s={},i={};r&&("GET"===t?i=r:s={body:JSON.stringify(r)});const o=T(Object.assign({key:e.config.apiKey},i)).slice(1),a=await e._getAdditionalHeaders();a["Content-Type"]="application/json",e.languageCode&&(a["X-Firebase-Locale"]=e.languageCode);const c=Object.assign({method:t,headers:a},s);return"undefined"!=typeof navigator&&"Cloudflare-Workers"===navigator.userAgent||(c.referrerPolicy="no-referrer"),Tt.fetch()(Ot(e,e.config.apiHost,n,o),c)}))}async function Dt(e,t,n){e._canInitEmulator=!1;const r=Object.assign(Object.assign({},At),t);try{const t=new Lt(e),s=await Promise.race([n(),t.promise]);t.clearNetworkTimeout();const i=await s.json();if("needConfirmation"in i)throw Mt(e,"account-exists-with-different-credential",i);if(s.ok&&!("errorMessage"in i))return i;{const t=s.ok?i.errorMessage:i.error.message,[n,o]=t.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===n)throw Mt(e,"credential-already-in-use",i);if("EMAIL_EXISTS"===n)throw Mt(e,"email-already-in-use",i);if("USER_DISABLED"===n)throw Mt(e,"user-disabled",i);const a=r[n]||n.toLowerCase().replace(/[_\s]+/g,"-");if(o)throw ft(e,a,o);ht(e,a)}}catch(t){if(t instanceof _)throw t;ht(e,"network-request-failed",{message:String(t)})}}async function Rt(e,t,n,r,s={}){const i=await Nt(e,t,n,r,s);return"mfaPendingCredential"in i&&ht(e,"multi-factor-auth-required",{_serverResponse:i}),i}function Ot(e,t,n,r){const s=`${t}${n}?${r}`;return e.config.emulator?bt(e.config,s):`${e.config.apiScheme}://${s}`}function Pt(e){switch(e){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class Lt{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise(((e,t)=>{this.timer=setTimeout((()=>t(dt(this.auth,"network-request-failed"))),Ct.get())}))}}function Mt(e,t,n){const r={appName:e.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const s=dt(e,t,r);return s.customData._tokenResponse=n,s}function xt(e){return void 0!==e&&void 0!==e.enterprise}class Ut{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],void 0===e.recaptchaKey)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||0===this.recaptchaEnforcementState.length)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return Pt(t.enforcementState);return null}isProviderEnabled(e){return"ENFORCE"===this.getProviderEnforcementState(e)||"AUDIT"===this.getProviderEnforcementState(e)}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function Ft(e,t){return Nt(e,"GET","/v2/recaptchaConfig",kt(e,t))}async function Vt(e,t){return Nt(e,"POST","/v1/accounts:lookup",t)}function Wt(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(e){}}function jt(e){return 1e3*Number(e)}function $t(e){const[t,n,r]=e.split(".");if(void 0===t||void 0===n||void 0===r)return lt("JWT malformed, contained fewer than 3 sections"),null;try{const e=l(n);return e?JSON.parse(e):(lt("Failed to decode base64 JWT payload"),null)}catch(e){return lt("Caught error parsing JWT payload as JSON",null==e?void 0:e.toString()),null}}function Bt(e){const t=$t(e);return mt(t,"internal-error"),mt(void 0!==t.exp,"internal-error"),mt(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}async function qt(e,t,n=!1){if(n)return t;try{return await t}catch(t){throw t instanceof _&&function({code:e}){return"auth/user-disabled"===e||"auth/user-token-expired"===e}(t)&&e.auth.currentUser===e&&await e.auth.signOut(),t}}class zt{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}{this.errorBackoff=3e4;const e=(null!==(t=this.user.stsTokenManager.expirationTime)&&void 0!==t?t:0)-Date.now()-3e5;return Math.max(0,e)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout((async()=>{await this.iteration()}),t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){return void("auth/network-request-failed"===(null==e?void 0:e.code)&&this.schedule(!0))}this.schedule()}}class Ht{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Wt(this.lastLoginAt),this.creationTime=Wt(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function Gt(e){var t;const n=e.auth,r=await e.getIdToken(),s=await qt(e,Vt(n,{idToken:r}));mt(null==s?void 0:s.users.length,n,"internal-error");const i=s.users[0];e._notifyReloadListener(i);const o=(null===(t=i.providerUserInfo)||void 0===t?void 0:t.length)?Kt(i.providerUserInfo):[],a=(c=e.providerData,u=o,[...c.filter((e=>!u.some((t=>t.providerId===e.providerId)))),...u]);var c,u;const l=e.isAnonymous,h=!(e.email&&i.passwordHash||(null==a?void 0:a.length)),d=!!l&&h,f={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:a,metadata:new Ht(i.createdAt,i.lastLoginAt),isAnonymous:d};Object.assign(e,f)}function Kt(e){return e.map((e=>{var{providerId:t}=e,n=it(e,["providerId"]);return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}}))}class Qt{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){mt(e.idToken,"internal-error"),mt(void 0!==e.idToken,"internal-error"),mt(void 0!==e.refreshToken,"internal-error");const t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):Bt(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){mt(0!==e.length,"internal-error");const t=Bt(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return t||!this.accessToken||this.isExpired?(mt(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null):this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:n,refreshToken:r,expiresIn:s}=await async function(e,t){const n=await Dt(e,{},(async()=>{const n=T({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:r,apiKey:s}=e.config,i=Ot(e,r,"/v1/token",`key=${s}`),o=await e._getAdditionalHeaders();return o["Content-Type"]="application/x-www-form-urlencoded",Tt.fetch()(i,{method:"POST",headers:o,body:n})}));return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}(e,t);this.updateTokensAndExpiration(n,r,Number(s))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){const{refreshToken:n,accessToken:r,expirationTime:s}=t,i=new Qt;return n&&(mt("string"==typeof n,"internal-error",{appName:e}),i.refreshToken=n),r&&(mt("string"==typeof r,"internal-error",{appName:e}),i.accessToken=r),s&&(mt("number"==typeof s,"internal-error",{appName:e}),i.expirationTime=s),i}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Qt,this.toJSON())}_performRefresh(){return yt("not implemented")}}function Jt(e,t){mt("string"==typeof e||void 0===e,"internal-error",{appName:t})}class Yt{constructor(e){var{uid:t,auth:n,stsTokenManager:r}=e,s=it(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new zt(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new Ht(s.createdAt||void 0,s.lastLoginAt||void 0)}async getIdToken(e){const t=await qt(this,this.stsTokenManager.getToken(this.auth,e));return mt(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return async function(e,t=!1){const n=D(e),r=await n.getIdToken(t),s=$t(r);mt(s&&s.exp&&s.auth_time&&s.iat,n.auth,"internal-error");const i="object"==typeof s.firebase?s.firebase:void 0,o=null==i?void 0:i.sign_in_provider;return{claims:s,token:r,authTime:Wt(jt(s.auth_time)),issuedAtTime:Wt(jt(s.iat)),expirationTime:Wt(jt(s.exp)),signInProvider:o||null,signInSecondFactor:(null==i?void 0:i.sign_in_second_factor)||null}}(this,e)}reload(){return async function(e){const t=D(e);await Gt(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}(this)}_assign(e){this!==e&&(mt(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map((e=>Object.assign({},e))),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new Yt(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){mt(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await Gt(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){if($e(this.auth.app))return Promise.reject(pt(this.auth));const e=await this.getIdToken();return await qt(this,async function(e,t){return Nt(e,"POST","/v1/accounts:delete",t)}(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map((e=>Object.assign({},e))),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n,r,s,i,o,a,c,u;const l=null!==(n=t.displayName)&&void 0!==n?n:void 0,h=null!==(r=t.email)&&void 0!==r?r:void 0,d=null!==(s=t.phoneNumber)&&void 0!==s?s:void 0,f=null!==(i=t.photoURL)&&void 0!==i?i:void 0,p=null!==(o=t.tenantId)&&void 0!==o?o:void 0,g=null!==(a=t._redirectEventId)&&void 0!==a?a:void 0,m=null!==(c=t.createdAt)&&void 0!==c?c:void 0,y=null!==(u=t.lastLoginAt)&&void 0!==u?u:void 0,{uid:v,emailVerified:w,isAnonymous:_,providerData:E,stsTokenManager:I}=t;mt(v&&I,e,"internal-error");const S=Qt.fromJSON(this.name,I);mt("string"==typeof v,e,"internal-error"),Jt(l,e.name),Jt(h,e.name),mt("boolean"==typeof w,e,"internal-error"),mt("boolean"==typeof _,e,"internal-error"),Jt(d,e.name),Jt(f,e.name),Jt(p,e.name),Jt(g,e.name),Jt(m,e.name),Jt(y,e.name);const b=new Yt({uid:v,auth:e,email:h,emailVerified:w,displayName:l,isAnonymous:_,photoURL:f,phoneNumber:d,tenantId:p,stsTokenManager:S,createdAt:m,lastLoginAt:y});return E&&Array.isArray(E)&&(b.providerData=E.map((e=>Object.assign({},e)))),g&&(b._redirectEventId=g),b}static async _fromIdTokenResponse(e,t,n=!1){const r=new Qt;r.updateFromServerResponse(t);const s=new Yt({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:n});return await Gt(s),s}static async _fromGetAccountInfoResponse(e,t,n){const r=t.users[0];mt(void 0!==r.localId,"internal-error");const s=void 0!==r.providerUserInfo?Kt(r.providerUserInfo):[],i=!(r.email&&r.passwordHash||(null==s?void 0:s.length)),o=new Qt;o.updateFromIdToken(n);const a=new Yt({uid:r.localId,auth:e,stsTokenManager:o,isAnonymous:i}),c={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:s,metadata:new Ht(r.createdAt,r.lastLoginAt),isAnonymous:!(r.email&&r.passwordHash||(null==s?void 0:s.length))};return Object.assign(a,c),a}}const Xt=new Map;function Zt(e){vt(e instanceof Function,"Expected a class definition");let t=Xt.get(e);return t?(vt(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,Xt.set(e,t),t)}class en{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}en.type="NONE";const tn=en;function nn(e,t,n){return`firebase:${e}:${t}:${n}`}class rn{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:r,name:s}=this.auth;this.fullUserKey=nn(this.userKey,r.apiKey,s),this.fullPersistenceKey=nn("persistence",r.apiKey,s),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?Yt._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=e,t?this.setCurrentUser(t):void 0}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,n="authUser"){if(!t.length)return new rn(Zt(tn),e,n);const r=(await Promise.all(t.map((async e=>{if(await e._isAvailable())return e})))).filter((e=>e));let s=r[0]||Zt(tn);const i=nn(n,e.config.apiKey,e.name);let o=null;for(const n of t)try{const t=await n._get(i);if(t){const r=Yt._fromJSON(e,t);n!==s&&(o=r),s=n;break}}catch(e){}const a=r.filter((e=>e._shouldAllowMigration));return s._shouldAllowMigration&&a.length?(s=a[0],o&&await s._set(i,o.toJSON()),await Promise.all(t.map((async e=>{if(e!==s)try{await e._remove(i)}catch(e){}}))),new rn(s,e,n)):new rn(s,e,n)}}function sn(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(un(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(on(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(hn(t))return"Blackberry";if(dn(t))return"Webos";if(an(t))return"Safari";if((t.includes("chrome/")||cn(t))&&!t.includes("edge/"))return"Chrome";if(ln(t))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=e.match(t);if(2===(null==n?void 0:n.length))return n[1]}return"Other"}function on(e=y()){return/firefox\//i.test(e)}function an(e=y()){const t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function cn(e=y()){return/crios\//i.test(e)}function un(e=y()){return/iemobile/i.test(e)}function ln(e=y()){return/android/i.test(e)}function hn(e=y()){return/blackberry/i.test(e)}function dn(e=y()){return/webos/i.test(e)}function fn(e=y()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function pn(){return function(){const e=y();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}()&&10===document.documentMode}function gn(e=y()){return fn(e)||ln(e)||dn(e)||hn(e)||/windows phone/i.test(e)||un(e)}function mn(e,t=[]){let n;switch(e){case"Browser":n=sn(y());break;case"Worker":n=`${sn(y())}-${e}`;break;default:n=e}const r=t.length?t.join(","):"FirebaseCore-web";return`${n}/JsCore/${ze}/${r}`}class yn{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const n=t=>new Promise(((n,r)=>{try{n(e(t))}catch(e){r(e)}}));n.onAbort=t,this.queue.push(n);const r=this.queue.length-1;return()=>{this.queue[r]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(e){t.reverse();for(const e of t)try{e()}catch(e){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null==e?void 0:e.message})}}}class vn{constructor(e){var t,n,r,s;const i=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=null!==(t=i.minPasswordLength)&&void 0!==t?t:6,i.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=i.maxPasswordLength),void 0!==i.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=i.containsLowercaseCharacter),void 0!==i.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=i.containsUppercaseCharacter),void 0!==i.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=i.containsNumericCharacter),void 0!==i.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=i.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=null!==(r=null===(n=e.allowedNonAlphanumericCharacters)||void 0===n?void 0:n.join(""))&&void 0!==r?r:"",this.forceUpgradeOnSignin=null!==(s=e.forceUpgradeOnSignin)&&void 0!==s&&s,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,n,r,s,i,o;const a={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,a),this.validatePasswordCharacterOptions(e,a),a.isValid&&(a.isValid=null===(t=a.meetsMinPasswordLength)||void 0===t||t),a.isValid&&(a.isValid=null===(n=a.meetsMaxPasswordLength)||void 0===n||n),a.isValid&&(a.isValid=null===(r=a.containsLowercaseLetter)||void 0===r||r),a.isValid&&(a.isValid=null===(s=a.containsUppercaseLetter)||void 0===s||s),a.isValid&&(a.isValid=null===(i=a.containsNumericCharacter)||void 0===i||i),a.isValid&&(a.isValid=null===(o=a.containsNonAlphanumericCharacter)||void 0===o||o),a}validatePasswordLengthOptions(e,t){const n=this.customStrengthOptions.minPasswordLength,r=this.customStrengthOptions.maxPasswordLength;n&&(t.meetsMinPasswordLength=e.length>=n),r&&(t.meetsMaxPasswordLength=e.length<=r)}validatePasswordCharacterOptions(e,t){let n;this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);for(let r=0;r<e.length;r++)n=e.charAt(r),this.updatePasswordCharacterOptionsStatuses(t,n>="a"&&n<="z",n>="A"&&n<="Z",n>="0"&&n<="9",this.allowedNonAlphanumericCharacters.includes(n))}updatePasswordCharacterOptionsStatuses(e,t,n,r,s){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=n)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=r)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=s))}}class wn{constructor(e,t,n,r){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=n,this.config=r,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new En(this),this.idTokenSubscription=new En(this),this.beforeStateQueue=new yn(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=ct,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=r.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Zt(t)),this._initializationPromise=this.queue((async()=>{var n,r;if(!this._deleted&&(this.persistenceManager=await rn.create(this,e),!this._deleted)){if(null===(n=this._popupRedirectResolver)||void 0===n?void 0:n._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(e){}await this.initializeCurrentUser(t),this.lastNotifiedUid=(null===(r=this.currentUser)||void 0===r?void 0:r.uid)||null,this._deleted||(this._isInitialized=!0)}})),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();return this.currentUser||e?this.currentUser&&e&&this.currentUser.uid===e.uid?(this._currentUser._assign(e),void await this.currentUser.getIdToken()):void await this._updateCurrentUser(e,!0):void 0}async initializeCurrentUserFromIdToken(e){try{const t=await Vt(this,{idToken:e}),n=await Yt._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(n)}catch(e){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",e),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if($e(this.app)){const e=this.app.settings.authIdToken;return e?new Promise((t=>{setTimeout((()=>this.initializeCurrentUserFromIdToken(e).then(t,t)))})):this.directlySetCurrentUser(null)}const n=await this.assertedPersistence.getCurrentUser();let r=n,s=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const n=null===(t=this.redirectUser)||void 0===t?void 0:t._redirectEventId,i=null==r?void 0:r._redirectEventId,o=await this.tryRedirectSignIn(e);n&&n!==i||!(null==o?void 0:o.user)||(r=o.user,s=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(s)try{await this.beforeStateQueue.runMiddleware(r)}catch(e){r=n,this._popupRedirectResolver._overrideRedirectResult(this,(()=>Promise.reject(e)))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return mt(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(e){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await Gt(e)}catch(e){if("auth/network-request-failed"!==(null==e?void 0:e.code))return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if($e(this.app))return Promise.reject(pt(this));const t=e?D(e):null;return t&&mt(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&mt(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue((async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()}))}async signOut(){return $e(this.app)?Promise.reject(pt(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return $e(this.app)?Promise.reject(pt(this)):this.queue((async()=>{await this.assertedPersistence.setPersistence(Zt(e))}))}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await async function(e,t={}){return Nt(e,"GET","/v2/passwordPolicy",kt(e,t))}(this),t=new vn(e);null===this.tenantId?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new E("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}authStateReady(){return new Promise(((e,t)=>{if(this.currentUser)e();else{const n=this.onAuthStateChanged((()=>{n(),e()}),t)}}))}async revokeAccessToken(e){if(this.currentUser){const t={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:await this.currentUser.getIdToken()};null!=this.tenantId&&(t.tenantId=this.tenantId),await async function(e,t){return Nt(e,"POST","/v2/accounts:revokeToken",kt(e,t))}(this,t)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(e=this._currentUser)||void 0===e?void 0:e.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&Zt(e)||this._popupRedirectResolver;mt(t,this,"argument-error"),this.redirectPersistenceManager=await rn.create(this,[Zt(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,n;return this._isInitialized&&await this.queue((async()=>{})),(null===(t=this._currentUser)||void 0===t?void 0:t._redirectEventId)===e?this._currentUser:(null===(n=this.redirectUser)||void 0===n?void 0:n._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue((async()=>this.directlySetCurrentUser(e)))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=null!==(t=null===(e=this.currentUser)||void 0===e?void 0:e.uid)&&void 0!==t?t:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,r){if(this._deleted)return()=>{};const s="function"==typeof t?t:t.next.bind(t);let i=!1;const o=this._isInitialized?Promise.resolve():this._initializationPromise;if(mt(o,this,"internal-error"),o.then((()=>{i||s(this.currentUser)})),"function"==typeof t){const s=e.addObserver(t,n,r);return()=>{i=!0,s()}}{const n=e.addObserver(t);return()=>{i=!0,n()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return mt(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){e&&!this.frameworks.includes(e)&&(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=mn(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const n=await(null===(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getHeartbeatsHeader());n&&(t["X-Firebase-Client"]=n);const r=await this._getAppCheckToken();return r&&(t["X-Firebase-AppCheck"]=r),t}async _getAppCheckToken(){var e;if($e(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const t=await(null===(e=this.appCheckServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getToken());return(null==t?void 0:t.error)&&function(e,...t){ut.logLevel<=x.WARN&&ut.warn(`Auth (${ze}): ${e}`,...t)}(`Error while retrieving App Check token: ${t.error}`),null==t?void 0:t.token}}function _n(e){return D(e)}class En{constructor(e){this.auth=e,this.observer=null,this.addObserver=function(e,t){const n=new k(e,t);return n.subscribe.bind(n)}((e=>this.observer=e))}get next(){return mt(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let In={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function Sn(e){return In.loadJS(e)}function bn(e){return`__${e}${Math.floor(1e6*Math.random())}`}class Tn{constructor(){this.enterprise=new An}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class An{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}const Cn="NO_RECAPTCHA";class kn{constructor(e){this.type="recaptcha-enterprise",this.auth=_n(e)}async verify(e="verify",t=!1){function n(t,n,r){const s=window.grecaptcha;xt(s)?s.enterprise.ready((()=>{s.enterprise.execute(t,{action:e}).then((e=>{n(e)})).catch((()=>{n(Cn)}))})):r(Error("No reCAPTCHA enterprise script loaded."))}if(this.auth.settings.appVerificationDisabledForTesting){return(new Tn).execute("siteKey",{action:"verify"})}return new Promise(((e,r)=>{(async function(e){if(!t){if(null==e.tenantId&&null!=e._agentRecaptchaConfig)return e._agentRecaptchaConfig.siteKey;if(null!=e.tenantId&&void 0!==e._tenantRecaptchaConfigs[e.tenantId])return e._tenantRecaptchaConfigs[e.tenantId].siteKey}return new Promise((async(t,n)=>{Ft(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then((r=>{if(void 0!==r.recaptchaKey){const n=new Ut(r);return null==e.tenantId?e._agentRecaptchaConfig=n:e._tenantRecaptchaConfigs[e.tenantId]=n,t(n.siteKey)}n(new Error("recaptcha Enterprise site key undefined"))})).catch((e=>{n(e)}))}))})(this.auth).then((s=>{if(!t&&xt(window.grecaptcha))n(s,e,r);else{if("undefined"==typeof window)return void r(new Error("RecaptchaVerifier is only supported in browser"));let t=In.recaptchaEnterpriseScript;0!==t.length&&(t+=s),Sn(t).then((()=>{n(s,e,r)})).catch((e=>{r(e)}))}})).catch((e=>{r(e)}))}))}}async function Nn(e,t,n,r=!1,s=!1){const i=new kn(e);let o;if(s)o=Cn;else try{o=await i.verify(n)}catch(e){o=await i.verify(n,!0)}const a=Object.assign({},t);if("mfaSmsEnrollment"===n||"mfaSmsSignIn"===n){if("phoneEnrollmentInfo"in a){const e=a.phoneEnrollmentInfo.phoneNumber,t=a.phoneEnrollmentInfo.recaptchaToken;Object.assign(a,{phoneEnrollmentInfo:{phoneNumber:e,recaptchaToken:t,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in a){const e=a.phoneSignInInfo.recaptchaToken;Object.assign(a,{phoneSignInInfo:{recaptchaToken:e,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return a}return r?Object.assign(a,{captchaResp:o}):Object.assign(a,{captchaResponse:o}),Object.assign(a,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(a,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),a}async function Dn(e,t,n,r,s){var i,o;if("EMAIL_PASSWORD_PROVIDER"===s){if(null===(i=e._getRecaptchaConfig())||void 0===i?void 0:i.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const s=await Nn(e,t,n,"getOobCode"===n);return r(e,s)}return r(e,t).catch((async s=>{if("auth/missing-recaptcha-token"===s.code){console.log(`${n} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const s=await Nn(e,t,n,"getOobCode"===n);return r(e,s)}return Promise.reject(s)}))}if("PHONE_PROVIDER"===s){if(null===(o=e._getRecaptchaConfig())||void 0===o?void 0:o.isProviderEnabled("PHONE_PROVIDER")){const s=await Nn(e,t,n);return r(e,s).catch((async s=>{var i;if("AUDIT"===(null===(i=e._getRecaptchaConfig())||void 0===i?void 0:i.getProviderEnforcementState("PHONE_PROVIDER"))&&("auth/missing-recaptcha-token"===s.code||"auth/invalid-app-credential"===s.code)){console.log(`Failed to verify with reCAPTCHA Enterprise. Automatically triggering the reCAPTCHA v2 flow to complete the ${n} flow.`);const s=await Nn(e,t,n,!1,!0);return r(e,s)}return Promise.reject(s)}))}{const s=await Nn(e,t,n,!1,!0);return r(e,s)}}return Promise.reject(s+" provider is not supported.")}async function Rn(e){const t=_n(e),n=await Ft(t,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}),r=new Ut(n);if(null==t.tenantId?t._agentRecaptchaConfig=r:t._tenantRecaptchaConfigs[t.tenantId]=r,r.isAnyProviderEnabled()){new kn(t).verify()}}function On(e,t,n){const r=_n(e);mt(/^https?:\/\//.test(t),r,"invalid-emulator-scheme");const s=!!(null==n?void 0:n.disableWarnings),i=Pn(t),{host:o,port:a}=function(e){const t=Pn(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(r);if(s){const e=s[1];return{host:e,port:Ln(r.substr(e.length+1))}}{const[e,t]=r.split(":");return{host:e,port:Ln(t)}}}(t),c={url:`${i}//${o}${null===a?"":`:${a}`}/`},u=Object.freeze({host:o,port:a,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:s})});if(!r._canInitEmulator)return mt(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),void mt(S(c,r.config.emulator)&&S(u,r.emulatorConfig),r,"emulator-config-failed");r.config.emulator=c,r.emulatorConfig=u,r.settings.appVerificationDisabledForTesting=!0,s||function(){function e(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials.");"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}function Pn(e){const t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function Ln(e){if(!e)return null;const t=Number(e);return isNaN(t)?null:t}class Mn{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return yt("not implemented")}_getIdTokenResponse(e){return yt("not implemented")}_linkToIdToken(e,t){return yt("not implemented")}_getReauthenticationResolver(e){return yt("not implemented")}}async function xn(e,t){return Nt(e,"POST","/v1/accounts:signUp",t)}async function Un(e,t){return Rt(e,"POST","/v1/accounts:signInWithPassword",kt(e,t))}class Fn extends Mn{constructor(e,t,n,r=null){super("password",n),this._email=e,this._password=t,this._tenantId=r}static _fromEmailAndPassword(e,t){return new Fn(e,t,"password")}static _fromEmailAndCode(e,t,n=null){return new Fn(e,t,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e;if((null==t?void 0:t.email)&&(null==t?void 0:t.password)){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return Dn(e,{returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signInWithPassword",Un,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return async function(e,t){return Rt(e,"POST","/v1/accounts:signInWithEmailLink",kt(e,t))}(e,{email:this._email,oobCode:this._password});default:ht(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return Dn(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",xn,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return async function(e,t){return Rt(e,"POST","/v1/accounts:signInWithEmailLink",kt(e,t))}(e,{idToken:t,email:this._email,oobCode:this._password});default:ht(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function Vn(e,t){return Rt(e,"POST","/v1/accounts:signInWithIdp",kt(e,t))}class Wn extends Mn{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Wn(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):ht("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e,{providerId:n,signInMethod:r}=t,s=it(t,["providerId","signInMethod"]);if(!n||!r)return null;const i=new Wn(n,r);return i.idToken=s.idToken||void 0,i.accessToken=s.accessToken||void 0,i.secret=s.secret,i.nonce=s.nonce,i.pendingToken=s.pendingToken||null,i}_getIdTokenResponse(e){return Vn(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,Vn(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Vn(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=T(t)}return e}}async function jn(e,t){return Nt(e,"POST","/v1/accounts:sendVerificationCode",kt(e,t))}const $n={USER_NOT_FOUND:"user-not-found"};class Bn extends Mn{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new Bn({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new Bn({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return async function(e,t){return Rt(e,"POST","/v1/accounts:signInWithPhoneNumber",kt(e,t))}(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return async function(e,t){const n=await Rt(e,"POST","/v1/accounts:signInWithPhoneNumber",kt(e,t));if(n.temporaryProof)throw Mt(e,"account-exists-with-different-credential",n);return n}(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return async function(e,t){return Rt(e,"POST","/v1/accounts:signInWithPhoneNumber",kt(e,Object.assign(Object.assign({},t),{operation:"REAUTH"})),$n)}(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:n,verificationCode:r}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:n,code:r}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){"string"==typeof e&&(e=JSON.parse(e));const{verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:s}=e;return n||t||r||s?new Bn({verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:s}):null}}class qn{constructor(e){var t,n,r,s,i,o;const a=A(C(e)),c=null!==(t=a.apiKey)&&void 0!==t?t:null,u=null!==(n=a.oobCode)&&void 0!==n?n:null,l=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(r=a.mode)&&void 0!==r?r:null);mt(c&&u&&l,"argument-error"),this.apiKey=c,this.operation=l,this.code=u,this.continueUrl=null!==(s=a.continueUrl)&&void 0!==s?s:null,this.languageCode=null!==(i=a.languageCode)&&void 0!==i?i:null,this.tenantId=null!==(o=a.tenantId)&&void 0!==o?o:null}static parseLink(e){const t=function(e){const t=A(C(e)).link,n=t?A(C(t)).deep_link_id:null,r=A(C(e)).deep_link_id;return(r?A(C(r)).link:null)||r||n||t||e}(e);try{return new qn(t)}catch(e){return null}}}class zn{constructor(){this.providerId=zn.PROVIDER_ID}static credential(e,t){return Fn._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const n=qn.parseLink(t);return mt(n,"argument-error"),Fn._fromEmailAndCode(e,n.code,n.tenantId)}}zn.PROVIDER_ID="password",zn.EMAIL_PASSWORD_SIGN_IN_METHOD="password",zn.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class Hn{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class Gn extends Hn{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class Kn extends Gn{constructor(){super("facebook.com")}static credential(e){return Wn._fromParams({providerId:Kn.PROVIDER_ID,signInMethod:Kn.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Kn.credentialFromTaggedObject(e)}static credentialFromError(e){return Kn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return Kn.credential(e.oauthAccessToken)}catch(e){return null}}}Kn.FACEBOOK_SIGN_IN_METHOD="facebook.com",Kn.PROVIDER_ID="facebook.com";class Qn extends Gn{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Wn._fromParams({providerId:Qn.PROVIDER_ID,signInMethod:Qn.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Qn.credentialFromTaggedObject(e)}static credentialFromError(e){return Qn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:n}=e;if(!t&&!n)return null;try{return Qn.credential(t,n)}catch(e){return null}}}Qn.GOOGLE_SIGN_IN_METHOD="google.com",Qn.PROVIDER_ID="google.com";class Jn extends Gn{constructor(){super("github.com")}static credential(e){return Wn._fromParams({providerId:Jn.PROVIDER_ID,signInMethod:Jn.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Jn.credentialFromTaggedObject(e)}static credentialFromError(e){return Jn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return Jn.credential(e.oauthAccessToken)}catch(e){return null}}}Jn.GITHUB_SIGN_IN_METHOD="github.com",Jn.PROVIDER_ID="github.com";class Yn extends Gn{constructor(){super("twitter.com")}static credential(e,t){return Wn._fromParams({providerId:Yn.PROVIDER_ID,signInMethod:Yn.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return Yn.credentialFromTaggedObject(e)}static credentialFromError(e){return Yn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:n}=e;if(!t||!n)return null;try{return Yn.credential(t,n)}catch(e){return null}}}Yn.TWITTER_SIGN_IN_METHOD="twitter.com",Yn.PROVIDER_ID="twitter.com";class Xn{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n,r=!1){const s=await Yt._fromIdTokenResponse(e,n,r),i=Zn(n);return new Xn({user:s,providerId:i,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);const r=Zn(n);return new Xn({user:e,providerId:r,_tokenResponse:n,operationType:t})}}function Zn(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}class er extends _{constructor(e,t,n,r){var s;super(t.code,t.message),this.operationType=n,this.user=r,Object.setPrototypeOf(this,er.prototype),this.customData={appName:e.name,tenantId:null!==(s=e.tenantId)&&void 0!==s?s:void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,r){return new er(e,t,n,r)}}function tr(e,t,n,r){return("reauthenticate"===t?n._getReauthenticationResolver(e):n._getIdTokenResponse(e)).catch((n=>{if("auth/multi-factor-auth-required"===n.code)throw er._fromErrorAndOperation(e,n,t,r);throw n}))}async function nr(e,t,n=!1){const r=await qt(e,t._linkToIdToken(e.auth,await e.getIdToken()),n);return Xn._forOperation(e,"link",r)}async function rr(e,t,n=!1){const{auth:r}=e;if($e(r.app))return Promise.reject(pt(r));const s="reauthenticate";try{const i=await qt(e,tr(r,s,t,e),n);mt(i.idToken,r,"internal-error");const o=$t(i.idToken);mt(o,r,"internal-error");const{sub:a}=o;return mt(e.uid===a,r,"user-mismatch"),Xn._forOperation(e,s,i)}catch(e){throw"auth/user-not-found"===(null==e?void 0:e.code)&&ht(r,"user-mismatch"),e}}async function sr(e,t,n=!1){if($e(e.app))return Promise.reject(pt(e));const r="signIn",s=await tr(e,r,t),i=await Xn._fromIdTokenResponse(e,r,s);return n||await e._updateCurrentUser(i.user),i}function ir(e,t){return Nt(e,"POST","/v2/accounts/mfaEnrollment:start",kt(e,t))}new WeakMap;const or="__sak";class ar{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(or,"1"),this.storage.removeItem(or),Promise.resolve(!0)):Promise.resolve(!1)}catch(e){return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class cr extends ar{constructor(){super((()=>window.localStorage),"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=gn(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const n=this.storage.getItem(t),r=this.localCache[t];n!==r&&e(t,r,n)}}onStorageEvent(e,t=!1){if(!e.key)return void this.forAllChangedKeys(((e,t,n)=>{this.notifyListeners(e,n)}));const n=e.key;t?this.detachListener():this.stopPolling();const r=()=>{const e=this.storage.getItem(n);(t||this.localCache[n]!==e)&&this.notifyListeners(n,e)},s=this.storage.getItem(n);pn()&&s!==e.newValue&&e.newValue!==e.oldValue?setTimeout(r,10):r()}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const e of Array.from(n))e(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((()=>{this.forAllChangedKeys(((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)}))}),1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}cr.type="LOCAL";const ur=cr;class lr extends ar{constructor(){super((()=>window.sessionStorage),"SESSION")}_addListener(e,t){}_removeListener(e,t){}}lr.type="SESSION";const hr=lr;class dr{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find((t=>t.isListeningto(e)));if(t)return t;const n=new dr(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:r,data:s}=t.data,i=this.handlersMap[r];if(!(null==i?void 0:i.size))return;t.ports[0].postMessage({status:"ack",eventId:n,eventType:r});const o=Array.from(i).map((async e=>e(t.origin,s))),a=await function(e){return Promise.all(e.map((async e=>{try{return{fulfilled:!0,value:await e}}catch(e){return{fulfilled:!1,reason:e}}})))}(o);t.ports[0].postMessage({status:"done",eventId:n,eventType:r,response:a})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function fr(e="",t=10){let n="";for(let e=0;e<t;e++)n+=Math.floor(10*Math.random());return e+n}dr.receivers=[];class pr{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,n=50){const r="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!r)throw new Error("connection_unavailable");let s,i;return new Promise(((o,a)=>{const c=fr("",20);r.port1.start();const u=setTimeout((()=>{a(new Error("unsupported_event"))}),n);i={messageChannel:r,onMessage(e){const t=e;if(t.data.eventId===c)switch(t.data.status){case"ack":clearTimeout(u),s=setTimeout((()=>{a(new Error("timeout"))}),3e3);break;case"done":clearTimeout(s),o(t.data.response);break;default:clearTimeout(u),clearTimeout(s),a(new Error("invalid_response"))}}},this.handlers.add(i),r.port1.addEventListener("message",i.onMessage),this.target.postMessage({eventType:e,eventId:c,data:t},[r.port2])})).finally((()=>{i&&this.removeMessageHandler(i)}))}}function gr(){return window}function mr(){return void 0!==gr().WorkerGlobalScope&&"function"==typeof gr().importScripts}const yr="firebaseLocalStorageDb",vr="firebaseLocalStorage",wr="fbase_key";class _r{constructor(e){this.request=e}toPromise(){return new Promise(((e,t)=>{this.request.addEventListener("success",(()=>{e(this.request.result)})),this.request.addEventListener("error",(()=>{t(this.request.error)}))}))}}function Er(e,t){return e.transaction([vr],t?"readwrite":"readonly").objectStore(vr)}function Ir(){const e=indexedDB.open(yr,1);return new Promise(((t,n)=>{e.addEventListener("error",(()=>{n(e.error)})),e.addEventListener("upgradeneeded",(()=>{const t=e.result;try{t.createObjectStore(vr,{keyPath:wr})}catch(e){n(e)}})),e.addEventListener("success",(async()=>{const n=e.result;n.objectStoreNames.contains(vr)?t(n):(n.close(),await function(){const e=indexedDB.deleteDatabase(yr);return new _r(e).toPromise()}(),t(await Ir()))}))}))}async function Sr(e,t,n){const r=Er(e,!0).put({[wr]:t,value:n});return new _r(r).toPromise()}function br(e,t){const n=Er(e,!0).delete(t);return new _r(n).toPromise()}class Tr{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then((()=>{}),(()=>{}))}async _openDb(){return this.db||(this.db=await Ir()),this.db}async _withRetries(e){let t=0;for(;;)try{const t=await this._openDb();return await e(t)}catch(e){if(t++>3)throw e;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return mr()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=dr._getInstance(mr()?self:null),this.receiver._subscribe("keyChanged",(async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)}))),this.receiver._subscribe("ping",(async(e,t)=>["keyChanged"]))}async initializeSender(){var e,t;if(this.activeServiceWorker=await async function(){if(!(null===navigator||void 0===navigator?void 0:navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch(e){return null}}(),!this.activeServiceWorker)return;this.sender=new pr(this.activeServiceWorker);const n=await this.sender._send("ping",{},800);n&&(null===(e=n[0])||void 0===e?void 0:e.fulfilled)&&(null===(t=n[0])||void 0===t?void 0:t.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(this.sender&&this.activeServiceWorker&&function(){var e;return(null===(e=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)||void 0===e?void 0:e.controller)||null}()===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch(e){}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Ir();return await Sr(e,or,"1"),await br(e,or),!0}catch(e){}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite((async()=>(await this._withRetries((n=>Sr(n,e,t))),this.localCache[e]=t,this.notifyServiceWorker(e))))}async _get(e){const t=await this._withRetries((t=>async function(e,t){const n=Er(e,!1).get(t),r=await new _r(n).toPromise();return void 0===r?null:r.value}(t,e)));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite((async()=>(await this._withRetries((t=>br(t,e))),delete this.localCache[e],this.notifyServiceWorker(e))))}async _poll(){const e=await this._withRetries((e=>{const t=Er(e,!1).getAll();return new _r(t).toPromise()}));if(!e)return[];if(0!==this.pendingWrites)return[];const t=[],n=new Set;if(0!==e.length)for(const{fbase_key:r,value:s}of e)n.add(r),JSON.stringify(this.localCache[r])!==JSON.stringify(s)&&(this.notifyListeners(r,s),t.push(r));for(const e of Object.keys(this.localCache))this.localCache[e]&&!n.has(e)&&(this.notifyListeners(e,null),t.push(e));return t}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const e of Array.from(n))e(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((async()=>this._poll()),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}Tr.type="LOCAL";const Ar=Tr;function Cr(e,t){return Nt(e,"POST","/v2/accounts/mfaSignIn:start",kt(e,t))}bn("rcb"),new St(3e4,6e4);const kr="recaptcha";async function Nr(e,t,n){var r;if(!e._getRecaptchaConfig())try{await Rn(e)}catch(e){console.log("Failed to initialize reCAPTCHA Enterprise config. Triggering the reCAPTCHA v2 verification.")}try{let s;if(s="string"==typeof t?{phoneNumber:t}:t,"session"in s){const t=s.session;if("phoneNumber"in s){mt("enroll"===t.type,e,"internal-error");const r={idToken:t.credential,phoneEnrollmentInfo:{phoneNumber:s.phoneNumber,clientType:"CLIENT_TYPE_WEB"}},i=Dn(e,r,"mfaSmsEnrollment",(async(e,t)=>{if(t.phoneEnrollmentInfo.captchaResponse===Cn){mt((null==n?void 0:n.type)===kr,e,"argument-error");return ir(e,await Dr(e,t,n))}return ir(e,t)}),"PHONE_PROVIDER");return(await i.catch((e=>Promise.reject(e)))).phoneSessionInfo.sessionInfo}{mt("signin"===t.type,e,"internal-error");const i=(null===(r=s.multiFactorHint)||void 0===r?void 0:r.uid)||s.multiFactorUid;mt(i,e,"missing-multi-factor-info");const o={mfaPendingCredential:t.credential,mfaEnrollmentId:i,phoneSignInInfo:{clientType:"CLIENT_TYPE_WEB"}},a=Dn(e,o,"mfaSmsSignIn",(async(e,t)=>{if(t.phoneSignInInfo.captchaResponse===Cn){mt((null==n?void 0:n.type)===kr,e,"argument-error");return Cr(e,await Dr(e,t,n))}return Cr(e,t)}),"PHONE_PROVIDER");return(await a.catch((e=>Promise.reject(e)))).phoneResponseInfo.sessionInfo}}{const t={phoneNumber:s.phoneNumber,clientType:"CLIENT_TYPE_WEB"},r=Dn(e,t,"sendVerificationCode",(async(e,t)=>{if(t.captchaResponse===Cn){mt((null==n?void 0:n.type)===kr,e,"argument-error");return jn(e,await Dr(e,t,n))}return jn(e,t)}),"PHONE_PROVIDER");return(await r.catch((e=>Promise.reject(e)))).sessionInfo}}finally{null==n||n._reset()}}async function Dr(e,t,n){mt(n.type===kr,e,"argument-error");const r=await n.verify();mt("string"==typeof r,e,"argument-error");const s=Object.assign({},t);if("phoneEnrollmentInfo"in s){const e=s.phoneEnrollmentInfo.phoneNumber,t=s.phoneEnrollmentInfo.captchaResponse,n=s.phoneEnrollmentInfo.clientType,i=s.phoneEnrollmentInfo.recaptchaVersion;return Object.assign(s,{phoneEnrollmentInfo:{phoneNumber:e,recaptchaToken:r,captchaResponse:t,clientType:n,recaptchaVersion:i}}),s}if("phoneSignInInfo"in s){const e=s.phoneSignInInfo.captchaResponse,t=s.phoneSignInInfo.clientType,n=s.phoneSignInInfo.recaptchaVersion;return Object.assign(s,{phoneSignInInfo:{recaptchaToken:r,captchaResponse:e,clientType:t,recaptchaVersion:n}}),s}return Object.assign(s,{recaptchaToken:r}),s}class Rr{constructor(e){this.providerId=Rr.PROVIDER_ID,this.auth=_n(e)}verifyPhoneNumber(e,t){return Nr(this.auth,e,D(t))}static credential(e,t){return Bn._fromVerification(e,t)}static credentialFromResult(e){const t=e;return Rr.credentialFromTaggedObject(t)}static credentialFromError(e){return Rr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{phoneNumber:t,temporaryProof:n}=e;return t&&n?Bn._fromTokenResponse(t,n):null}}function Or(e,t){return t?Zt(t):(mt(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}Rr.PROVIDER_ID="phone",Rr.PHONE_SIGN_IN_METHOD="phone";class Pr extends Mn{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Vn(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Vn(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Vn(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function Lr(e){return sr(e.auth,new Pr(e),e.bypassAuthState)}function Mr(e){const{auth:t,user:n}=e;return mt(n,t,"internal-error"),rr(n,new Pr(e),e.bypassAuthState)}async function xr(e){const{auth:t,user:n}=e;return mt(n,t,"internal-error"),nr(n,new Pr(e),e.bypassAuthState)}class Ur{constructor(e,t,n,r,s=!1){this.auth=e,this.resolver=n,this.user=r,this.bypassAuthState=s,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise((async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(e){this.reject(e)}}))}async onAuthEvent(e){const{urlResponse:t,sessionId:n,postBody:r,tenantId:s,error:i,type:o}=e;if(i)return void this.reject(i);const a={auth:this.auth,requestUri:t,sessionId:n,tenantId:s||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(o)(a))}catch(e){this.reject(e)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return Lr;case"linkViaPopup":case"linkViaRedirect":return xr;case"reauthViaPopup":case"reauthViaRedirect":return Mr;default:ht(this.auth,"internal-error")}}resolve(e){vt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){vt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const Fr=new St(2e3,1e4);class Vr extends Ur{constructor(e,t,n,r,s){super(e,t,r,s),this.provider=n,this.authWindow=null,this.pollId=null,Vr.currentPopupAction&&Vr.currentPopupAction.cancel(),Vr.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return mt(e,this.auth,"internal-error"),e}async onExecution(){vt(1===this.filter.length,"Popup operations only handle one event");const e=fr();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch((e=>{this.reject(e)})),this.resolver._isIframeWebStorageSupported(this.auth,(e=>{e||this.reject(dt(this.auth,"web-storage-unsupported"))})),this.pollUserCancellation()}get eventId(){var e;return(null===(e=this.authWindow)||void 0===e?void 0:e.associatedEvent)||null}cancel(){this.reject(dt(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Vr.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,n;(null===(n=null===(t=this.authWindow)||void 0===t?void 0:t.window)||void 0===n?void 0:n.closed)?this.pollId=window.setTimeout((()=>{this.pollId=null,this.reject(dt(this.auth,"popup-closed-by-user"))}),8e3):this.pollId=window.setTimeout(e,Fr.get())};e()}}Vr.currentPopupAction=null;const Wr=new Map;class jr extends Ur{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}async execute(){let e=Wr.get(this.auth._key());if(!e){try{const t=await async function(e,t){const n=qr(t),r=Br(e);if(!await r._isAvailable())return!1;const s="true"===await r._get(n);return await r._remove(n),s}(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(t)}catch(t){e=()=>Promise.reject(t)}Wr.set(this.auth._key(),e)}return this.bypassAuthState||Wr.set(this.auth._key(),(()=>Promise.resolve(null))),e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"!==e.type){if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}else this.resolve(null)}async onExecution(){}cleanUp(){}}function $r(e,t){Wr.set(e._key(),t)}function Br(e){return Zt(e._redirectPersistence)}function qr(e){return nn("pendingRedirect",e.config.apiKey,e.name)}async function zr(e,t,n=!1){if($e(e.app))return Promise.reject(pt(e));const r=_n(e),s=Or(r,t),i=new jr(r,s,n),o=await i.execute();return o&&!n&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,t)),o}class Hr{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach((n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))})),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Kr(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var n;if(e.error&&!Kr(e)){const r=(null===(n=e.error.code)||void 0===n?void 0:n.split("auth/")[1])||"internal-error";t.onError(dt(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(Gr(e))}saveEventToCache(e){this.cachedEventUids.add(Gr(e)),this.lastProcessedEventTime=Date.now()}}function Gr(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter((e=>e)).join("-")}function Kr({type:e,error:t}){return"unknown"===e&&"auth/no-auth-event"===(null==t?void 0:t.code)}const Qr=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Jr=/^https?/;async function Yr(e){if(e.config.emulator)return;const{authorizedDomains:t}=await async function(e,t={}){return Nt(e,"GET","/v1/projects",t)}(e);for(const e of t)try{if(Xr(e))return}catch(e){}ht(e,"unauthorized-domain")}function Xr(e){const t=wt(),{protocol:n,hostname:r}=new URL(t);if(e.startsWith("chrome-extension://")){const s=new URL(e);return""===s.hostname&&""===r?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&s.hostname===r}if(!Jr.test(n))return!1;if(Qr.test(e))return r===e;const s=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}const Zr=new St(3e4,6e4);function es(){const e=gr().___jsl;if(null==e?void 0:e.H)for(const t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let t=0;t<e.CP.length;t++)e.CP[t]=null}function ts(e){return new Promise(((t,n)=>{var r,s,i;function o(){es(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{es(),n(dt(e,"network-request-failed"))},timeout:Zr.get()})}if(null===(s=null===(r=gr().gapi)||void 0===r?void 0:r.iframes)||void 0===s?void 0:s.Iframe)t(gapi.iframes.getContext());else{if(!(null===(i=gr().gapi)||void 0===i?void 0:i.load)){const t=bn("iframefcb");return gr()[t]=()=>{gapi.load?o():n(dt(e,"network-request-failed"))},Sn(`${In.gapiScript}?onload=${t}`).catch((e=>n(e)))}o()}})).catch((e=>{throw ns=null,e}))}let ns=null;const rs=new St(5e3,15e3),ss={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},is=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function os(e){const t=e.config;mt(t.authDomain,e,"auth-domain-config-required");const n=t.emulator?bt(t,"emulator/auth/iframe"):`https://${e.config.authDomain}/__/auth/iframe`,r={apiKey:t.apiKey,appName:e.name,v:ze},s=is.get(e.config.apiHost);s&&(r.eid=s);const i=e._getFrameworks();return i.length&&(r.fw=i.join(",")),`${n}?${T(r).slice(1)}`}async function as(e){const t=await function(e){return ns=ns||ts(e),ns}(e),n=gr().gapi;return mt(n,e,"internal-error"),t.open({where:document.body,url:os(e),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:ss,dontclear:!0},(t=>new Promise((async(n,r)=>{await t.restyle({setHideOnLeave:!1});const s=dt(e,"network-request-failed"),i=gr().setTimeout((()=>{r(s)}),rs.get());function o(){gr().clearTimeout(i),n(t)}t.ping(o).then(o,(()=>{r(s)}))}))))}const cs={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class us{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}function ls(e,t,n,r=500,s=600){const i=Math.max((window.screen.availHeight-s)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let a="";const c=Object.assign(Object.assign({},cs),{width:r.toString(),height:s.toString(),top:i,left:o}),u=y().toLowerCase();n&&(a=cn(u)?"_blank":n),on(u)&&(t=t||"http://localhost",c.scrollbars="yes");const l=Object.entries(c).reduce(((e,[t,n])=>`${e}${t}=${n},`),"");if(function(e=y()){var t;return fn(e)&&!!(null===(t=window.navigator)||void 0===t?void 0:t.standalone)}(u)&&"_self"!==a)return function(e,t){const n=document.createElement("a");n.href=e,n.target=t;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}(t||"",a),new us(null);const h=window.open(t||"",a,l);mt(h,e,"popup-blocked");try{h.focus()}catch(e){}return new us(h)}const hs="__/auth/handler",ds="emulator/auth/handler",fs=encodeURIComponent("fac");async function ps(e,t,n,r,s,i){mt(e.config.authDomain,e,"auth-domain-config-required"),mt(e.config.apiKey,e,"invalid-api-key");const o={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:r,v:ze,eventId:s};if(t instanceof Hn){t.setDefaultLanguage(e.languageCode),o.providerId=t.providerId||"",function(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}(t.getCustomParameters())||(o.customParameters=JSON.stringify(t.getCustomParameters()));for(const[e,t]of Object.entries(i||{}))o[e]=t}if(t instanceof Gn){const e=t.getScopes().filter((e=>""!==e));e.length>0&&(o.scopes=e.join(","))}e.tenantId&&(o.tid=e.tenantId);const a=o;for(const e of Object.keys(a))void 0===a[e]&&delete a[e];const c=await e._getAppCheckToken(),u=c?`#${fs}=${encodeURIComponent(c)}`:"";return`${function({config:e}){if(!e.emulator)return`https://${e.authDomain}/${hs}`;return bt(e,ds)}(e)}?${T(a).slice(1)}${u}`}const gs="webStorageSupport";const ms=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=hr,this._completeRedirectFn=zr,this._overrideRedirectResult=$r}async _openPopup(e,t,n,r){var s;vt(null===(s=this.eventManagers[e._key()])||void 0===s?void 0:s.manager,"_initialize() not called before _openPopup()");return ls(e,await ps(e,t,n,wt(),r),fr())}async _openRedirect(e,t,n,r){await this._originValidation(e);return function(e){gr().location.href=e}(await ps(e,t,n,wt(),r)),new Promise((()=>{}))}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:e,promise:n}=this.eventManagers[t];return e?Promise.resolve(e):(vt(n,"If manager is not set, promise should be"),n)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch((()=>{delete this.eventManagers[t]})),n}async initAndGetManager(e){const t=await as(e),n=new Hr(e);return t.register("authEvent",(t=>{mt(null==t?void 0:t.authEvent,e,"invalid-auth-event");return{status:n.onEvent(t.authEvent)?"ACK":"ERROR"}}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(gs,{type:gs},(n=>{var r;const s=null===(r=null==n?void 0:n[0])||void 0===r?void 0:r[gs];void 0!==s&&t(!!s),ht(e,"internal-error")}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=Yr(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return gn()||an()||fn()}};var ys="@firebase/auth",vs="1.9.1";class ws{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null===(e=this.auth.currentUser)||void 0===e?void 0:e.uid)||null}async getToken(e){if(this.assertAuthConfigured(),await this.auth._initializationPromise,!this.auth.currentUser)return null;return{accessToken:await this.auth.currentUser.getIdToken(e)}}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged((t=>{e((null==t?void 0:t.stsTokenManager.accessToken)||null)}));this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){mt(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}const _s=g("authIdTokenMaxAge")||300;let Es=null;var Is,Ss;Is={loadJS:e=>new Promise(((t,n)=>{const r=document.createElement("script");r.setAttribute("src",e),r.onload=t,r.onerror=e=>{const t=dt("internal-error");t.customData=e,n(t)},r.type="text/javascript",r.charset="UTF-8",function(){var e,t;return null!==(t=null===(e=document.getElementsByTagName("head"))||void 0===e?void 0:e[0])&&void 0!==t?t:document}().appendChild(r)})),gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="},In=Is,Ss="Browser",We(new R("auth",((e,{options:t})=>{const n=e.getProvider("app").getImmediate(),r=e.getProvider("heartbeat"),s=e.getProvider("app-check-internal"),{apiKey:i,authDomain:o}=n.options;mt(i&&!i.includes(":"),"invalid-api-key",{appName:n.name});const a={apiKey:i,authDomain:o,clientPlatform:Ss,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:mn(Ss)},c=new wn(n,r,s,a);return function(e,t){const n=(null==t?void 0:t.persistence)||[],r=(Array.isArray(n)?n:[n]).map(Zt);(null==t?void 0:t.errorMap)&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(r,null==t?void 0:t.popupRedirectResolver)}(c,t),c}),"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback(((e,t,n)=>{e.getProvider("auth-internal").initialize()}))),We(new R("auth-internal",(e=>(e=>new ws(e))(_n(e.getProvider("auth").getImmediate()))),"PRIVATE").setInstantiationMode("EXPLICIT")),Ke(ys,vs,function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}(Ss)),Ke(ys,vs,"esm2017");Ke("firebase","11.5.0","app");var bs,Ts,As="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},Cs={};(function(){var e;function t(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}function n(e,t,n){n||(n=0);var r=Array(16);if("string"==typeof t)for(var s=0;16>s;++s)r[s]=t.charCodeAt(n++)|t.charCodeAt(n++)<<8|t.charCodeAt(n++)<<16|t.charCodeAt(n++)<<24;else for(s=0;16>s;++s)r[s]=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;t=e.g[0],n=e.g[1],s=e.g[2];var i=e.g[3],o=t+(i^n&(s^i))+r[0]+3614090360&4294967295;o=(n=(s=(i=(t=(n=(s=(i=(t=(n=(s=(i=(t=(n=(s=(i=(t=(n=(s=(i=(t=(n=(s=(i=(t=(n=(s=(i=(t=(n=(s=(i=(t=(n=(s=(i=(t=(n=(s=(i=(t=(n=(s=(i=(t=(n=(s=(i=(t=(n=(s=(i=(t=(n=(s=(i=(t=(n=(s=(i=(t=n+(o<<7&4294967295|o>>>25))+((o=i+(s^t&(n^s))+r[1]+3905402710&4294967295)<<12&4294967295|o>>>20))+((o=s+(n^i&(t^n))+r[2]+606105819&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^s&(i^t))+r[3]+3250441966&4294967295)<<22&4294967295|o>>>10))+((o=t+(i^n&(s^i))+r[4]+4118548399&4294967295)<<7&4294967295|o>>>25))+((o=i+(s^t&(n^s))+r[5]+1200080426&4294967295)<<12&4294967295|o>>>20))+((o=s+(n^i&(t^n))+r[6]+2821735955&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^s&(i^t))+r[7]+4249261313&4294967295)<<22&4294967295|o>>>10))+((o=t+(i^n&(s^i))+r[8]+1770035416&4294967295)<<7&4294967295|o>>>25))+((o=i+(s^t&(n^s))+r[9]+2336552879&4294967295)<<12&4294967295|o>>>20))+((o=s+(n^i&(t^n))+r[10]+4294925233&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^s&(i^t))+r[11]+2304563134&4294967295)<<22&4294967295|o>>>10))+((o=t+(i^n&(s^i))+r[12]+1804603682&4294967295)<<7&4294967295|o>>>25))+((o=i+(s^t&(n^s))+r[13]+4254626195&4294967295)<<12&4294967295|o>>>20))+((o=s+(n^i&(t^n))+r[14]+2792965006&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^s&(i^t))+r[15]+1236535329&4294967295)<<22&4294967295|o>>>10))+((o=t+(s^i&(n^s))+r[1]+4129170786&4294967295)<<5&4294967295|o>>>27))+((o=i+(n^s&(t^n))+r[6]+3225465664&4294967295)<<9&4294967295|o>>>23))+((o=s+(t^n&(i^t))+r[11]+643717713&4294967295)<<14&4294967295|o>>>18))+((o=n+(i^t&(s^i))+r[0]+3921069994&4294967295)<<20&4294967295|o>>>12))+((o=t+(s^i&(n^s))+r[5]+3593408605&4294967295)<<5&4294967295|o>>>27))+((o=i+(n^s&(t^n))+r[10]+38016083&4294967295)<<9&4294967295|o>>>23))+((o=s+(t^n&(i^t))+r[15]+3634488961&4294967295)<<14&4294967295|o>>>18))+((o=n+(i^t&(s^i))+r[4]+3889429448&4294967295)<<20&4294967295|o>>>12))+((o=t+(s^i&(n^s))+r[9]+568446438&4294967295)<<5&4294967295|o>>>27))+((o=i+(n^s&(t^n))+r[14]+3275163606&4294967295)<<9&4294967295|o>>>23))+((o=s+(t^n&(i^t))+r[3]+4107603335&4294967295)<<14&4294967295|o>>>18))+((o=n+(i^t&(s^i))+r[8]+1163531501&4294967295)<<20&4294967295|o>>>12))+((o=t+(s^i&(n^s))+r[13]+2850285829&4294967295)<<5&4294967295|o>>>27))+((o=i+(n^s&(t^n))+r[2]+4243563512&4294967295)<<9&4294967295|o>>>23))+((o=s+(t^n&(i^t))+r[7]+1735328473&4294967295)<<14&4294967295|o>>>18))+((o=n+(i^t&(s^i))+r[12]+2368359562&4294967295)<<20&4294967295|o>>>12))+((o=t+(n^s^i)+r[5]+4294588738&4294967295)<<4&4294967295|o>>>28))+((o=i+(t^n^s)+r[8]+2272392833&4294967295)<<11&4294967295|o>>>21))+((o=s+(i^t^n)+r[11]+1839030562&4294967295)<<16&4294967295|o>>>16))+((o=n+(s^i^t)+r[14]+4259657740&4294967295)<<23&4294967295|o>>>9))+((o=t+(n^s^i)+r[1]+2763975236&4294967295)<<4&4294967295|o>>>28))+((o=i+(t^n^s)+r[4]+1272893353&4294967295)<<11&4294967295|o>>>21))+((o=s+(i^t^n)+r[7]+4139469664&4294967295)<<16&4294967295|o>>>16))+((o=n+(s^i^t)+r[10]+3200236656&4294967295)<<23&4294967295|o>>>9))+((o=t+(n^s^i)+r[13]+681279174&4294967295)<<4&4294967295|o>>>28))+((o=i+(t^n^s)+r[0]+3936430074&4294967295)<<11&4294967295|o>>>21))+((o=s+(i^t^n)+r[3]+3572445317&4294967295)<<16&4294967295|o>>>16))+((o=n+(s^i^t)+r[6]+76029189&4294967295)<<23&4294967295|o>>>9))+((o=t+(n^s^i)+r[9]+3654602809&4294967295)<<4&4294967295|o>>>28))+((o=i+(t^n^s)+r[12]+3873151461&4294967295)<<11&4294967295|o>>>21))+((o=s+(i^t^n)+r[15]+530742520&4294967295)<<16&4294967295|o>>>16))+((o=n+(s^i^t)+r[2]+3299628645&4294967295)<<23&4294967295|o>>>9))+((o=t+(s^(n|~i))+r[0]+4096336452&4294967295)<<6&4294967295|o>>>26))+((o=i+(n^(t|~s))+r[7]+1126891415&4294967295)<<10&4294967295|o>>>22))+((o=s+(t^(i|~n))+r[14]+2878612391&4294967295)<<15&4294967295|o>>>17))+((o=n+(i^(s|~t))+r[5]+4237533241&4294967295)<<21&4294967295|o>>>11))+((o=t+(s^(n|~i))+r[12]+1700485571&4294967295)<<6&4294967295|o>>>26))+((o=i+(n^(t|~s))+r[3]+2399980690&4294967295)<<10&4294967295|o>>>22))+((o=s+(t^(i|~n))+r[10]+4293915773&4294967295)<<15&4294967295|o>>>17))+((o=n+(i^(s|~t))+r[1]+2240044497&4294967295)<<21&4294967295|o>>>11))+((o=t+(s^(n|~i))+r[8]+1873313359&4294967295)<<6&4294967295|o>>>26))+((o=i+(n^(t|~s))+r[15]+4264355552&4294967295)<<10&4294967295|o>>>22))+((o=s+(t^(i|~n))+r[6]+2734768916&4294967295)<<15&4294967295|o>>>17))+((o=n+(i^(s|~t))+r[13]+1309151649&4294967295)<<21&4294967295|o>>>11))+((i=(t=n+((o=t+(s^(n|~i))+r[4]+4149444226&4294967295)<<6&4294967295|o>>>26))+((o=i+(n^(t|~s))+r[11]+3174756917&4294967295)<<10&4294967295|o>>>22))^((s=i+((o=s+(t^(i|~n))+r[2]+718787259&4294967295)<<15&4294967295|o>>>17))|~t))+r[9]+3951481745&4294967295,e.g[0]=e.g[0]+t&4294967295,e.g[1]=e.g[1]+(s+(o<<21&4294967295|o>>>11))&4294967295,e.g[2]=e.g[2]+s&4294967295,e.g[3]=e.g[3]+i&4294967295}function r(e,t){this.h=t;for(var n=[],r=!0,s=e.length-1;0<=s;s--){var i=0|e[s];r&&i==t||(n[s]=i,r=!1)}this.g=n}!function(e,t){function n(){}n.prototype=t.prototype,e.D=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.C=function(e,n,r){for(var s=Array(arguments.length-2),i=2;i<arguments.length;i++)s[i-2]=arguments[i];return t.prototype[n].apply(e,s)}}(t,(function(){this.blockSize=-1})),t.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0},t.prototype.u=function(e,t){void 0===t&&(t=e.length);for(var r=t-this.blockSize,s=this.B,i=this.h,o=0;o<t;){if(0==i)for(;o<=r;)n(this,e,o),o+=this.blockSize;if("string"==typeof e){for(;o<t;)if(s[i++]=e.charCodeAt(o++),i==this.blockSize){n(this,s),i=0;break}}else for(;o<t;)if(s[i++]=e[o++],i==this.blockSize){n(this,s),i=0;break}}this.h=i,this.o+=t},t.prototype.v=function(){var e=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;var n=8*this.o;for(t=e.length-8;t<e.length;++t)e[t]=255&n,n/=256;for(this.u(e),e=Array(16),t=n=0;4>t;++t)for(var r=0;32>r;r+=8)e[n++]=this.g[t]>>>r&255;return e};var s={};function i(e){return-128<=e&&128>e?function(e,t){var n=s;return Object.prototype.hasOwnProperty.call(n,e)?n[e]:n[e]=t(e)}(e,(function(e){return new r([0|e],0>e?-1:0)})):new r([0|e],0>e?-1:0)}function o(e){if(isNaN(e)||!isFinite(e))return a;if(0>e)return d(o(-e));for(var t=[],n=1,s=0;e>=n;s++)t[s]=e/n|0,n*=4294967296;return new r(t,0)}var a=i(0),c=i(1),u=i(16777216);function l(e){if(0!=e.h)return!1;for(var t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function h(e){return-1==e.h}function d(e){for(var t=e.g.length,n=[],s=0;s<t;s++)n[s]=~e.g[s];return new r(n,~e.h).add(c)}function f(e,t){return e.add(d(t))}function p(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function g(e,t){this.g=e,this.h=t}function m(e,t){if(l(t))throw Error("division by zero");if(l(e))return new g(a,a);if(h(e))return t=m(d(e),t),new g(d(t.g),d(t.h));if(h(t))return t=m(e,d(t)),new g(d(t.g),t.h);if(30<e.g.length){if(h(e)||h(t))throw Error("slowDivide_ only works with positive integers.");for(var n=c,r=t;0>=r.l(e);)n=y(n),r=y(r);var s=v(n,1),i=v(r,1);for(r=v(r,2),n=v(n,2);!l(r);){var u=i.add(r);0>=u.l(e)&&(s=s.add(n),i=u),r=v(r,1),n=v(n,1)}return t=f(e,s.j(t)),new g(s,t)}for(s=a;0<=e.l(t);){for(n=Math.max(1,Math.floor(e.m()/t.m())),r=48>=(r=Math.ceil(Math.log(n)/Math.LN2))?1:Math.pow(2,r-48),u=(i=o(n)).j(t);h(u)||0<u.l(e);)u=(i=o(n-=r)).j(t);l(i)&&(i=c),s=s.add(i),e=f(e,u)}return new g(s,e)}function y(e){for(var t=e.g.length+1,n=[],s=0;s<t;s++)n[s]=e.i(s)<<1|e.i(s-1)>>>31;return new r(n,e.h)}function v(e,t){var n=t>>5;t%=32;for(var s=e.g.length-n,i=[],o=0;o<s;o++)i[o]=0<t?e.i(o+n)>>>t|e.i(o+n+1)<<32-t:e.i(o+n);return new r(i,e.h)}(e=r.prototype).m=function(){if(h(this))return-d(this).m();for(var e=0,t=1,n=0;n<this.g.length;n++){var r=this.i(n);e+=(0<=r?r:4294967296+r)*t,t*=4294967296}return e},e.toString=function(e){if(2>(e=e||10)||36<e)throw Error("radix out of range: "+e);if(l(this))return"0";if(h(this))return"-"+d(this).toString(e);for(var t=o(Math.pow(e,6)),n=this,r="";;){var s=m(n,t).g,i=((0<(n=f(n,s.j(t))).g.length?n.g[0]:n.h)>>>0).toString(e);if(l(n=s))return i+r;for(;6>i.length;)i="0"+i;r=i+r}},e.i=function(e){return 0>e?0:e<this.g.length?this.g[e]:this.h},e.l=function(e){return h(e=f(this,e))?-1:l(e)?0:1},e.abs=function(){return h(this)?d(this):this},e.add=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],s=0,i=0;i<=t;i++){var o=s+(65535&this.i(i))+(65535&e.i(i)),a=(o>>>16)+(this.i(i)>>>16)+(e.i(i)>>>16);s=a>>>16,o&=65535,a&=65535,n[i]=a<<16|o}return new r(n,-2147483648&n[n.length-1]?-1:0)},e.j=function(e){if(l(this)||l(e))return a;if(h(this))return h(e)?d(this).j(d(e)):d(d(this).j(e));if(h(e))return d(this.j(d(e)));if(0>this.l(u)&&0>e.l(u))return o(this.m()*e.m());for(var t=this.g.length+e.g.length,n=[],s=0;s<2*t;s++)n[s]=0;for(s=0;s<this.g.length;s++)for(var i=0;i<e.g.length;i++){var c=this.i(s)>>>16,f=65535&this.i(s),g=e.i(i)>>>16,m=65535&e.i(i);n[2*s+2*i]+=f*m,p(n,2*s+2*i),n[2*s+2*i+1]+=c*m,p(n,2*s+2*i+1),n[2*s+2*i+1]+=f*g,p(n,2*s+2*i+1),n[2*s+2*i+2]+=c*g,p(n,2*s+2*i+2)}for(s=0;s<t;s++)n[s]=n[2*s+1]<<16|n[2*s];for(s=t;s<2*t;s++)n[s]=0;return new r(n,0)},e.A=function(e){return m(this,e).h},e.and=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],s=0;s<t;s++)n[s]=this.i(s)&e.i(s);return new r(n,this.h&e.h)},e.or=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],s=0;s<t;s++)n[s]=this.i(s)|e.i(s);return new r(n,this.h|e.h)},e.xor=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],s=0;s<t;s++)n[s]=this.i(s)^e.i(s);return new r(n,this.h^e.h)},t.prototype.digest=t.prototype.v,t.prototype.reset=t.prototype.s,t.prototype.update=t.prototype.u,Ts=Cs.Md5=t,r.prototype.add=r.prototype.add,r.prototype.multiply=r.prototype.j,r.prototype.modulo=r.prototype.A,r.prototype.compare=r.prototype.l,r.prototype.toNumber=r.prototype.m,r.prototype.toString=r.prototype.toString,r.prototype.getBits=r.prototype.i,r.fromNumber=o,r.fromString=function e(t,n){if(0==t.length)throw Error("number format error: empty string");if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if("-"==t.charAt(0))return d(e(t.substring(1),n));if(0<=t.indexOf("-"))throw Error('number format error: interior "-" character');for(var r=o(Math.pow(n,8)),s=a,i=0;i<t.length;i+=8){var c=Math.min(8,t.length-i),u=parseInt(t.substring(i,i+c),n);8>c?(c=o(Math.pow(n,c)),s=s.j(c).add(o(u))):s=(s=s.j(r)).add(o(u))}return s},bs=Cs.Integer=r}).apply(void 0!==As?As:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var ks,Ns,Ds,Rs,Os,Ps,Ls,Ms,xs="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},Us={};(function(){var e,t="function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,n){return e==Array.prototype||e==Object.prototype||(e[t]=n.value),e};var n=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof xs&&xs];for(var t=0;t<e.length;++t){var n=e[t];if(n&&n.Math==Math)return n}throw Error("Cannot find global object")}(this);!function(e,r){if(r)e:{var s=n;e=e.split(".");for(var i=0;i<e.length-1;i++){var o=e[i];if(!(o in s))break e;s=s[o]}(r=r(i=s[e=e[e.length-1]]))!=i&&null!=r&&t(s,e,{configurable:!0,writable:!0,value:r})}}("Array.prototype.values",(function(e){return e||function(){return function(e,t){e instanceof String&&(e+="");var n=0,r=!1,s={next:function(){if(!r&&n<e.length){var s=n++;return{value:t(s,e[s]),done:!1}}return r=!0,{done:!0,value:void 0}}};return s[Symbol.iterator]=function(){return s},s}(this,(function(e,t){return t}))}}));var r=r||{},s=this||self;function i(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function o(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}function a(e,t,n){return e.call.apply(e.bind,arguments)}function c(e,t,n){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function u(e,t,n){return(u=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?a:c).apply(null,arguments)}function l(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function h(e,t){function n(){}n.prototype=t.prototype,e.aa=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.Qb=function(e,n,r){for(var s=Array(arguments.length-2),i=2;i<arguments.length;i++)s[i-2]=arguments[i];return t.prototype[n].apply(e,s)}}function d(e){const t=e.length;if(0<t){const n=Array(t);for(let r=0;r<t;r++)n[r]=e[r];return n}return[]}function f(e,t){for(let t=1;t<arguments.length;t++){const n=arguments[t];if(i(n)){const t=e.length||0,r=n.length||0;e.length=t+r;for(let s=0;s<r;s++)e[t+s]=n[s]}else e.push(n)}}function p(e){return/^[\s\xa0]*$/.test(e)}function g(){var e=s.navigator;return e&&(e=e.userAgent)?e:""}function m(e){return m[" "](e),e}m[" "]=function(){};var y=!(-1==g().indexOf("Gecko")||-1!=g().toLowerCase().indexOf("webkit")&&-1==g().indexOf("Edge")||-1!=g().indexOf("Trident")||-1!=g().indexOf("MSIE")||-1!=g().indexOf("Edge"));function v(e,t,n){for(const r in e)t.call(n,e[r],r,e)}function w(e){const t={};for(const n in e)t[n]=e[n];return t}const _="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function E(e,t){let n,r;for(let t=1;t<arguments.length;t++){for(n in r=arguments[t],r)e[n]=r[n];for(let t=0;t<_.length;t++)n=_[t],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}function I(e){var t=1;e=e.split(":");const n=[];for(;0<t&&e.length;)n.push(e.shift()),t--;return e.length&&n.push(e.join(":")),n}function S(e){s.setTimeout((()=>{throw e}),0)}function b(){var e=N;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var T=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}((()=>new A),(e=>e.reset()));class A{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}let C,k=!1,N=new class{constructor(){this.h=this.g=null}add(e,t){const n=T.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}},D=()=>{const e=s.Promise.resolve(void 0);C=()=>{e.then(R)}};var R=()=>{for(var e;e=b();){try{e.h.call(e.g)}catch(e){S(e)}var t=T;t.j(e),100>t.h&&(t.h++,e.next=t.g,t.g=e)}k=!1};function O(){this.s=this.s,this.C=this.C}function P(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}O.prototype.s=!1,O.prototype.ma=function(){this.s||(this.s=!0,this.N())},O.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},P.prototype.h=function(){this.defaultPrevented=!0};var L=function(){if(!s.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{const e=()=>{};s.addEventListener("test",e,t),s.removeEventListener("test",e,t)}catch(e){}return e}();function M(e,t){if(P.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(y){e:{try{m(t.nodeName);var s=!0;break e}catch(e){}s=!1}s||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:x[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&M.aa.h.call(this)}}h(M,P);var x={2:"touch",3:"pen",4:"mouse"};M.prototype.h=function(){M.aa.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var U="closure_listenable_"+(1e6*Math.random()|0),F=0;function V(e,t,n,r,s){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.ha=s,this.key=++F,this.da=this.fa=!1}function W(e){e.da=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function j(e){this.src=e,this.g={},this.h=0}function $(e,t){var n=t.type;if(n in e.g){var r,s=e.g[n],i=Array.prototype.indexOf.call(s,t,void 0);(r=0<=i)&&Array.prototype.splice.call(s,i,1),r&&(W(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function B(e,t,n,r){for(var s=0;s<e.length;++s){var i=e[s];if(!i.da&&i.listener==t&&i.capture==!!n&&i.ha==r)return s}return-1}j.prototype.add=function(e,t,n,r,s){var i=e.toString();(e=this.g[i])||(e=this.g[i]=[],this.h++);var o=B(e,t,r,s);return-1<o?(t=e[o],n||(t.fa=!1)):((t=new V(t,this.src,i,!!r,s)).fa=n,e.push(t)),t};var q="closure_lm_"+(1e6*Math.random()|0),z={};function H(e,t,n,r,s){if(r&&r.once)return K(e,t,n,r,s);if(Array.isArray(t)){for(var i=0;i<t.length;i++)H(e,t[i],n,r,s);return null}return n=te(n),e&&e[U]?e.K(t,n,o(r)?!!r.capture:!!r,s):G(e,t,n,!1,r,s)}function G(e,t,n,r,s,i){if(!t)throw Error("Invalid event type");var a=o(s)?!!s.capture:!!s,c=Z(e);if(c||(e[q]=c=new j(e)),(n=c.add(t,n,r,a,i)).proxy)return n;if(r=function(){function e(n){return t.call(e.src,e.listener,n)}const t=X;return e}(),n.proxy=r,r.src=e,r.listener=n,e.addEventListener)L||(s=a),void 0===s&&(s=!1),e.addEventListener(t.toString(),r,s);else if(e.attachEvent)e.attachEvent(Y(t.toString()),r);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(r)}return n}function K(e,t,n,r,s){if(Array.isArray(t)){for(var i=0;i<t.length;i++)K(e,t[i],n,r,s);return null}return n=te(n),e&&e[U]?e.L(t,n,o(r)?!!r.capture:!!r,s):G(e,t,n,!0,r,s)}function Q(e,t,n,r,s){if(Array.isArray(t))for(var i=0;i<t.length;i++)Q(e,t[i],n,r,s);else r=o(r)?!!r.capture:!!r,n=te(n),e&&e[U]?(e=e.i,(t=String(t).toString())in e.g&&(-1<(n=B(i=e.g[t],n,r,s))&&(W(i[n]),Array.prototype.splice.call(i,n,1),0==i.length&&(delete e.g[t],e.h--)))):e&&(e=Z(e))&&(t=e.g[t.toString()],e=-1,t&&(e=B(t,n,r,s)),(n=-1<e?t[e]:null)&&J(n))}function J(e){if("number"!=typeof e&&e&&!e.da){var t=e.src;if(t&&t[U])$(t.i,e);else{var n=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(Y(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=Z(t))?($(n,e),0==n.h&&(n.src=null,t[q]=null)):W(e)}}}function Y(e){return e in z?z[e]:z[e]="on"+e}function X(e,t){if(e.da)e=!0;else{t=new M(t,this);var n=e.listener,r=e.ha||e.src;e.fa&&J(e),e=n.call(r,t)}return e}function Z(e){return(e=e[q])instanceof j?e:null}var ee="__closure_events_fn_"+(1e9*Math.random()>>>0);function te(e){return"function"==typeof e?e:(e[ee]||(e[ee]=function(t){return e.handleEvent(t)}),e[ee])}function ne(){O.call(this),this.i=new j(this),this.M=this,this.F=null}function re(e,t){var n,r=e.F;if(r)for(n=[];r;r=r.F)n.push(r);if(e=e.M,r=t.type||t,"string"==typeof t)t=new P(t,e);else if(t instanceof P)t.target=t.target||e;else{var s=t;E(t=new P(r,e),s)}if(s=!0,n)for(var i=n.length-1;0<=i;i--){var o=t.g=n[i];s=se(o,r,!0,t)&&s}if(s=se(o=t.g=e,r,!0,t)&&s,s=se(o,r,!1,t)&&s,n)for(i=0;i<n.length;i++)s=se(o=t.g=n[i],r,!1,t)&&s}function se(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var s=!0,i=0;i<t.length;++i){var o=t[i];if(o&&!o.da&&o.capture==n){var a=o.listener,c=o.ha||o.src;o.fa&&$(e.i,o),s=!1!==a.call(c,r)&&s}}return s&&!r.defaultPrevented}function ie(e,t,n){if("function"==typeof e)n&&(e=u(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=u(e.handleEvent,e)}return 2147483647<Number(t)?-1:s.setTimeout(e,t||0)}function oe(e){e.g=ie((()=>{e.g=null,e.i&&(e.i=!1,oe(e))}),e.l);const t=e.h;e.h=null,e.m.apply(null,t)}h(ne,O),ne.prototype[U]=!0,ne.prototype.removeEventListener=function(e,t,n,r){Q(this,e,t,n,r)},ne.prototype.N=function(){if(ne.aa.N.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],r=0;r<n.length;r++)W(n[r]);delete t.g[e],t.h--}}this.F=null},ne.prototype.K=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},ne.prototype.L=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};class ae extends O{constructor(e,t){super(),this.m=e,this.l=t,this.h=null,this.i=!1,this.g=null}j(e){this.h=arguments,this.g?this.i=!0:oe(this)}N(){super.N(),this.g&&(s.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ce(e){O.call(this),this.h=e,this.g={}}h(ce,O);var ue=[];function le(e){v(e.g,(function(e,t){this.g.hasOwnProperty(t)&&J(e)}),e),e.g={}}ce.prototype.N=function(){ce.aa.N.call(this),le(this)},ce.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var he=s.JSON.stringify,de=s.JSON.parse,fe=class{stringify(e){return s.JSON.stringify(e,void 0)}parse(e){return s.JSON.parse(e,void 0)}};function pe(){}function ge(e){return e.h||(e.h=e.i())}function me(){}pe.prototype.h=null;var ye={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function ve(){P.call(this,"d")}function we(){P.call(this,"c")}h(ve,P),h(we,P);var _e={},Ee=null;function Ie(){return Ee=Ee||new ne}function Se(e){P.call(this,_e.La,e)}function be(e){const t=Ie();re(t,new Se(t))}function Te(e,t){P.call(this,_e.STAT_EVENT,e),this.stat=t}function Ae(e){const t=Ie();re(t,new Te(t,e))}function Ce(e,t){P.call(this,_e.Ma,e),this.size=t}function ke(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return s.setTimeout((function(){e()}),t)}function Ne(){this.g=!0}function De(e,t,n,r){e.info((function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n)for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(2>r.length)){var s=r[1];if(Array.isArray(s)&&!(1>s.length)){var i=s[0];if("noop"!=i&&"stop"!=i&&"close"!=i)for(var o=1;o<s.length;o++)s[o]=""}}}return he(n)}catch(e){return t}}(e,n)+(r?" "+r:"")}))}_e.La="serverreachability",h(Se,P),_e.STAT_EVENT="statevent",h(Te,P),_e.Ma="timingevent",h(Ce,P),Ne.prototype.xa=function(){this.g=!1},Ne.prototype.info=function(){};var Re,Oe={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Pe={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"};function Le(){}function Me(e,t,n,r){this.j=e,this.i=t,this.l=n,this.R=r||1,this.U=new ce(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new xe}function xe(){this.i=null,this.g="",this.h=!1}h(Le,pe),Le.prototype.g=function(){return new XMLHttpRequest},Le.prototype.i=function(){return{}},Re=new Le;var Ue={},Fe={};function Ve(e,t,n){e.L=1,e.v=ht(ot(t)),e.m=n,e.P=!0,We(e,null)}function We(e,t){e.F=Date.now(),Be(e),e.A=ot(e.v);var n=e.A,r=e.R;Array.isArray(r)||(r=[String(r)]),Tt(n.i,"t",r),e.C=0,n=e.j.J,e.h=new xe,e.g=fn(e.j,n?t:null,!e.m),0<e.O&&(e.M=new ae(u(e.Y,e,e.g),e.O)),t=e.U,n=e.g,r=e.ca;var s="readystatechange";Array.isArray(s)||(s&&(ue[0]=s.toString()),s=ue);for(var i=0;i<s.length;i++){var o=H(n,s[i],r||t.handleEvent,!1,t.h||t);if(!o)break;t.g[o.key]=o}t=e.H?w(e.H):{},e.m?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.A,e.u,e.m,t)):(e.u="GET",e.g.ea(e.A,e.u,null,t)),be(),function(e,t,n,r,s,i){e.info((function(){if(e.g)if(i)for(var o="",a=i.split("&"),c=0;c<a.length;c++){var u=a[c].split("=");if(1<u.length){var l=u[0];u=u[1];var h=l.split("_");o=2<=h.length&&"type"==h[1]?o+(l+"=")+u+"&":o+(l+"=redacted&")}}else o=null;else o=i;return"XMLHTTP REQ ("+r+") [attempt "+s+"]: "+t+"\n"+n+"\n"+o}))}(e.i,e.u,e.A,e.l,e.R,e.m)}function je(e){return!!e.g&&("GET"==e.u&&2!=e.L&&e.j.Ca)}function $e(e,t){var n=e.C,r=t.indexOf("\n",n);return-1==r?Fe:(n=Number(t.substring(n,r)),isNaN(n)?Ue:(r+=1)+n>t.length?Fe:(t=t.slice(r,r+n),e.C=r+n,t))}function Be(e){e.S=Date.now()+e.I,qe(e,e.I)}function qe(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=ke(u(e.ba,e),t)}function ze(e){e.B&&(s.clearTimeout(e.B),e.B=null)}function He(e){0==e.j.G||e.J||cn(e.j,e)}function Ge(e){ze(e);var t=e.M;t&&"function"==typeof t.ma&&t.ma(),e.M=null,le(e.U),e.g&&(t=e.g,e.g=null,t.abort(),t.ma())}function Ke(e,t){try{var n=e.j;if(0!=n.G&&(n.g==e||Ze(n.h,e)))if(!e.K&&Ze(n.h,e)&&3==n.G){try{var r=n.Da.g.parse(t)}catch(e){r=null}if(Array.isArray(r)&&3==r.length){var s=r;if(0==s[0]){e:if(!n.u){if(n.g){if(!(n.g.F+3e3<e.F))break e;an(n),Jt(n)}rn(n),Ae(18)}}else n.za=s[1],0<n.za-n.T&&37500>s[2]&&n.F&&0==n.v&&!n.C&&(n.C=ke(u(n.Za,n),6e3));if(1>=Xe(n.h)&&n.ca){try{n.ca()}catch(e){}n.ca=void 0}}else ln(n,11)}else if((e.K||n.g==e)&&an(n),!p(t))for(s=n.Da.g.parse(t),t=0;t<s.length;t++){let u=s[t];if(n.T=u[0],u=u[1],2==n.G)if("c"==u[0]){n.K=u[1],n.ia=u[2];const t=u[3];null!=t&&(n.la=t,n.j.info("VER="+n.la));const s=u[4];null!=s&&(n.Aa=s,n.j.info("SVER="+n.Aa));const l=u[5];null!=l&&"number"==typeof l&&0<l&&(r=1.5*l,n.L=r,n.j.info("backChannelRequestTimeoutMs_="+r)),r=n;const h=e.g;if(h){const e=h.g?h.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var i=r.h;i.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(i.j=i.l,i.g=new Set,i.h&&(et(i,i.h),i.h=null))}if(r.D){const e=h.g?h.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(r.ya=e,lt(r.I,r.D,e))}}n.G=3,n.l&&n.l.ua(),n.ba&&(n.R=Date.now()-e.F,n.j.info("Handshake RTT: "+n.R+"ms"));var o=e;if((r=n).qa=dn(r,r.J?r.ia:null,r.W),o.K){tt(r.h,o);var a=o,c=r.L;c&&(a.I=c),a.B&&(ze(a),Be(a)),r.g=o}else nn(r);0<n.i.length&&Xt(n)}else"stop"!=u[0]&&"close"!=u[0]||ln(n,7);else 3==n.G&&("stop"==u[0]||"close"==u[0]?"stop"==u[0]?ln(n,7):Qt(n):"noop"!=u[0]&&n.l&&n.l.ta(u),n.v=0)}be()}catch(e){}}Me.prototype.ca=function(e){e=e.target;const t=this.M;t&&3==zt(e)?t.j():this.Y(e)},Me.prototype.Y=function(e){try{if(e==this.g)e:{const d=zt(this.g);var t=this.g.Ba();this.g.Z();if(!(3>d)&&(3!=d||this.g&&(this.h.h||this.g.oa()||Ht(this.g)))){this.J||4!=d||7==t||be(),ze(this);var n=this.g.Z();this.X=n;t:if(je(this)){var r=Ht(this.g);e="";var i=r.length,o=4==zt(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){Ge(this),He(this);var a="";break t}this.h.i=new s.TextDecoder}for(t=0;t<i;t++)this.h.h=!0,e+=this.h.i.decode(r[t],{stream:!(o&&t==i-1)});r.length=0,this.h.g+=e,this.C=0,a=this.h.g}else a=this.g.oa();if(this.o=200==n,function(e,t,n,r,s,i,o){e.info((function(){return"XMLHTTP RESP ("+r+") [ attempt "+s+"]: "+t+"\n"+n+"\n"+i+" "+o}))}(this.i,this.u,this.A,this.l,this.R,d,n),this.o){if(this.T&&!this.K){t:{if(this.g){var c,u=this.g;if((c=u.g?u.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!p(c)){var l=c;break t}}l=null}if(!(n=l)){this.o=!1,this.s=3,Ae(12),Ge(this),He(this);break e}De(this.i,this.l,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Ke(this,n)}if(this.P){let e;for(n=!0;!this.J&&this.C<a.length;){if(e=$e(this,a),e==Fe){4==d&&(this.s=4,Ae(14),n=!1),De(this.i,this.l,null,"[Incomplete Response]");break}if(e==Ue){this.s=4,Ae(15),De(this.i,this.l,a,"[Invalid Chunk]"),n=!1;break}De(this.i,this.l,e,null),Ke(this,e)}if(je(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=d||0!=a.length||this.h.h||(this.s=1,Ae(16),n=!1),this.o=this.o&&n,n){if(0<a.length&&!this.W){this.W=!0;var h=this.j;h.g==this&&h.ba&&!h.M&&(h.j.info("Great, no buffering proxy detected. Bytes received: "+a.length),sn(h),h.M=!0,Ae(11))}}else De(this.i,this.l,a,"[Invalid Chunked Response]"),Ge(this),He(this)}else De(this.i,this.l,a,null),Ke(this,a);4==d&&Ge(this),this.o&&!this.J&&(4==d?cn(this.j,this):(this.o=!1,Be(this)))}else(function(e){const t={};e=(e.g&&2<=zt(e)&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let r=0;r<e.length;r++){if(p(e[r]))continue;var n=I(e[r]);const s=n[0];if("string"!=typeof(n=n[1]))continue;n=n.trim();const i=t[s]||[];t[s]=i,i.push(n)}!function(e,t){for(const n in e)t.call(void 0,e[n],n,e)}(t,(function(e){return e.join(", ")}))})(this.g),400==n&&0<a.indexOf("Unknown SID")?(this.s=3,Ae(12)):(this.s=0,Ae(13)),Ge(this),He(this)}}}catch(e){}},Me.prototype.cancel=function(){this.J=!0,Ge(this)},Me.prototype.ba=function(){this.B=null;const e=Date.now();0<=e-this.S?(function(e,t){e.info((function(){return"TIMEOUT: "+t}))}(this.i,this.A),2!=this.L&&(be(),Ae(17)),Ge(this),this.s=2,He(this)):qe(this,this.S-e)};var Qe=class{constructor(e,t){this.g=e,this.map=t}};function Je(e){this.l=e||10,s.PerformanceNavigationTiming?e=0<(e=s.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):e=!!(s.chrome&&s.chrome.loadTimes&&s.chrome.loadTimes()&&s.chrome.loadTimes().wasFetchedViaSpdy),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Ye(e){return!!e.h||!!e.g&&e.g.size>=e.j}function Xe(e){return e.h?1:e.g?e.g.size:0}function Ze(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function et(e,t){e.g?e.g.add(t):e.h=t}function tt(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function nt(e){if(null!=e.h)return e.i.concat(e.h.D);if(null!=e.g&&0!==e.g.size){let t=e.i;for(const n of e.g.values())t=t.concat(n.D);return t}return d(e.i)}function rt(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(i(e)||"string"==typeof e)Array.prototype.forEach.call(e,t,void 0);else for(var n=function(e){if(e.na&&"function"==typeof e.na)return e.na();if(!e.V||"function"!=typeof e.V){if("undefined"!=typeof Map&&e instanceof Map)return Array.from(e.keys());if(!("undefined"!=typeof Set&&e instanceof Set)){if(i(e)||"string"==typeof e){var t=[];e=e.length;for(var n=0;n<e;n++)t.push(n);return t}t=[],n=0;for(const r in e)t[n++]=r;return t}}}(e),r=function(e){if(e.V&&"function"==typeof e.V)return e.V();if("undefined"!=typeof Map&&e instanceof Map||"undefined"!=typeof Set&&e instanceof Set)return Array.from(e.values());if("string"==typeof e)return e.split("");if(i(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}for(r in t=[],n=0,e)t[n++]=e[r];return t}(e),s=r.length,o=0;o<s;o++)t.call(void 0,r[o],n&&n[o],e)}Je.prototype.cancel=function(){if(this.i=nt(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const e of this.g.values())e.cancel();this.g.clear()}};var st=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function it(e){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,e instanceof it){this.h=e.h,at(this,e.j),this.o=e.o,this.g=e.g,ct(this,e.s),this.l=e.l;var t=e.i,n=new Et;n.i=t.i,t.g&&(n.g=new Map(t.g),n.h=t.h),ut(this,n),this.m=e.m}else e&&(t=String(e).match(st))?(this.h=!1,at(this,t[1]||"",!0),this.o=dt(t[2]||""),this.g=dt(t[3]||"",!0),ct(this,t[4]),this.l=dt(t[5]||"",!0),ut(this,t[6]||"",!0),this.m=dt(t[7]||"")):(this.h=!1,this.i=new Et(null,this.h))}function ot(e){return new it(e)}function at(e,t,n){e.j=n?dt(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function ct(e,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);e.s=t}else e.s=null}function ut(e,t,n){t instanceof Et?(e.i=t,function(e,t){t&&!e.j&&(It(e),e.i=null,e.g.forEach((function(e,t){var n=t.toLowerCase();t!=n&&(St(this,t),Tt(this,n,e))}),e)),e.j=t}(e.i,e.h)):(n||(t=ft(t,wt)),e.i=new Et(t,e.h))}function lt(e,t,n){e.i.set(t,n)}function ht(e){return lt(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function dt(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function ft(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,pt),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function pt(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}it.prototype.toString=function(){var e=[],t=this.j;t&&e.push(ft(t,mt,!0),":");var n=this.g;return(n||"file"==t)&&(e.push("//"),(t=this.o)&&e.push(ft(t,mt,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.s)&&e.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(ft(n,"/"==n.charAt(0)?vt:yt,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.m)&&e.push("#",ft(n,_t)),e.join("")};var gt,mt=/[#\/\?@]/g,yt=/[#\?:]/g,vt=/[#\?]/g,wt=/[#\?@]/g,_t=/#/g;function Et(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function It(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var r=e[n].indexOf("="),s=null;if(0<=r){var i=e[n].substring(0,r);s=e[n].substring(r+1)}else i=e[n];t(i,s?decodeURIComponent(s.replace(/\+/g," ")):"")}}}(e.i,(function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)})))}function St(e,t){It(e),t=At(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function bt(e,t){return It(e),t=At(e,t),e.g.has(t)}function Tt(e,t,n){St(e,t),0<n.length&&(e.i=null,e.g.set(At(e,t),d(n)),e.h+=n.length)}function At(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function Ct(e,t,n,r,s){try{s&&(s.onload=null,s.onerror=null,s.onabort=null,s.ontimeout=null),r(n)}catch(e){}}function kt(){this.g=new fe}function Nt(e,t,n){const r=n||"";try{rt(e,(function(e,n){let s=e;o(e)&&(s=he(e)),t.push(r+n+"="+encodeURIComponent(s))}))}catch(e){throw t.push(r+"type="+encodeURIComponent("_badmap")),e}}function Dt(e){this.l=e.Ub||null,this.j=e.eb||!1}function Rt(e,t){ne.call(this),this.D=e,this.o=t,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}function Ot(e){e.j.read().then(e.Pa.bind(e)).catch(e.ga.bind(e))}function Pt(e){e.readyState=4,e.l=null,e.j=null,e.v=null,Lt(e)}function Lt(e){e.onreadystatechange&&e.onreadystatechange.call(e)}function Mt(e){let t="";return v(e,(function(e,n){t+=n,t+=":",t+=e,t+="\r\n"})),t}function xt(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=Mt(n),"string"==typeof e?null!=n&&encodeURIComponent(String(n)):lt(e,t,n))}function Ut(e){ne.call(this),this.headers=new Map,this.o=e||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}(e=Et.prototype).add=function(e,t){It(this),this.i=null,e=At(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},e.forEach=function(e,t){It(this),this.g.forEach((function(n,r){n.forEach((function(n){e.call(t,n,r,this)}),this)}),this)},e.na=function(){It(this);const e=Array.from(this.g.values()),t=Array.from(this.g.keys()),n=[];for(let r=0;r<t.length;r++){const s=e[r];for(let e=0;e<s.length;e++)n.push(t[r])}return n},e.V=function(e){It(this);let t=[];if("string"==typeof e)bt(this,e)&&(t=t.concat(this.g.get(At(this,e))));else{e=Array.from(this.g.values());for(let n=0;n<e.length;n++)t=t.concat(e[n])}return t},e.set=function(e,t){return It(this),this.i=null,bt(this,e=At(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},e.get=function(e,t){return e&&0<(e=this.V(e)).length?String(e[0]):t},e.toString=function(){if(this.i)return this.i;if(!this.g)return"";const e=[],t=Array.from(this.g.keys());for(var n=0;n<t.length;n++){var r=t[n];const i=encodeURIComponent(String(r)),o=this.V(r);for(r=0;r<o.length;r++){var s=i;""!==o[r]&&(s+="="+encodeURIComponent(String(o[r]))),e.push(s)}}return this.i=e.join("&")},h(Dt,pe),Dt.prototype.g=function(){return new Rt(this.l,this.j)},Dt.prototype.i=(gt={},function(){return gt}),h(Rt,ne),(e=Rt.prototype).open=function(e,t){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.B=e,this.A=t,this.readyState=1,Lt(this)},e.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const t={headers:this.u,method:this.B,credentials:this.m,cache:void 0};e&&(t.body=e),(this.D||s).fetch(new Request(this.A,t)).then(this.Sa.bind(this),this.ga.bind(this))},e.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch((()=>{})),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Pt(this)),this.readyState=0},e.Sa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,Lt(this)),this.g&&(this.readyState=3,Lt(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(void 0!==s.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Ot(this)}else e.text().then(this.Ra.bind(this),this.ga.bind(this))},e.Pa=function(e){if(this.g){if(this.o&&e.value)this.response.push(e.value);else if(!this.o){var t=e.value?e.value:new Uint8Array(0);(t=this.v.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?Pt(this):Lt(this),3==this.readyState&&Ot(this)}},e.Ra=function(e){this.g&&(this.response=this.responseText=e,Pt(this))},e.Qa=function(e){this.g&&(this.response=e,Pt(this))},e.ga=function(){this.g&&Pt(this)},e.setRequestHeader=function(e,t){this.u.append(e,t)},e.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},e.getAllResponseHeaders=function(){if(!this.h)return"";const e=[],t=this.h.entries();for(var n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(Rt.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}}),h(Ut,ne);var Ft=/^https?$/i,Vt=["POST","PUT"];function Wt(e,t){e.h=!1,e.g&&(e.j=!0,e.g.abort(),e.j=!1),e.l=t,e.m=5,jt(e),Bt(e)}function jt(e){e.A||(e.A=!0,re(e,"complete"),re(e,"error"))}function $t(e){if(e.h&&void 0!==r&&(!e.v[1]||4!=zt(e)||2!=e.Z()))if(e.u&&4==zt(e))ie(e.Ea,0,e);else if(re(e,"readystatechange"),4==zt(e)){e.h=!1;try{const r=e.Z();e:switch(r){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t=!0;break e;default:t=!1}var n;if(!(n=t)){var i;if(i=0===r){var o=String(e.D).match(st)[1]||null;!o&&s.self&&s.self.location&&(o=s.self.location.protocol.slice(0,-1)),i=!Ft.test(o?o.toLowerCase():"")}n=i}if(n)re(e,"complete"),re(e,"success");else{e.m=6;try{var a=2<zt(e)?e.g.statusText:""}catch(e){a=""}e.l=a+" ["+e.Z()+"]",jt(e)}}finally{Bt(e)}}}function Bt(e,t){if(e.g){qt(e);const n=e.g,r=e.v[0]?()=>{}:null;e.g=null,e.v=null,t||re(e,"ready");try{n.onreadystatechange=r}catch(e){}}}function qt(e){e.I&&(s.clearTimeout(e.I),e.I=null)}function zt(e){return e.g?e.g.readyState:0}function Ht(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.H){case"":case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function Gt(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function Kt(e){this.Aa=0,this.i=[],this.j=new Ne,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Gt("failFast",!1,e),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Gt("baseRetryDelayMs",5e3,e),this.cb=Gt("retryDelaySeedMs",1e4,e),this.Wa=Gt("forwardChannelMaxRetries",2,e),this.wa=Gt("forwardChannelRequestTimeoutMs",2e4,e),this.pa=e&&e.xmlHttpFactory||void 0,this.Xa=e&&e.Tb||void 0,this.Ca=e&&e.useFetchStreams||!1,this.L=void 0,this.J=e&&e.supportsCrossDomainXhr||!1,this.K="",this.h=new Je(e&&e.concurrentRequestLimit),this.Da=new kt,this.P=e&&e.fastHandshake||!1,this.O=e&&e.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=e&&e.Rb||!1,e&&e.xa&&this.j.xa(),e&&e.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&e&&e.detectBufferingProxy||!1,this.ja=void 0,e&&e.longPollingTimeout&&0<e.longPollingTimeout&&(this.ja=e.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}function Qt(e){if(Yt(e),3==e.G){var t=e.U++,n=ot(e.I);if(lt(n,"SID",e.K),lt(n,"RID",t),lt(n,"TYPE","terminate"),en(e,n),(t=new Me(e,e.j,t)).L=2,t.v=ht(ot(n)),n=!1,s.navigator&&s.navigator.sendBeacon)try{n=s.navigator.sendBeacon(t.v.toString(),"")}catch(e){}!n&&s.Image&&((new Image).src=t.v,n=!0),n||(t.g=fn(t.j,null),t.g.ea(t.v)),t.F=Date.now(),Be(t)}hn(e)}function Jt(e){e.g&&(sn(e),e.g.cancel(),e.g=null)}function Yt(e){Jt(e),e.u&&(s.clearTimeout(e.u),e.u=null),an(e),e.h.cancel(),e.s&&("number"==typeof e.s&&s.clearTimeout(e.s),e.s=null)}function Xt(e){if(!Ye(e.h)&&!e.s){e.s=!0;var t=e.Ga;C||D(),k||(C(),k=!0),N.add(t,e),e.B=0}}function Zt(e,t){var n;n=t?t.l:e.U++;const r=ot(e.I);lt(r,"SID",e.K),lt(r,"RID",n),lt(r,"AID",e.T),en(e,r),e.m&&e.o&&xt(r,e.m,e.o),n=new Me(e,e.j,n,e.B+1),null===e.m&&(n.H=e.o),t&&(e.i=t.D.concat(e.i)),t=tn(e,n,1e3),n.I=Math.round(.5*e.wa)+Math.round(.5*e.wa*Math.random()),et(e.h,n),Ve(n,r,t)}function en(e,t){e.H&&v(e.H,(function(e,n){lt(t,n,e)})),e.l&&rt({},(function(e,n){lt(t,n,e)}))}function tn(e,t,n){n=Math.min(e.i.length,n);var r=e.l?u(e.l.Na,e.l,e):null;e:{var s=e.i;let t=-1;for(;;){const e=["count="+n];-1==t?0<n?(t=s[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let i=!0;for(let o=0;o<n;o++){let n=s[o].g;const a=s[o].map;if(n-=t,0>n)t=Math.max(0,s[o].g-100),i=!1;else try{Nt(a,e,"req"+n+"_")}catch(e){r&&r(a)}}if(i){r=e.join("&");break e}}}return e=e.i.splice(0,n),t.D=e,r}function nn(e){if(!e.g&&!e.u){e.Y=1;var t=e.Fa;C||D(),k||(C(),k=!0),N.add(t,e),e.v=0}}function rn(e){return!(e.g||e.u||3<=e.v)&&(e.Y++,e.u=ke(u(e.Fa,e),un(e,e.v)),e.v++,!0)}function sn(e){null!=e.A&&(s.clearTimeout(e.A),e.A=null)}function on(e){e.g=new Me(e,e.j,"rpc",e.Y),null===e.m&&(e.g.H=e.o),e.g.O=0;var t=ot(e.qa);lt(t,"RID","rpc"),lt(t,"SID",e.K),lt(t,"AID",e.T),lt(t,"CI",e.F?"0":"1"),!e.F&&e.ja&&lt(t,"TO",e.ja),lt(t,"TYPE","xmlhttp"),en(e,t),e.m&&e.o&&xt(t,e.m,e.o),e.L&&(e.g.I=e.L);var n=e.g;e=e.ia,n.L=1,n.v=ht(ot(t)),n.m=null,n.P=!0,We(n,e)}function an(e){null!=e.C&&(s.clearTimeout(e.C),e.C=null)}function cn(e,t){var n=null;if(e.g==t){an(e),sn(e),e.g=null;var r=2}else{if(!Ze(e.h,t))return;n=t.D,tt(e.h,t),r=1}if(0!=e.G)if(t.o)if(1==r){n=t.m?t.m.length:0,t=Date.now()-t.F;var s=e.B;re(r=Ie(),new Ce(r,n)),Xt(e)}else nn(e);else if(3==(s=t.s)||0==s&&0<t.X||!(1==r&&function(e,t){return!(Xe(e.h)>=e.h.j-(e.s?1:0)||(e.s?(e.i=t.D.concat(e.i),0):1==e.G||2==e.G||e.B>=(e.Va?0:e.Wa)||(e.s=ke(u(e.Ga,e,t),un(e,e.B)),e.B++,0)))}(e,t)||2==r&&rn(e)))switch(n&&0<n.length&&(t=e.h,t.i=t.i.concat(n)),s){case 1:ln(e,5);break;case 4:ln(e,10);break;case 3:ln(e,6);break;default:ln(e,2)}}function un(e,t){let n=e.Ta+Math.floor(Math.random()*e.cb);return e.isActive()||(n*=2),n*t}function ln(e,t){if(e.j.info("Error code "+t),2==t){var n=u(e.fb,e),r=e.Xa;const t=!r;r=new it(r||"//www.google.com/images/cleardot.gif"),s.location&&"http"==s.location.protocol||at(r,"https"),ht(r),t?function(e,t){const n=new Ne;if(s.Image){const r=new Image;r.onload=l(Ct,n,"TestLoadImage: loaded",!0,t,r),r.onerror=l(Ct,n,"TestLoadImage: error",!1,t,r),r.onabort=l(Ct,n,"TestLoadImage: abort",!1,t,r),r.ontimeout=l(Ct,n,"TestLoadImage: timeout",!1,t,r),s.setTimeout((function(){r.ontimeout&&r.ontimeout()}),1e4),r.src=e}else t(!1)}(r.toString(),n):function(e,t){new Ne;const n=new AbortController,r=setTimeout((()=>{n.abort(),Ct(0,0,!1,t)}),1e4);fetch(e,{signal:n.signal}).then((e=>{clearTimeout(r),e.ok?Ct(0,0,!0,t):Ct(0,0,!1,t)})).catch((()=>{clearTimeout(r),Ct(0,0,!1,t)}))}(r.toString(),n)}else Ae(2);e.G=0,e.l&&e.l.sa(t),hn(e),Yt(e)}function hn(e){if(e.G=0,e.ka=[],e.l){const t=nt(e.h);0==t.length&&0==e.i.length||(f(e.ka,t),f(e.ka,e.i),e.h.i.length=0,d(e.i),e.i.length=0),e.l.ra()}}function dn(e,t,n){var r=n instanceof it?ot(n):new it(n);if(""!=r.g)t&&(r.g=t+"."+r.g),ct(r,r.s);else{var i=s.location;r=i.protocol,t=t?t+"."+i.hostname:i.hostname,i=+i.port;var o=new it(null);r&&at(o,r),t&&(o.g=t),i&&ct(o,i),n&&(o.l=n),r=o}return n=e.D,t=e.ya,n&&t&&lt(r,n,t),lt(r,"VER",e.la),en(e,r),r}function fn(e,t,n){if(t&&!e.J)throw Error("Can't create secondary domain capable XhrIo object.");return(t=e.Ca&&!e.pa?new Ut(new Dt({eb:n})):new Ut(e.pa)).Ha(e.J),t}function pn(){}function gn(){}function mn(e,t){ne.call(this),this.g=new Kt(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.o=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.va&&(e?e["X-WebChannel-Client-Profile"]=t.va:e={"X-WebChannel-Client-Profile":t.va}),this.g.S=e,(e=t&&t.Sb)&&!p(e)&&(this.g.m=e),this.v=t&&t.supportsCrossDomainXhr||!1,this.u=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!p(t)&&(this.g.D=t,null!==(e=this.h)&&t in e&&(t in(e=this.h)&&delete e[t])),this.j=new wn(this)}function yn(e){ve.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(const n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function vn(){we.call(this),this.status=1}function wn(e){this.g=e}(e=Ut.prototype).Ha=function(e){this.J=e},e.ea=function(e,t,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+e);t=t?t.toUpperCase():"GET",this.D=e,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Re.g(),this.v=this.o?ge(this.o):ge(Re),this.g.onreadystatechange=u(this.Ea,this);try{this.B=!0,this.g.open(t,String(e),!0),this.B=!1}catch(e){return void Wt(this,e)}if(e=n||"",n=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var i in r)n.set(i,r[i]);else{if("function"!=typeof r.keys||"function"!=typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const e of r.keys())n.set(e,r.get(e))}r=Array.from(n.keys()).find((e=>"content-type"==e.toLowerCase())),i=s.FormData&&e instanceof s.FormData,!(0<=Array.prototype.indexOf.call(Vt,t,void 0))||r||i||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[e,t]of n)this.g.setRequestHeader(e,t);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{qt(this),this.u=!0,this.g.send(e),this.u=!1}catch(e){Wt(this,e)}},e.abort=function(e){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=e||7,re(this,"complete"),re(this,"abort"),Bt(this))},e.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Bt(this,!0)),Ut.aa.N.call(this)},e.Ea=function(){this.s||(this.B||this.u||this.j?$t(this):this.bb())},e.bb=function(){$t(this)},e.isActive=function(){return!!this.g},e.Z=function(){try{return 2<zt(this)?this.g.status:-1}catch(e){return-1}},e.oa=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},e.Oa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),de(t)}},e.Ba=function(){return this.m},e.Ka=function(){return"string"==typeof this.l?this.l:String(this.l)},(e=Kt.prototype).la=8,e.G=1,e.connect=function(e,t,n,r){Ae(0),this.W=e,this.H=t||{},n&&void 0!==r&&(this.H.OSID=n,this.H.OAID=r),this.F=this.X,this.I=dn(this,null,this.W),Xt(this)},e.Ga=function(e){if(this.s)if(this.s=null,1==this.G){if(!e){this.U=Math.floor(1e5*Math.random()),e=this.U++;const s=new Me(this,this.j,e);let i=this.o;if(this.S&&(i?(i=w(i),E(i,this.S)):i=this.S),null!==this.m||this.O||(s.H=i,i=null),this.P)e:{for(var t=0,n=0;n<this.i.length;n++){var r=this.i[n];if(void 0===(r="__data__"in r.map&&"string"==typeof(r=r.map.__data__)?r.length:void 0))break;if(4096<(t+=r)){t=n;break e}if(4096===t||n===this.i.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=tn(this,s,t),lt(n=ot(this.I),"RID",e),lt(n,"CVER",22),this.D&&lt(n,"X-HTTP-Session-Id",this.D),en(this,n),i&&(this.O?t="headers="+encodeURIComponent(String(Mt(i)))+"&"+t:this.m&&xt(n,this.m,i)),et(this.h,s),this.Ua&&lt(n,"TYPE","init"),this.P?(lt(n,"$req",t),lt(n,"SID","null"),s.T=!0,Ve(s,n,null)):Ve(s,n,t),this.G=2}}else 3==this.G&&(e?Zt(this,e):0==this.i.length||Ye(this.h)||Zt(this))},e.Fa=function(){if(this.u=null,on(this),this.ba&&!(this.M||null==this.g||0>=this.R)){var e=2*this.R;this.j.info("BP detection timer enabled: "+e),this.A=ke(u(this.ab,this),e)}},e.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Ae(10),Jt(this),on(this))},e.Za=function(){null!=this.C&&(this.C=null,Jt(this),rn(this),Ae(19))},e.fb=function(e){e?(this.j.info("Successfully pinged google.com"),Ae(2)):(this.j.info("Failed to ping google.com"),Ae(1))},e.isActive=function(){return!!this.l&&this.l.isActive(this)},(e=pn.prototype).ua=function(){},e.ta=function(){},e.sa=function(){},e.ra=function(){},e.isActive=function(){return!0},e.Na=function(){},gn.prototype.g=function(e,t){return new mn(e,t)},h(mn,ne),mn.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},mn.prototype.close=function(){Qt(this.g)},mn.prototype.o=function(e){var t=this.g;if("string"==typeof e){var n={};n.__data__=e,e=n}else this.u&&((n={}).__data__=he(e),e=n);t.i.push(new Qe(t.Ya++,e)),3==t.G&&Xt(t)},mn.prototype.N=function(){this.g.l=null,delete this.j,Qt(this.g),delete this.g,mn.aa.N.call(this)},h(yn,ve),h(vn,we),h(wn,pn),wn.prototype.ua=function(){re(this.g,"a")},wn.prototype.ta=function(e){re(this.g,new yn(e))},wn.prototype.sa=function(e){re(this.g,new vn)},wn.prototype.ra=function(){re(this.g,"b")},gn.prototype.createWebChannel=gn.prototype.g,mn.prototype.send=mn.prototype.o,mn.prototype.open=mn.prototype.m,mn.prototype.close=mn.prototype.close,Ms=Us.createWebChannelTransport=function(){return new gn},Ls=Us.getStatEventTarget=function(){return Ie()},Ps=Us.Event=_e,Os=Us.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Oe.NO_ERROR=0,Oe.TIMEOUT=8,Oe.HTTP_ERROR=6,Rs=Us.ErrorCode=Oe,Pe.COMPLETE="complete",Ds=Us.EventType=Pe,me.EventType=ye,ye.OPEN="a",ye.CLOSE="b",ye.ERROR="c",ye.MESSAGE="d",ne.prototype.listen=ne.prototype.K,Ns=Us.WebChannel=me,Us.FetchXmlHttpFactory=Dt,Ut.prototype.listenOnce=Ut.prototype.L,Ut.prototype.getLastError=Ut.prototype.Ka,Ut.prototype.getLastErrorCode=Ut.prototype.Ba,Ut.prototype.getStatus=Ut.prototype.Z,Ut.prototype.getResponseJson=Ut.prototype.Oa,Ut.prototype.getResponseText=Ut.prototype.oa,Ut.prototype.send=Ut.prototype.ea,Ut.prototype.setWithCredentials=Ut.prototype.Ha,ks=Us.XhrIo=Ut}).apply(void 0!==xs?xs:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});const Fs="@firebase/firestore",Vs="4.7.10";class Ws{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Ws.UNAUTHENTICATED=new Ws(null),Ws.GOOGLE_CREDENTIALS=new Ws("google-credentials-uid"),Ws.FIRST_PARTY=new Ws("first-party-uid"),Ws.MOCK_USER=new Ws("mock-user");let js="11.5.0";const $s=new j("@firebase/firestore");function Bs(){return $s.logLevel}function qs(e,...t){if($s.logLevel<=x.DEBUG){const n=t.map(Gs);$s.debug(`Firestore (${js}): ${e}`,...n)}}function zs(e,...t){if($s.logLevel<=x.ERROR){const n=t.map(Gs);$s.error(`Firestore (${js}): ${e}`,...n)}}function Hs(e,...t){if($s.logLevel<=x.WARN){const n=t.map(Gs);$s.warn(`Firestore (${js}): ${e}`,...n)}}function Gs(e){if("string"==typeof e)return e;try{return function(e){return JSON.stringify(e)}(e)}catch(t){return e}}function Ks(e="Unexpected state"){const t=`FIRESTORE (${js}) INTERNAL ASSERTION FAILED: `+e;throw zs(t),new Error(t)}function Qs(e,t){e||Ks()}function Js(e,t){return e}const Ys={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Xs extends _{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Zs{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}class ei{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class ti{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(Ws.UNAUTHENTICATED)))}shutdown(){}}class ni{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class ri{constructor(e){this.t=e,this.currentUser=Ws.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){Qs(void 0===this.o);let n=this.i;const r=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve();let s=new Zs;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new Zs,e.enqueueRetryable((()=>r(this.currentUser)))};const i=()=>{const t=s;e.enqueueRetryable((async()=>{await t.promise,await r(this.currentUser)}))},o=e=>{qs("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.o&&(this.auth.addAuthTokenListener(this.o),i())};this.t.onInit((e=>o(e))),setTimeout((()=>{if(!this.auth){const e=this.t.getImmediate({optional:!0});e?o(e):(qs("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new Zs)}}),0),i()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((t=>this.i!==e?(qs("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(Qs("string"==typeof t.accessToken),new ei(t.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return Qs(null===e||"string"==typeof e),new Ws(e)}}class si{constructor(e,t,n){this.l=e,this.h=t,this.P=n,this.type="FirstParty",this.user=Ws.FIRST_PARTY,this.T=new Map}I(){return this.P?this.P():null}get headers(){this.T.set("X-Goog-AuthUser",this.l);const e=this.I();return e&&this.T.set("Authorization",e),this.h&&this.T.set("X-Goog-Iam-Authorization-Token",this.h),this.T}}class ii{constructor(e,t,n){this.l=e,this.h=t,this.P=n}getToken(){return Promise.resolve(new si(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable((()=>t(Ws.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class oi{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class ai{constructor(e,t){this.A=t,this.forceRefresh=!1,this.appCheck=null,this.R=null,this.V=null,$e(e)&&e.settings.appCheckToken&&(this.V=e.settings.appCheckToken)}start(e,t){Qs(void 0===this.o);const n=e=>{null!=e.error&&qs("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);const n=e.token!==this.R;return this.R=e.token,qs("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable((()=>n(t)))};const r=e=>{qs("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit((e=>r(e))),setTimeout((()=>{if(!this.appCheck){const e=this.A.getImmediate({optional:!0});e?r(e):qs("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.V)return Promise.resolve(new oi(this.V));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((e=>e?(Qs("string"==typeof e.token),this.R=e.token,new oi(e.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function ci(e){const t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let t=0;t<e;t++)n[t]=Math.floor(256*Math.random());return n}function ui(){return new TextEncoder}class li{static newId(){const e=62*Math.floor(256/62);let t="";for(;t.length<20;){const n=ci(40);for(let r=0;r<n.length;++r)t.length<20&&n[r]<e&&(t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(n[r]%62))}return t}}function hi(e,t){return e<t?-1:e>t?1:0}function di(e,t){let n=0;for(;n<e.length&&n<t.length;){const r=e.codePointAt(n),s=t.codePointAt(n);if(r!==s){if(r<128&&s<128)return hi(r,s);{const i=ui(),o=pi(i.encode(fi(e,n)),i.encode(fi(t,n)));return 0!==o?o:hi(r,s)}}n+=r>65535?2:1}return hi(e.length,t.length)}function fi(e,t){return e.codePointAt(t)>65535?e.substring(t,t+2):e.substring(t,t+1)}function pi(e,t){for(let n=0;n<e.length&&n<t.length;++n)if(e[n]!==t[n])return hi(e[n],t[n]);return hi(e.length,t.length)}function gi(e,t,n){return e.length===t.length&&e.every(((e,r)=>n(e,t[r])))}const mi=-62135596800,yi=1e6;class vi{static now(){return vi.fromMillis(Date.now())}static fromDate(e){return vi.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor((e-1e3*t)*yi);return new vi(t,n)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new Xs(Ys.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new Xs(Ys.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<mi)throw new Xs(Ys.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Xs(Ys.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/yi}_compareTo(e){return this.seconds===e.seconds?hi(this.nanoseconds,e.nanoseconds):hi(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds-mi;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class wi{static fromTimestamp(e){return new wi(e)}static min(){return new wi(new vi(0,0))}static max(){return new wi(new vi(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}const _i="__name__";class Ei{constructor(e,t,n){void 0===t?t=0:t>e.length&&Ks(),void 0===n?n=e.length-t:n>e.length-t&&Ks(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===Ei.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Ei?e.forEach((e=>{t.push(e)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let r=0;r<n;r++){const n=Ei.compareSegments(e.get(r),t.get(r));if(0!==n)return n}return hi(e.length,t.length)}static compareSegments(e,t){const n=Ei.isNumericId(e),r=Ei.isNumericId(t);return n&&!r?-1:!n&&r?1:n&&r?Ei.extractNumericId(e).compare(Ei.extractNumericId(t)):di(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return bs.fromString(e.substring(4,e.length-2))}}class Ii extends Ei{construct(e,t,n){return new Ii(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new Xs(Ys.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter((e=>e.length>0)))}return new Ii(t)}static emptyPath(){return new Ii([])}}const Si=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class bi extends Ei{construct(e,t,n){return new bi(e,t,n)}static isValidIdentifier(e){return Si.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),bi.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===_i}static keyField(){return new bi([_i])}static fromServerFormat(e){const t=[];let n="",r=0;const s=()=>{if(0===n.length)throw new Xs(Ys.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let i=!1;for(;r<e.length;){const t=e[r];if("\\"===t){if(r+1===e.length)throw new Xs(Ys.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[r+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new Xs(Ys.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,r+=2}else"`"===t?(i=!i,r++):"."!==t||i?(n+=t,r++):(s(),r++)}if(s(),i)throw new Xs(Ys.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new bi(t)}static emptyPath(){return new bi([])}}class Ti{constructor(e){this.path=e}static fromPath(e){return new Ti(Ii.fromString(e))}static fromName(e){return new Ti(Ii.fromString(e).popFirst(5))}static empty(){return new Ti(Ii.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===Ii.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return Ii.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Ti(new Ii(e.slice()))}}const Ai=-1;class Ci{constructor(e,t,n,r){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=r}}Ci.UNKNOWN_ID=-1;function ki(e,t){const n=e.toTimestamp().seconds,r=e.toTimestamp().nanoseconds+1,s=wi.fromTimestamp(1e9===r?new vi(n+1,0):new vi(n,r));return new Di(s,Ti.empty(),t)}function Ni(e){return new Di(e.readTime,e.key,Ai)}class Di{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new Di(wi.min(),Ti.empty(),Ai)}static max(){return new Di(wi.max(),Ti.empty(),Ai)}}function Ri(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n?n:(n=Ti.comparator(e.documentKey,t.documentKey),0!==n?n:hi(e.largestBatchId,t.largestBatchId))}const Oi="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Pi{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}async function Li(e){if(e.code!==Ys.FAILED_PRECONDITION||e.message!==Oi)throw e;qs("LocalStore","Unexpectedly lost primary lease")}class Mi{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)}),(e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&Ks(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new Mi(((n,r)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,r)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,r)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof Mi?t:Mi.resolve(t)}catch(e){return Mi.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):Mi.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):Mi.reject(t)}static resolve(e){return new Mi(((t,n)=>{t(e)}))}static reject(e){return new Mi(((t,n)=>{n(e)}))}static waitFor(e){return new Mi(((t,n)=>{let r=0,s=0,i=!1;e.forEach((e=>{++r,e.next((()=>{++s,i&&s===r&&t()}),(e=>n(e)))})),i=!0,s===r&&t()}))}static or(e){let t=Mi.resolve(!1);for(const n of e)t=t.next((e=>e?Mi.resolve(e):n()));return t}static forEach(e,t){const n=[];return e.forEach(((e,r)=>{n.push(t.call(this,e,r))})),this.waitFor(n)}static mapArray(e,t){return new Mi(((n,r)=>{const s=e.length,i=new Array(s);let o=0;for(let a=0;a<s;a++){const c=a;t(e[c]).next((e=>{i[c]=e,++o,o===s&&n(i)}),(e=>r(e)))}}))}static doWhile(e,t){return new Mi(((n,r)=>{const s=()=>{!0===e()?t().next((()=>{s()}),r):n()};s()}))}}function xi(e){const t=e.match(/Android ([\d.]+)/i),n=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(n)}function Ui(e){return"IndexedDbTransactionError"===e.name}class Fi{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.oe(e),this._e=e=>t.writeSequenceNumber(e))}oe(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this._e&&this._e(e),e}}Fi.ae=-1;const Vi=-1;function Wi(e){return null==e}function ji(e){return 0===e&&1/e==-1/0}function $i(e){return"number"==typeof e&&Number.isInteger(e)&&!ji(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}const Bi="";function qi(e){let t="";for(let n=0;n<e.length;n++)t.length>0&&(t=Hi(t)),t=zi(e.get(n),t);return Hi(t)}function zi(e,t){let n=t;const r=e.length;for(let t=0;t<r;t++){const r=e.charAt(t);switch(r){case"\0":n+="";break;case Bi:n+="";break;default:n+=r}}return n}function Hi(e){return e+Bi+""}const Gi="remoteDocuments",Ki="owner",Qi="mutationQueues",Ji="mutations";const Yi="documentMutations",Xi="remoteDocumentsV14",Zi="remoteDocumentGlobal",eo="targets",to="targetDocuments",no="targetGlobal",ro="collectionParents",so="clientMetadata",io="bundles",oo="namedQueries",ao="indexConfiguration",co="indexState",uo="indexEntries",lo="documentOverlays",ho="globals",fo=[Qi,Ji,Yi,Gi,eo,Ki,no,to,so,Zi,ro,io,oo],po=[Qi,Ji,Yi,Xi,eo,Ki,no,to,so,Zi,ro,io,oo,lo],go=po,mo=[...go,ao,co,uo];function yo(e){let t=0;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function vo(e,t){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function wo(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class _o{constructor(e,t){this.comparator=e,this.root=t||Io.EMPTY}insert(e,t){return new _o(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Io.BLACK,null,null))}remove(e){return new _o(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Io.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(0===r)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,n)=>(e(t,n),!1)))}toString(){const e=[];return this.inorderTraversal(((t,n)=>(e.push(`${t}:${n}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Eo(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Eo(this.root,e,this.comparator,!1)}getReverseIterator(){return new Eo(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Eo(this.root,e,this.comparator,!0)}}class Eo{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?n(e.key,t):1,t&&r&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(0===s){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Io{constructor(e,t,n,r,s){this.key=e,this.value=t,this.color=null!=n?n:Io.RED,this.left=null!=r?r:Io.EMPTY,this.right=null!=s?s:Io.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,s){return new Io(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=s?s:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;const s=n(e,r.key);return r=s<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===s?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return Io.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return Io.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Io.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Io.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Ks();if(this.right.isRed())throw Ks();const e=this.left.check();if(e!==this.right.check())throw Ks();return e+(this.isRed()?0:1)}}Io.EMPTY=null,Io.RED=!0,Io.BLACK=!1,Io.EMPTY=new class{constructor(){this.size=0}get key(){throw Ks()}get value(){throw Ks()}get color(){throw Ks()}get left(){throw Ks()}get right(){throw Ks()}copy(e,t,n,r,s){return this}insert(e,t,n){return new Io(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class So{constructor(e){this.comparator=e,this.data=new _o(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,n)=>(e(t),!1)))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new bo(this.data.getIterator())}getIteratorFrom(e){return new bo(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((e=>{t=t.add(e)})),t}isEqual(e){if(!(e instanceof So))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(0!==this.comparator(e,r))return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new So(this.comparator);return t.data=e,t}}class bo{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class To{constructor(e){this.fields=e,e.sort(bi.comparator)}static empty(){return new To([])}unionWith(e){let t=new So(bi.comparator);for(const e of this.fields)t=t.add(e);for(const n of e)t=t.add(n);return new To(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return gi(this.fields,e.fields,((e,t)=>e.isEqual(t)))}}class Ao extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class Co{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(e){try{return atob(e)}catch(e){throw"undefined"!=typeof DOMException&&e instanceof DOMException?new Ao("Invalid base64 string: "+e):e}}(e);return new Co(t)}static fromUint8Array(e){const t=function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e);return new Co(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return hi(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Co.EMPTY_BYTE_STRING=new Co("");const ko=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function No(e){if(Qs(!!e),"string"==typeof e){let t=0;const n=ko.exec(e);if(Qs(!!n),n[1]){let e=n[1];e=(e+"000000000").substr(0,9),t=Number(e)}const r=new Date(e);return{seconds:Math.floor(r.getTime()/1e3),nanos:t}}return{seconds:Do(e.seconds),nanos:Do(e.nanos)}}function Do(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function Ro(e){return"string"==typeof e?Co.fromBase64String(e):Co.fromUint8Array(e)}const Oo="server_timestamp",Po="__type__",Lo="__previous_value__",Mo="__local_write_time__";function xo(e){var t,n;return(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{})[Po])||void 0===n?void 0:n.stringValue)===Oo}function Uo(e){const t=e.mapValue.fields[Lo];return xo(t)?Uo(t):t}function Fo(e){const t=No(e.mapValue.fields[Mo].timestampValue);return new vi(t.seconds,t.nanos)}class Vo{constructor(e,t,n,r,s,i,o,a,c){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=s,this.forceLongPolling=i,this.autoDetectLongPolling=o,this.longPollingOptions=a,this.useFetchStreams=c}}const Wo="(default)";class jo{constructor(e,t){this.projectId=e,this.database=t||Wo}static empty(){return new jo("","")}get isDefaultDatabase(){return this.database===Wo}isEqual(e){return e instanceof jo&&e.projectId===this.projectId&&e.database===this.database}}const $o="__type__",Bo="__max__",qo={mapValue:{fields:{__type__:{stringValue:Bo}}}},zo="__vector__",Ho="value";function Go(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?xo(e)?4:la(e)?9007199254740991:ca(e)?10:11:Ks()}function Ko(e,t){if(e===t)return!0;const n=Go(e);if(n!==Go(t))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return Fo(e).isEqual(Fo(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;const n=No(e.timestampValue),r=No(t.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return function(e,t){return Ro(e.bytesValue).isEqual(Ro(t.bytesValue))}(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return Do(e.geoPointValue.latitude)===Do(t.geoPointValue.latitude)&&Do(e.geoPointValue.longitude)===Do(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return Do(e.integerValue)===Do(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){const n=Do(e.doubleValue),r=Do(t.doubleValue);return n===r?ji(n)===ji(r):isNaN(n)&&isNaN(r)}return!1}(e,t);case 9:return gi(e.arrayValue.values||[],t.arrayValue.values||[],Ko);case 10:case 11:return function(e,t){const n=e.mapValue.fields||{},r=t.mapValue.fields||{};if(yo(n)!==yo(r))return!1;for(const e in n)if(n.hasOwnProperty(e)&&(void 0===r[e]||!Ko(n[e],r[e])))return!1;return!0}(e,t);default:return Ks()}}function Qo(e,t){return void 0!==(e.values||[]).find((e=>Ko(e,t)))}function Jo(e,t){if(e===t)return 0;const n=Go(e),r=Go(t);if(n!==r)return hi(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return hi(e.booleanValue,t.booleanValue);case 2:return function(e,t){const n=Do(e.integerValue||e.doubleValue),r=Do(t.integerValue||t.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(e,t);case 3:return Yo(e.timestampValue,t.timestampValue);case 4:return Yo(Fo(e),Fo(t));case 5:return di(e.stringValue,t.stringValue);case 6:return function(e,t){const n=Ro(e),r=Ro(t);return n.compareTo(r)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){const n=e.split("/"),r=t.split("/");for(let e=0;e<n.length&&e<r.length;e++){const t=hi(n[e],r[e]);if(0!==t)return t}return hi(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){const n=hi(Do(e.latitude),Do(t.latitude));return 0!==n?n:hi(Do(e.longitude),Do(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return Xo(e.arrayValue,t.arrayValue);case 10:return function(e,t){var n,r,s,i;const o=e.fields||{},a=t.fields||{},c=null===(n=o[Ho])||void 0===n?void 0:n.arrayValue,u=null===(r=a[Ho])||void 0===r?void 0:r.arrayValue,l=hi((null===(s=null==c?void 0:c.values)||void 0===s?void 0:s.length)||0,(null===(i=null==u?void 0:u.values)||void 0===i?void 0:i.length)||0);return 0!==l?l:Xo(c,u)}(e.mapValue,t.mapValue);case 11:return function(e,t){if(e===qo.mapValue&&t===qo.mapValue)return 0;if(e===qo.mapValue)return 1;if(t===qo.mapValue)return-1;const n=e.fields||{},r=Object.keys(n),s=t.fields||{},i=Object.keys(s);r.sort(),i.sort();for(let e=0;e<r.length&&e<i.length;++e){const t=di(r[e],i[e]);if(0!==t)return t;const o=Jo(n[r[e]],s[i[e]]);if(0!==o)return o}return hi(r.length,i.length)}(e.mapValue,t.mapValue);default:throw Ks()}}function Yo(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return hi(e,t);const n=No(e),r=No(t),s=hi(n.seconds,r.seconds);return 0!==s?s:hi(n.nanos,r.nanos)}function Xo(e,t){const n=e.values||[],r=t.values||[];for(let e=0;e<n.length&&e<r.length;++e){const t=Jo(n[e],r[e]);if(t)return t}return hi(n.length,r.length)}function Zo(e){return ea(e)}function ea(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){const t=No(e);return`time(${t.seconds},${t.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?function(e){return Ro(e).toBase64()}(e.bytesValue):"referenceValue"in e?function(e){return Ti.fromName(e).toString()}(e.referenceValue):"geoPointValue"in e?function(e){return`geo(${e.latitude},${e.longitude})`}(e.geoPointValue):"arrayValue"in e?function(e){let t="[",n=!0;for(const r of e.values||[])n?n=!1:t+=",",t+=ea(r);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){const t=Object.keys(e.fields||{}).sort();let n="{",r=!0;for(const s of t)r?r=!1:n+=",",n+=`${s}:${ea(e.fields[s])}`;return n+"}"}(e.mapValue):Ks()}function ta(e){switch(Go(e)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const t=Uo(e);return t?16+ta(t):16;case 5:return 2*e.stringValue.length;case 6:return Ro(e.bytesValue).approximateByteSize();case 7:return e.referenceValue.length;case 9:return function(e){return(e.values||[]).reduce(((e,t)=>e+ta(t)),0)}(e.arrayValue);case 10:case 11:return function(e){let t=0;return vo(e.fields,((e,n)=>{t+=e.length+ta(n)})),t}(e.mapValue);default:throw Ks()}}function na(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function ra(e){return!!e&&"integerValue"in e}function sa(e){return!!e&&"arrayValue"in e}function ia(e){return!!e&&"nullValue"in e}function oa(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function aa(e){return!!e&&"mapValue"in e}function ca(e){var t,n;return(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{})[$o])||void 0===n?void 0:n.stringValue)===zo}function ua(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){const t={mapValue:{fields:{}}};return vo(e.mapValue.fields,((e,n)=>t.mapValue.fields[e]=ua(n))),t}if(e.arrayValue){const t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=ua(e.arrayValue.values[n]);return t}return Object.assign({},e)}function la(e){return(((e.mapValue||{}).fields||{}).__type__||{}).stringValue===Bo}class ha{constructor(e){this.value=e}static empty(){return new ha({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!aa(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=ua(t)}setAll(e){let t=bi.emptyPath(),n={},r=[];e.forEach(((e,s)=>{if(!t.isImmediateParentOf(s)){const e=this.getFieldsMap(t);this.applyChanges(e,n,r),n={},r=[],t=s.popLast()}e?n[s.lastSegment()]=ua(e):r.push(s.lastSegment())}));const s=this.getFieldsMap(t);this.applyChanges(s,n,r)}delete(e){const t=this.field(e.popLast());aa(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Ko(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let r=t.mapValue.fields[e.get(n)];aa(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,n){vo(t,((t,n)=>e[t]=n));for(const t of n)delete e[t]}clone(){return new ha(ua(this.value))}}function da(e){const t=[];return vo(e.fields,((e,n)=>{const r=new bi([e]);if(aa(n)){const e=da(n.mapValue).fields;if(0===e.length)t.push(r);else for(const n of e)t.push(r.child(n))}else t.push(r)})),new To(t)}class fa{constructor(e,t,n,r,s,i,o){this.key=e,this.documentType=t,this.version=n,this.readTime=r,this.createTime=s,this.data=i,this.documentState=o}static newInvalidDocument(e){return new fa(e,0,wi.min(),wi.min(),wi.min(),ha.empty(),0)}static newFoundDocument(e,t,n,r){return new fa(e,1,t,wi.min(),n,r,0)}static newNoDocument(e,t){return new fa(e,2,t,wi.min(),wi.min(),ha.empty(),0)}static newUnknownDocument(e,t){return new fa(e,3,t,wi.min(),wi.min(),ha.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(wi.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=ha.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=ha.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=wi.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof fa&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new fa(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class pa{constructor(e,t){this.position=e,this.inclusive=t}}function ga(e,t,n){let r=0;for(let s=0;s<e.position.length;s++){const i=t[s],o=e.position[s];if(r=i.field.isKeyField()?Ti.comparator(Ti.fromName(o.referenceValue),n.key):Jo(o,n.data.field(i.field)),"desc"===i.dir&&(r*=-1),0!==r)break}return r}function ma(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!Ko(e.position[n],t.position[n]))return!1;return!0}class ya{constructor(e,t="asc"){this.field=e,this.dir=t}}function va(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}class wa{}class _a extends wa{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new ka(e,t,n):"array-contains"===t?new Oa(e,n):"in"===t?new Pa(e,n):"not-in"===t?new La(e,n):"array-contains-any"===t?new Ma(e,n):new _a(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new Na(e,n):new Da(e,n)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(Jo(t,this.value)):null!==t&&Go(this.value)===Go(t)&&this.matchesComparison(Jo(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return Ks()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Ea extends wa{constructor(e,t){super(),this.filters=e,this.op=t,this.ce=null}static create(e,t){return new Ea(e,t)}matches(e){return Ia(this)?void 0===this.filters.find((t=>!t.matches(e))):void 0!==this.filters.find((t=>t.matches(e)))}getFlattenedFilters(){return null!==this.ce||(this.ce=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.ce}getFilters(){return Object.assign([],this.filters)}}function Ia(e){return"and"===e.op}function Sa(e){return ba(e)&&Ia(e)}function ba(e){for(const t of e.filters)if(t instanceof Ea)return!1;return!0}function Ta(e){if(e instanceof _a)return e.field.canonicalString()+e.op.toString()+Zo(e.value);if(Sa(e))return e.filters.map((e=>Ta(e))).join(",");{const t=e.filters.map((e=>Ta(e))).join(",");return`${e.op}(${t})`}}function Aa(e,t){return e instanceof _a?function(e,t){return t instanceof _a&&e.op===t.op&&e.field.isEqual(t.field)&&Ko(e.value,t.value)}(e,t):e instanceof Ea?function(e,t){return t instanceof Ea&&e.op===t.op&&e.filters.length===t.filters.length&&e.filters.reduce(((e,n,r)=>e&&Aa(n,t.filters[r])),!0)}(e,t):void Ks()}function Ca(e){return e instanceof _a?function(e){return`${e.field.canonicalString()} ${e.op} ${Zo(e.value)}`}(e):e instanceof Ea?function(e){return e.op.toString()+" {"+e.getFilters().map(Ca).join(" ,")+"}"}(e):"Filter"}class ka extends _a{constructor(e,t,n){super(e,t,n),this.key=Ti.fromName(n.referenceValue)}matches(e){const t=Ti.comparator(e.key,this.key);return this.matchesComparison(t)}}class Na extends _a{constructor(e,t){super(e,"in",t),this.keys=Ra("in",t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class Da extends _a{constructor(e,t){super(e,"not-in",t),this.keys=Ra("not-in",t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function Ra(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map((e=>Ti.fromName(e.referenceValue)))}class Oa extends _a{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return sa(t)&&Qo(t.arrayValue,this.value)}}class Pa extends _a{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&Qo(this.value.arrayValue,t)}}class La extends _a{constructor(e,t){super(e,"not-in",t)}matches(e){if(Qo(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!Qo(this.value.arrayValue,t)}}class Ma extends _a{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!sa(t)||!t.arrayValue.values)&&t.arrayValue.values.some((e=>Qo(this.value.arrayValue,e)))}}class xa{constructor(e,t=null,n=[],r=[],s=null,i=null,o=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=s,this.startAt=i,this.endAt=o,this.le=null}}function Ua(e,t=null,n=[],r=[],s=null,i=null,o=null){return new xa(e,t,n,r,s,i,o)}function Fa(e){const t=Js(e);if(null===t.le){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map((e=>Ta(e))).join(","),e+="|ob:",e+=t.orderBy.map((e=>function(e){return e.field.canonicalString()+e.dir}(e))).join(","),Wi(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((e=>Zo(e))).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((e=>Zo(e))).join(",")),t.le=e}return t.le}function Va(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(let n=0;n<e.orderBy.length;n++)if(!va(e.orderBy[n],t.orderBy[n]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let n=0;n<e.filters.length;n++)if(!Aa(e.filters[n],t.filters[n]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!ma(e.startAt,t.startAt)&&ma(e.endAt,t.endAt)}function Wa(e){return Ti.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}class ja{constructor(e,t=null,n=[],r=[],s=null,i="F",o=null,a=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=s,this.limitType=i,this.startAt=o,this.endAt=a,this.he=null,this.Pe=null,this.Te=null,this.startAt,this.endAt}}function $a(e,t,n,r,s,i,o,a){return new ja(e,t,n,r,s,i,o,a)}function Ba(e){return new ja(e)}function qa(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function za(e){return null!==e.collectionGroup}function Ha(e){const t=Js(e);if(null===t.he){t.he=[];const e=new Set;for(const n of t.explicitOrderBy)t.he.push(n),e.add(n.field.canonicalString());const n=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc",r=function(e){let t=new So(bi.comparator);return e.filters.forEach((e=>{e.getFlattenedFilters().forEach((e=>{e.isInequality()&&(t=t.add(e.field))}))})),t}(t);r.forEach((r=>{e.has(r.canonicalString())||r.isKeyField()||t.he.push(new ya(r,n))})),e.has(bi.keyField().canonicalString())||t.he.push(new ya(bi.keyField(),n))}return t.he}function Ga(e){const t=Js(e);return t.Pe||(t.Pe=Ka(t,Ha(e))),t.Pe}function Ka(e,t){if("F"===e.limitType)return Ua(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map((e=>{const t="desc"===e.dir?"asc":"desc";return new ya(e.field,t)}));const n=e.endAt?new pa(e.endAt.position,e.endAt.inclusive):null,r=e.startAt?new pa(e.startAt.position,e.startAt.inclusive):null;return Ua(e.path,e.collectionGroup,t,e.filters,e.limit,n,r)}}function Qa(e,t){const n=e.filters.concat([t]);return new ja(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}function Ja(e,t,n){return new ja(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function Ya(e,t){return Va(Ga(e),Ga(t))&&e.limitType===t.limitType}function Xa(e){return`${Fa(Ga(e))}|lt:${e.limitType}`}function Za(e){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map((e=>Ca(e))).join(", ")}]`),Wi(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map((e=>function(e){return`${e.field.canonicalString()} (${e.dir})`}(e))).join(", ")}]`),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((e=>Zo(e))).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((e=>Zo(e))).join(",")),`Target(${t})`}(Ga(e))}; limitType=${e.limitType})`}function ec(e,t){return t.isFoundDocument()&&function(e,t){const n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):Ti.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){for(const n of Ha(e))if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(const n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&function(e,t){return!(e.startAt&&!function(e,t,n){const r=ga(e,t,n);return e.inclusive?r<=0:r<0}(e.startAt,Ha(e),t))&&!(e.endAt&&!function(e,t,n){const r=ga(e,t,n);return e.inclusive?r>=0:r>0}(e.endAt,Ha(e),t))}(e,t)}function tc(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function nc(e){return(t,n)=>{let r=!1;for(const s of Ha(e)){const e=rc(s,t,n);if(0!==e)return e;r=r||s.field.isKeyField()}return 0}}function rc(e,t,n){const r=e.field.isKeyField()?Ti.comparator(t.key,n.key):function(e,t,n){const r=t.data.field(e),s=n.data.field(e);return null!==r&&null!==s?Jo(r,s):Ks()}(e.field,t,n);switch(e.dir){case"asc":return r;case"desc":return-1*r;default:return Ks()}}class sc{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[t,r]of n)if(this.equalsFn(t,e))return r}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),r=this.inner[n];if(void 0===r)return this.inner[n]=[[e,t]],void this.innerSize++;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],e))return void(r[n]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(e){vo(this.inner,((t,n)=>{for(const[t,r]of n)e(t,r)}))}isEmpty(){return wo(this.inner)}size(){return this.innerSize}}const ic=new _o(Ti.comparator);function oc(){return ic}const ac=new _o(Ti.comparator);function cc(...e){let t=ac;for(const n of e)t=t.insert(n.key,n);return t}function uc(e){let t=ac;return e.forEach(((e,n)=>t=t.insert(e,n.overlayedDocument))),t}function lc(){return dc()}function hc(){return dc()}function dc(){return new sc((e=>e.toString()),((e,t)=>e.isEqual(t)))}const fc=new _o(Ti.comparator),pc=new So(Ti.comparator);function gc(...e){let t=pc;for(const n of e)t=t.add(n);return t}const mc=new So(hi);function yc(){return mc}function vc(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ji(t)?"-0":t}}function wc(e){return{integerValue:""+e}}function _c(e,t){return $i(t)?wc(t):vc(e,t)}class Ec{constructor(){this._=void 0}}function Ic(e,t,n){return e instanceof Tc?function(e,t){const n={fields:{[Po]:{stringValue:Oo},[Mo]:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&xo(t)&&(t=Uo(t)),t&&(n.fields[Lo]=t),{mapValue:n}}(n,t):e instanceof Ac?Cc(e,t):e instanceof kc?Nc(e,t):function(e,t){const n=bc(e,t),r=Rc(n)+Rc(e.Ie);return ra(n)&&ra(e.Ie)?wc(r):vc(e.serializer,r)}(e,t)}function Sc(e,t,n){return e instanceof Ac?Cc(e,t):e instanceof kc?Nc(e,t):n}function bc(e,t){return e instanceof Dc?function(e){return ra(e)||function(e){return!!e&&"doubleValue"in e}(e)}(t)?t:{integerValue:0}:null}class Tc extends Ec{}class Ac extends Ec{constructor(e){super(),this.elements=e}}function Cc(e,t){const n=Oc(t);for(const t of e.elements)n.some((e=>Ko(e,t)))||n.push(t);return{arrayValue:{values:n}}}class kc extends Ec{constructor(e){super(),this.elements=e}}function Nc(e,t){let n=Oc(t);for(const t of e.elements)n=n.filter((e=>!Ko(e,t)));return{arrayValue:{values:n}}}class Dc extends Ec{constructor(e,t){super(),this.serializer=e,this.Ie=t}}function Rc(e){return Do(e.integerValue||e.doubleValue)}function Oc(e){return sa(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class Pc{constructor(e,t){this.field=e,this.transform=t}}class Lc{constructor(e,t){this.version=e,this.transformResults=t}}class Mc{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Mc}static exists(e){return new Mc(void 0,e)}static updateTime(e){return new Mc(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function xc(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class Uc{}function Fc(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new Kc(e.key,Mc.none()):new Bc(e.key,e.data,Mc.none());{const n=e.data,r=ha.empty();let s=new So(bi.comparator);for(let e of t.fields)if(!s.has(e)){let t=n.field(e);null===t&&e.length>1&&(e=e.popLast(),t=n.field(e)),null===t?r.delete(e):r.set(e,t),s=s.add(e)}return new qc(e.key,r,new To(s.toArray()),Mc.none())}}function Vc(e,t,n){e instanceof Bc?function(e,t,n){const r=e.value.clone(),s=Hc(e.fieldTransforms,t,n.transformResults);r.setAll(s),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):e instanceof qc?function(e,t,n){if(!xc(e.precondition,t))return void t.convertToUnknownDocument(n.version);const r=Hc(e.fieldTransforms,t,n.transformResults),s=t.data;s.setAll(zc(e)),s.setAll(r),t.convertToFoundDocument(n.version,s).setHasCommittedMutations()}(e,t,n):function(e,t,n){t.convertToNoDocument(n.version).setHasCommittedMutations()}(0,t,n)}function Wc(e,t,n,r){return e instanceof Bc?function(e,t,n,r){if(!xc(e.precondition,t))return n;const s=e.value.clone(),i=Gc(e.fieldTransforms,r,t);return s.setAll(i),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null}(e,t,n,r):e instanceof qc?function(e,t,n,r){if(!xc(e.precondition,t))return n;const s=Gc(e.fieldTransforms,r,t),i=t.data;return i.setAll(zc(e)),i.setAll(s),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null===n?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map((e=>e.field)))}(e,t,n,r):function(e,t,n){return xc(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n}(e,t,n)}function jc(e,t){let n=null;for(const r of e.fieldTransforms){const e=t.data.field(r.field),s=bc(r.transform,e||null);null!=s&&(null===n&&(n=ha.empty()),n.set(r.field,s))}return n||null}function $c(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!function(e,t){return void 0===e&&void 0===t||!(!e||!t)&&gi(e,t,((e,t)=>function(e,t){return e.field.isEqual(t.field)&&function(e,t){return e instanceof Ac&&t instanceof Ac||e instanceof kc&&t instanceof kc?gi(e.elements,t.elements,Ko):e instanceof Dc&&t instanceof Dc?Ko(e.Ie,t.Ie):e instanceof Tc&&t instanceof Tc}(e.transform,t.transform)}(e,t)))}(e.fieldTransforms,t.fieldTransforms)&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class Bc extends Uc{constructor(e,t,n,r=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class qc extends Uc{constructor(e,t,n,r,s=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function zc(e){const t=new Map;return e.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const r=e.data.field(n);t.set(n,r)}})),t}function Hc(e,t,n){const r=new Map;Qs(e.length===n.length);for(let s=0;s<n.length;s++){const i=e[s],o=i.transform,a=t.data.field(i.field);r.set(i.field,Sc(o,a,n[s]))}return r}function Gc(e,t,n){const r=new Map;for(const s of e){const e=s.transform,i=n.data.field(s.field);r.set(s.field,Ic(e,i,t))}return r}class Kc extends Uc{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Qc extends Uc{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Jc{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let t=0;t<this.mutations.length;t++){const r=this.mutations[t];r.key.isEqual(e.key)&&Vc(r,e,n[t])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=Wc(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=Wc(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=hc();return this.mutations.forEach((r=>{const s=e.get(r.key),i=s.overlayedDocument;let o=this.applyToLocalView(i,s.mutatedFields);o=t.has(r.key)?null:o;const a=Fc(i,o);null!==a&&n.set(r.key,a),i.isValidDocument()||i.convertToNoDocument(wi.min())})),n}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),gc())}isEqual(e){return this.batchId===e.batchId&&gi(this.mutations,e.mutations,((e,t)=>$c(e,t)))&&gi(this.baseMutations,e.baseMutations,((e,t)=>$c(e,t)))}}class Yc{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(e,t,n){Qs(e.mutations.length===n.length);let r=fc;const s=e.mutations;for(let e=0;e<s.length;e++)r=r.insert(s[e].key,n[e].version);return new Yc(e,t,n,r)}}class Xc{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class Zc{constructor(e,t){this.count=e,this.unchangedNames=t}}var eu,tu;function nu(e){switch(e){case Ys.OK:return Ks();case Ys.CANCELLED:case Ys.UNKNOWN:case Ys.DEADLINE_EXCEEDED:case Ys.RESOURCE_EXHAUSTED:case Ys.INTERNAL:case Ys.UNAVAILABLE:case Ys.UNAUTHENTICATED:return!1;case Ys.INVALID_ARGUMENT:case Ys.NOT_FOUND:case Ys.ALREADY_EXISTS:case Ys.PERMISSION_DENIED:case Ys.FAILED_PRECONDITION:case Ys.ABORTED:case Ys.OUT_OF_RANGE:case Ys.UNIMPLEMENTED:case Ys.DATA_LOSS:return!0;default:return Ks()}}function ru(e){if(void 0===e)return zs("GRPC error has no .code"),Ys.UNKNOWN;switch(e){case eu.OK:return Ys.OK;case eu.CANCELLED:return Ys.CANCELLED;case eu.UNKNOWN:return Ys.UNKNOWN;case eu.DEADLINE_EXCEEDED:return Ys.DEADLINE_EXCEEDED;case eu.RESOURCE_EXHAUSTED:return Ys.RESOURCE_EXHAUSTED;case eu.INTERNAL:return Ys.INTERNAL;case eu.UNAVAILABLE:return Ys.UNAVAILABLE;case eu.UNAUTHENTICATED:return Ys.UNAUTHENTICATED;case eu.INVALID_ARGUMENT:return Ys.INVALID_ARGUMENT;case eu.NOT_FOUND:return Ys.NOT_FOUND;case eu.ALREADY_EXISTS:return Ys.ALREADY_EXISTS;case eu.PERMISSION_DENIED:return Ys.PERMISSION_DENIED;case eu.FAILED_PRECONDITION:return Ys.FAILED_PRECONDITION;case eu.ABORTED:return Ys.ABORTED;case eu.OUT_OF_RANGE:return Ys.OUT_OF_RANGE;case eu.UNIMPLEMENTED:return Ys.UNIMPLEMENTED;case eu.DATA_LOSS:return Ys.DATA_LOSS;default:return Ks()}}(tu=eu||(eu={}))[tu.OK=0]="OK",tu[tu.CANCELLED=1]="CANCELLED",tu[tu.UNKNOWN=2]="UNKNOWN",tu[tu.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",tu[tu.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",tu[tu.NOT_FOUND=5]="NOT_FOUND",tu[tu.ALREADY_EXISTS=6]="ALREADY_EXISTS",tu[tu.PERMISSION_DENIED=7]="PERMISSION_DENIED",tu[tu.UNAUTHENTICATED=16]="UNAUTHENTICATED",tu[tu.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",tu[tu.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",tu[tu.ABORTED=10]="ABORTED",tu[tu.OUT_OF_RANGE=11]="OUT_OF_RANGE",tu[tu.UNIMPLEMENTED=12]="UNIMPLEMENTED",tu[tu.INTERNAL=13]="INTERNAL",tu[tu.UNAVAILABLE=14]="UNAVAILABLE",tu[tu.DATA_LOSS=15]="DATA_LOSS";let su=null;const iu=new bs([4294967295,4294967295],0);function ou(e){const t=ui().encode(e),n=new Ts;return n.update(t),new Uint8Array(n.digest())}function au(e){const t=new DataView(e.buffer),n=t.getUint32(0,!0),r=t.getUint32(4,!0),s=t.getUint32(8,!0),i=t.getUint32(12,!0);return[new bs([n,r],0),new bs([s,i],0)]}class cu{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new uu(`Invalid padding: ${t}`);if(n<0)throw new uu(`Invalid hash count: ${n}`);if(e.length>0&&0===this.hashCount)throw new uu(`Invalid hash count: ${n}`);if(0===e.length&&0!==t)throw new uu(`Invalid padding when bitmap length is 0: ${t}`);this.Ee=8*e.length-t,this.de=bs.fromNumber(this.Ee)}Ae(e,t,n){let r=e.add(t.multiply(bs.fromNumber(n)));return 1===r.compare(iu)&&(r=new bs([r.getBits(0),r.getBits(1)],0)),r.modulo(this.de).toNumber()}Re(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.Ee)return!1;const t=ou(e),[n,r]=au(t);for(let e=0;e<this.hashCount;e++){const t=this.Ae(n,r,e);if(!this.Re(t))return!1}return!0}static create(e,t,n){const r=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),i=new cu(s,r,t);return n.forEach((e=>i.insert(e))),i}insert(e){if(0===this.Ee)return;const t=ou(e),[n,r]=au(t);for(let e=0;e<this.hashCount;e++){const t=this.Ae(n,r,e);this.Ve(t)}}Ve(e){const t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1<<n}}class uu extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class lu{constructor(e,t,n,r,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const r=new Map;return r.set(e,hu.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new lu(wi.min(),r,new _o(hi),oc(),gc())}}class hu{constructor(e,t,n,r,s){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new hu(n,t,gc(),gc(),gc())}}class du{constructor(e,t,n,r){this.me=e,this.removedTargetIds=t,this.key=n,this.fe=r}}class fu{constructor(e,t){this.targetId=e,this.ge=t}}class pu{constructor(e,t,n=Co.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class gu{constructor(){this.pe=0,this.ye=vu(),this.we=Co.EMPTY_BYTE_STRING,this.Se=!1,this.be=!0}get current(){return this.Se}get resumeToken(){return this.we}get De(){return 0!==this.pe}get ve(){return this.be}Ce(e){e.approximateByteSize()>0&&(this.be=!0,this.we=e)}Fe(){let e=gc(),t=gc(),n=gc();return this.ye.forEach(((r,s)=>{switch(s){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:Ks()}})),new hu(this.we,this.Se,e,t,n)}Me(){this.be=!1,this.ye=vu()}xe(e,t){this.be=!0,this.ye=this.ye.insert(e,t)}Oe(e){this.be=!0,this.ye=this.ye.remove(e)}Ne(){this.pe+=1}Be(){this.pe-=1,Qs(this.pe>=0)}Le(){this.be=!0,this.Se=!0}}class mu{constructor(e){this.ke=e,this.qe=new Map,this.Qe=oc(),this.$e=yu(),this.Ue=yu(),this.Ke=new _o(hi)}We(e){for(const t of e.me)e.fe&&e.fe.isFoundDocument()?this.Ge(t,e.fe):this.ze(t,e.key,e.fe);for(const t of e.removedTargetIds)this.ze(t,e.key,e.fe)}je(e){this.forEachTarget(e,(t=>{const n=this.He(t);switch(e.state){case 0:this.Je(t)&&n.Ce(e.resumeToken);break;case 1:n.Be(),n.De||n.Me(),n.Ce(e.resumeToken);break;case 2:n.Be(),n.De||this.removeTarget(t);break;case 3:this.Je(t)&&(n.Le(),n.Ce(e.resumeToken));break;case 4:this.Je(t)&&(this.Ye(t),n.Ce(e.resumeToken));break;default:Ks()}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.qe.forEach(((e,n)=>{this.Je(n)&&t(n)}))}Ze(e){const t=e.targetId,n=e.ge.count,r=this.Xe(t);if(r){const s=r.target;if(Wa(s))if(0===n){const e=new Ti(s.path);this.ze(t,e,fa.newNoDocument(e,wi.min()))}else Qs(1===n);else{const r=this.et(t);if(r!==n){const n=this.tt(e),s=n?this.nt(n,e,r):1;if(0!==s){this.Ye(t);const e=2===s?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ke=this.Ke.insert(t,e)}null==su||su.rt(function(e,t,n,r,s){var i,o,a,c,u,l;const h={localCacheCount:e,existenceFilterCount:t.count,databaseId:n.database,projectId:n.projectId},d=t.unchangedNames;return d&&(h.bloomFilter={applied:0===s,hashCount:null!==(i=null==d?void 0:d.hashCount)&&void 0!==i?i:0,bitmapLength:null!==(c=null===(a=null===(o=null==d?void 0:d.bits)||void 0===o?void 0:o.bitmap)||void 0===a?void 0:a.length)&&void 0!==c?c:0,padding:null!==(l=null===(u=null==d?void 0:d.bits)||void 0===u?void 0:u.padding)&&void 0!==l?l:0,mightContain:e=>{var t;return null!==(t=null==r?void 0:r.mightContain(e))&&void 0!==t&&t}}),h}(r,e.ge,this.ke.it(),n,s))}}}}tt(e){const t=e.ge.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:n="",padding:r=0},hashCount:s=0}=t;let i,o;try{i=Ro(n).toUint8Array()}catch(e){if(e instanceof Ao)return Hs("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw e}try{o=new cu(i,r,s)}catch(e){return Hs(e instanceof uu?"BloomFilter error: ":"Applying bloom filter failed: ",e),null}return 0===o.Ee?null:o}nt(e,t,n){return t.ge.count===n-this.st(e,t.targetId)?0:2}st(e,t){const n=this.ke.getRemoteKeysForTarget(t);let r=0;return n.forEach((n=>{const s=this.ke.it(),i=`projects/${s.projectId}/databases/${s.database}/documents/${n.path.canonicalString()}`;e.mightContain(i)||(this.ze(t,n,null),r++)})),r}ot(e){const t=new Map;this.qe.forEach(((n,r)=>{const s=this.Xe(r);if(s){if(n.current&&Wa(s.target)){const t=new Ti(s.target.path);this._t(t).has(r)||this.ut(r,t)||this.ze(r,t,fa.newNoDocument(t,e))}n.ve&&(t.set(r,n.Fe()),n.Me())}}));let n=gc();this.Ue.forEach(((e,t)=>{let r=!0;t.forEachWhile((e=>{const t=this.Xe(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(r=!1,!1)})),r&&(n=n.add(e))})),this.Qe.forEach(((t,n)=>n.setReadTime(e)));const r=new lu(e,t,this.Ke,this.Qe,n);return this.Qe=oc(),this.$e=yu(),this.Ue=yu(),this.Ke=new _o(hi),r}Ge(e,t){if(!this.Je(e))return;const n=this.ut(e,t.key)?2:0;this.He(e).xe(t.key,n),this.Qe=this.Qe.insert(t.key,t),this.$e=this.$e.insert(t.key,this._t(t.key).add(e)),this.Ue=this.Ue.insert(t.key,this.ct(t.key).add(e))}ze(e,t,n){if(!this.Je(e))return;const r=this.He(e);this.ut(e,t)?r.xe(t,1):r.Oe(t),this.Ue=this.Ue.insert(t,this.ct(t).delete(e)),this.Ue=this.Ue.insert(t,this.ct(t).add(e)),n&&(this.Qe=this.Qe.insert(t,n))}removeTarget(e){this.qe.delete(e)}et(e){const t=this.He(e).Fe();return this.ke.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ne(e){this.He(e).Ne()}He(e){let t=this.qe.get(e);return t||(t=new gu,this.qe.set(e,t)),t}ct(e){let t=this.Ue.get(e);return t||(t=new So(hi),this.Ue=this.Ue.insert(e,t)),t}_t(e){let t=this.$e.get(e);return t||(t=new So(hi),this.$e=this.$e.insert(e,t)),t}Je(e){const t=null!==this.Xe(e);return t||qs("WatchChangeAggregator","Detected inactive target",e),t}Xe(e){const t=this.qe.get(e);return t&&t.De?null:this.ke.lt(e)}Ye(e){this.qe.set(e,new gu),this.ke.getRemoteKeysForTarget(e).forEach((t=>{this.ze(e,t,null)}))}ut(e,t){return this.ke.getRemoteKeysForTarget(e).has(t)}}function yu(){return new _o(Ti.comparator)}function vu(){return new _o(Ti.comparator)}const wu={asc:"ASCENDING",desc:"DESCENDING"},_u={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Eu={and:"AND",or:"OR"};class Iu{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function Su(e,t){return e.useProto3Json||Wi(t)?t:{value:t}}function bu(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function Tu(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function Au(e,t){return bu(e,t.toTimestamp())}function Cu(e){return Qs(!!e),wi.fromTimestamp(function(e){const t=No(e);return new vi(t.seconds,t.nanos)}(e))}function ku(e,t){return Nu(e,t).canonicalString()}function Nu(e,t){const n=function(e){return new Ii(["projects",e.projectId,"databases",e.database])}(e).child("documents");return void 0===t?n:n.child(t)}function Du(e){const t=Ii.fromString(e);return Qs(Ju(t)),t}function Ru(e,t){return ku(e.databaseId,t.path)}function Ou(e,t){const n=Du(t);if(n.get(1)!==e.databaseId.projectId)throw new Xs(Ys.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new Xs(Ys.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new Ti(xu(n))}function Pu(e,t){return ku(e.databaseId,t)}function Lu(e){const t=Du(e);return 4===t.length?Ii.emptyPath():xu(t)}function Mu(e){return new Ii(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function xu(e){return Qs(e.length>4&&"documents"===e.get(4)),e.popFirst(5)}function Uu(e,t,n){return{name:Ru(e,t),fields:n.value.mapValue.fields}}function Fu(e,t){let n;if(t instanceof Bc)n={update:Uu(e,t.key,t.value)};else if(t instanceof Kc)n={delete:Ru(e,t.key)};else if(t instanceof qc)n={update:Uu(e,t.key,t.data),updateMask:Qu(t.fieldMask)};else{if(!(t instanceof Qc))return Ks();n={verify:Ru(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map((e=>function(e,t){const n=t.transform;if(n instanceof Tc)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof Ac)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof kc)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof Dc)return{fieldPath:t.field.canonicalString(),increment:n.Ie};throw Ks()}(0,e)))),t.precondition.isNone||(n.currentDocument=function(e,t){return void 0!==t.updateTime?{updateTime:Au(e,t.updateTime)}:void 0!==t.exists?{exists:t.exists}:Ks()}(e,t.precondition)),n}function Vu(e,t){return{documents:[Pu(e,t.path)]}}function Wu(e,t){const n={structuredQuery:{}},r=t.path;let s;null!==t.collectionGroup?(s=r,n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(s=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),n.parent=Pu(e,s);const i=function(e){if(0!==e.length)return Ku(Ea.create(e,"and"))}(t.filters);i&&(n.structuredQuery.where=i);const o=function(e){if(0!==e.length)return e.map((e=>function(e){return{field:Hu(e.field),direction:Bu(e.dir)}}(e)))}(t.orderBy);o&&(n.structuredQuery.orderBy=o);const a=Su(e,t.limit);return null!==a&&(n.structuredQuery.limit=a),t.startAt&&(n.structuredQuery.startAt=function(e){return{before:e.inclusive,values:e.position}}(t.startAt)),t.endAt&&(n.structuredQuery.endAt=function(e){return{before:!e.inclusive,values:e.position}}(t.endAt)),{ht:n,parent:s}}function ju(e){let t=Lu(e.parent);const n=e.structuredQuery,r=n.from?n.from.length:0;let s=null;if(r>0){Qs(1===r);const e=n.from[0];e.allDescendants?s=e.collectionId:t=t.child(e.collectionId)}let i=[];n.where&&(i=function(e){const t=$u(e);return t instanceof Ea&&Sa(t)?t.getFilters():[t]}(n.where));let o=[];n.orderBy&&(o=function(e){return e.map((e=>function(e){return new ya(Gu(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))}(e)))}(n.orderBy));let a=null;n.limit&&(a=function(e){let t;return t="object"==typeof e?e.value:e,Wi(t)?null:t}(n.limit));let c=null;n.startAt&&(c=function(e){const t=!!e.before,n=e.values||[];return new pa(n,t)}(n.startAt));let u=null;return n.endAt&&(u=function(e){const t=!e.before,n=e.values||[];return new pa(n,t)}(n.endAt)),$a(t,s,o,i,a,"F",c,u)}function $u(e){return void 0!==e.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":const t=Gu(e.unaryFilter.field);return _a.create(t,"==",{doubleValue:NaN});case"IS_NULL":const n=Gu(e.unaryFilter.field);return _a.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=Gu(e.unaryFilter.field);return _a.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const s=Gu(e.unaryFilter.field);return _a.create(s,"!=",{nullValue:"NULL_VALUE"});default:return Ks()}}(e):void 0!==e.fieldFilter?function(e){return _a.create(Gu(e.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Ks()}}(e.fieldFilter.op),e.fieldFilter.value)}(e):void 0!==e.compositeFilter?function(e){return Ea.create(e.compositeFilter.filters.map((e=>$u(e))),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return Ks()}}(e.compositeFilter.op))}(e):Ks()}function Bu(e){return wu[e]}function qu(e){return _u[e]}function zu(e){return Eu[e]}function Hu(e){return{fieldPath:e.canonicalString()}}function Gu(e){return bi.fromServerFormat(e.fieldPath)}function Ku(e){return e instanceof _a?function(e){if("=="===e.op){if(oa(e.value))return{unaryFilter:{field:Hu(e.field),op:"IS_NAN"}};if(ia(e.value))return{unaryFilter:{field:Hu(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(oa(e.value))return{unaryFilter:{field:Hu(e.field),op:"IS_NOT_NAN"}};if(ia(e.value))return{unaryFilter:{field:Hu(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Hu(e.field),op:qu(e.op),value:e.value}}}(e):e instanceof Ea?function(e){const t=e.getFilters().map((e=>Ku(e)));return 1===t.length?t[0]:{compositeFilter:{op:zu(e.op),filters:t}}}(e):Ks()}function Qu(e){const t=[];return e.fields.forEach((e=>t.push(e.canonicalString()))),{fieldPaths:t}}function Ju(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}class Yu{constructor(e,t,n,r,s=wi.min(),i=wi.min(),o=Co.EMPTY_BYTE_STRING,a=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=i,this.resumeToken=o,this.expectedCount=a}withSequenceNumber(e){return new Yu(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Yu(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Yu(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Yu(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class Xu{constructor(e){this.Tt=e}}function Zu(e){const t=ju({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?Ja(t,t.limit,"L"):t}class el{constructor(){}At(e,t){this.Rt(e,t),t.Vt()}Rt(e,t){if("nullValue"in e)this.ft(t,5);else if("booleanValue"in e)this.ft(t,10),t.gt(e.booleanValue?1:0);else if("integerValue"in e)this.ft(t,15),t.gt(Do(e.integerValue));else if("doubleValue"in e){const n=Do(e.doubleValue);isNaN(n)?this.ft(t,13):(this.ft(t,15),ji(n)?t.gt(0):t.gt(n))}else if("timestampValue"in e){let n=e.timestampValue;this.ft(t,20),"string"==typeof n&&(n=No(n)),t.yt(`${n.seconds||""}`),t.gt(n.nanos||0)}else if("stringValue"in e)this.wt(e.stringValue,t),this.St(t);else if("bytesValue"in e)this.ft(t,30),t.bt(Ro(e.bytesValue)),this.St(t);else if("referenceValue"in e)this.Dt(e.referenceValue,t);else if("geoPointValue"in e){const n=e.geoPointValue;this.ft(t,45),t.gt(n.latitude||0),t.gt(n.longitude||0)}else"mapValue"in e?la(e)?this.ft(t,Number.MAX_SAFE_INTEGER):ca(e)?this.vt(e.mapValue,t):(this.Ct(e.mapValue,t),this.St(t)):"arrayValue"in e?(this.Ft(e.arrayValue,t),this.St(t)):Ks()}wt(e,t){this.ft(t,25),this.Mt(e,t)}Mt(e,t){t.yt(e)}Ct(e,t){const n=e.fields||{};this.ft(t,55);for(const e of Object.keys(n))this.wt(e,t),this.Rt(n[e],t)}vt(e,t){var n,r;const s=e.fields||{};this.ft(t,53);const i=Ho,o=(null===(r=null===(n=s[i].arrayValue)||void 0===n?void 0:n.values)||void 0===r?void 0:r.length)||0;this.ft(t,15),t.gt(Do(o)),this.wt(i,t),this.Rt(s[i],t)}Ft(e,t){const n=e.values||[];this.ft(t,50);for(const e of n)this.Rt(e,t)}Dt(e,t){this.ft(t,37),Ti.fromName(e).path.forEach((e=>{this.ft(t,60),this.Mt(e,t)}))}ft(e,t){e.gt(t)}St(e){e.gt(2)}}el.xt=new el;class tl{constructor(){this.Tn=new nl}addToCollectionParentIndex(e,t){return this.Tn.add(t),Mi.resolve()}getCollectionParents(e,t){return Mi.resolve(this.Tn.getEntries(t))}addFieldIndex(e,t){return Mi.resolve()}deleteFieldIndex(e,t){return Mi.resolve()}deleteAllFieldIndexes(e){return Mi.resolve()}createTargetIndexes(e,t){return Mi.resolve()}getDocumentsMatchingTarget(e,t){return Mi.resolve(null)}getIndexType(e,t){return Mi.resolve(0)}getFieldIndexes(e,t){return Mi.resolve([])}getNextCollectionGroupToUpdate(e){return Mi.resolve(null)}getMinOffset(e,t){return Mi.resolve(Di.min())}getMinOffsetFromCollectionGroup(e,t){return Mi.resolve(Di.min())}updateCollectionGroup(e,t,n){return Mi.resolve()}updateIndexEntries(e,t){return Mi.resolve()}}class nl{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new So(Ii.comparator),s=!r.has(n);return this.index[t]=r.add(n),s}has(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new So(Ii.comparator)).toArray()}}new Uint8Array(0);const rl={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},sl=41943040;class il{static withCacheSize(e){return new il(e,il.DEFAULT_COLLECTION_PERCENTILE,il.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}}il.DEFAULT_COLLECTION_PERCENTILE=10,il.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,il.DEFAULT=new il(sl,il.DEFAULT_COLLECTION_PERCENTILE,il.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),il.DISABLED=new il(-1,0,0);class ol{constructor(e){this.$n=e}next(){return this.$n+=2,this.$n}static Un(){return new ol(0)}static Kn(){return new ol(-1)}}const al="LruGarbageCollector",cl=1048576;function ul([e,t],[n,r]){const s=hi(e,n);return 0===s?hi(t,r):s}class ll{constructor(e){this.Hn=e,this.buffer=new So(ul),this.Jn=0}Yn(){return++this.Jn}Zn(e){const t=[e,this.Yn()];if(this.buffer.size<this.Hn)this.buffer=this.buffer.add(t);else{const e=this.buffer.last();ul(t,e)<0&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class hl{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.Xn=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.er(6e4)}stop(){this.Xn&&(this.Xn.cancel(),this.Xn=null)}get started(){return null!==this.Xn}er(e){qs(al,`Garbage collection scheduled in ${e}ms`),this.Xn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Xn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){Ui(e)?qs(al,"Ignoring IndexedDB error during garbage collection: ",e):await Li(e)}await this.er(3e5)}))}}class dl{constructor(e,t){this.tr=e,this.params=t}calculateTargetCount(e,t){return this.tr.nr(e).next((e=>Math.floor(t/100*e)))}nthSequenceNumber(e,t){if(0===t)return Mi.resolve(Fi.ae);const n=new ll(t);return this.tr.forEachTarget(e,(e=>n.Zn(e.sequenceNumber))).next((()=>this.tr.rr(e,(e=>n.Zn(e))))).next((()=>n.maxValue))}removeTargets(e,t,n){return this.tr.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.tr.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(qs("LruGarbageCollector","Garbage collection skipped; disabled"),Mi.resolve(rl)):this.getCacheSize(e).next((n=>n<this.params.cacheSizeCollectionThreshold?(qs("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),rl):this.ir(e,t)))}getCacheSize(e){return this.tr.getCacheSize(e)}ir(e,t){let n,r,s,i,o,a,c;const u=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((t=>(t>this.params.maximumSequenceNumbersToCollect?(qs("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),r=this.params.maximumSequenceNumbersToCollect):r=t,i=Date.now(),this.nthSequenceNumber(e,r)))).next((r=>(n=r,o=Date.now(),this.removeTargets(e,n,t)))).next((t=>(s=t,a=Date.now(),this.removeOrphanedDocuments(e,n)))).next((e=>(c=Date.now(),Bs()<=x.DEBUG&&qs("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${i-u}ms\n\tDetermined least recently used ${r} in `+(o-i)+"ms\n"+`\tRemoved ${s} targets in `+(a-o)+"ms\n"+`\tRemoved ${e} documents in `+(c-a)+"ms\n"+`Total Duration: ${c-u}ms`),Mi.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:s,documentsRemoved:e}))))}}function fl(e,t){return new dl(e,t)}class pl{constructor(){this.changes=new sc((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,fa.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return void 0!==n?Mi.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class gl{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class ml{constructor(e,t,n,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=r}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next((r=>(n=r,this.remoteDocumentCache.getEntry(e,t)))).next((e=>(null!==n&&Wc(n.mutation,e,To.empty(),vi.now()),e)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((t=>this.getLocalViewOfDocuments(e,t,gc()).next((()=>t))))}getLocalViewOfDocuments(e,t,n=gc()){const r=lc();return this.populateOverlays(e,r,t).next((()=>this.computeViews(e,t,r,n).next((e=>{let t=cc();return e.forEach(((e,n)=>{t=t.insert(e,n.overlayedDocument)})),t}))))}getOverlayedDocuments(e,t){const n=lc();return this.populateOverlays(e,n,t).next((()=>this.computeViews(e,t,n,gc())))}populateOverlays(e,t,n){const r=[];return n.forEach((e=>{t.has(e)||r.push(e)})),this.documentOverlayCache.getOverlays(e,r).next((e=>{e.forEach(((e,n)=>{t.set(e,n)}))}))}computeViews(e,t,n,r){let s=oc();const i=dc(),o=dc();return t.forEach(((e,t)=>{const o=n.get(t.key);r.has(t.key)&&(void 0===o||o.mutation instanceof qc)?s=s.insert(t.key,t):void 0!==o?(i.set(t.key,o.mutation.getFieldMask()),Wc(o.mutation,t,o.mutation.getFieldMask(),vi.now())):i.set(t.key,To.empty())})),this.recalculateAndSaveOverlays(e,s).next((e=>(e.forEach(((e,t)=>i.set(e,t))),t.forEach(((e,t)=>{var n;return o.set(e,new gl(t,null!==(n=i.get(e))&&void 0!==n?n:null))})),o)))}recalculateAndSaveOverlays(e,t){const n=dc();let r=new _o(((e,t)=>e-t)),s=gc();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((e=>{for(const s of e)s.keys().forEach((e=>{const i=t.get(e);if(null===i)return;let o=n.get(e)||To.empty();o=s.applyToLocalView(i,o),n.set(e,o);const a=(r.get(s.batchId)||gc()).add(e);r=r.insert(s.batchId,a)}))})).next((()=>{const i=[],o=r.getReverseIterator();for(;o.hasNext();){const r=o.getNext(),a=r.key,c=r.value,u=hc();c.forEach((e=>{if(!s.has(e)){const r=Fc(t.get(e),n.get(e));null!==r&&u.set(e,r),s=s.add(e)}})),i.push(this.documentOverlayCache.saveOverlays(e,a,u))}return Mi.waitFor(i)})).next((()=>n))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((t=>this.recalculateAndSaveOverlays(e,t)))}getDocumentsMatchingQuery(e,t,n,r){return function(e){return Ti.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):za(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,r):this.getDocumentsMatchingCollectionQuery(e,t,n,r)}getNextDocuments(e,t,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,r).next((s=>{const i=r-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,r-s.size):Mi.resolve(lc());let o=Ai,a=s;return i.next((t=>Mi.forEach(t,((t,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),s.get(t)?Mi.resolve():this.remoteDocumentCache.getEntry(e,t).next((e=>{a=a.insert(t,e)}))))).next((()=>this.populateOverlays(e,t,s))).next((()=>this.computeViews(e,a,t,gc()))).next((e=>({batchId:o,changes:uc(e)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new Ti(t)).next((e=>{let t=cc();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t}))}getDocumentsMatchingCollectionGroupQuery(e,t,n,r){const s=t.collectionGroup;let i=cc();return this.indexManager.getCollectionParents(e,s).next((o=>Mi.forEach(o,(o=>{const a=function(e,t){return new ja(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(t,o.child(s));return this.getDocumentsMatchingCollectionQuery(e,a,n,r).next((e=>{e.forEach(((e,t)=>{i=i.insert(e,t)}))}))})).next((()=>i))))}getDocumentsMatchingCollectionQuery(e,t,n,r){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next((i=>(s=i,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,s,r)))).next((e=>{s.forEach(((t,n)=>{const r=n.getKey();null===e.get(r)&&(e=e.insert(r,fa.newInvalidDocument(r)))}));let n=cc();return e.forEach(((e,r)=>{const i=s.get(e);void 0!==i&&Wc(i.mutation,r,To.empty(),vi.now()),ec(t,r)&&(n=n.insert(e,r))})),n}))}}class yl{constructor(e){this.serializer=e,this.dr=new Map,this.Ar=new Map}getBundleMetadata(e,t){return Mi.resolve(this.dr.get(t))}saveBundleMetadata(e,t){return this.dr.set(t.id,function(e){return{id:e.id,version:e.version,createTime:Cu(e.createTime)}}(t)),Mi.resolve()}getNamedQuery(e,t){return Mi.resolve(this.Ar.get(t))}saveNamedQuery(e,t){return this.Ar.set(t.name,function(e){return{name:e.name,query:Zu(e.bundledQuery),readTime:Cu(e.readTime)}}(t)),Mi.resolve()}}class vl{constructor(){this.overlays=new _o(Ti.comparator),this.Rr=new Map}getOverlay(e,t){return Mi.resolve(this.overlays.get(t))}getOverlays(e,t){const n=lc();return Mi.forEach(t,(t=>this.getOverlay(e,t).next((e=>{null!==e&&n.set(t,e)})))).next((()=>n))}saveOverlays(e,t,n){return n.forEach(((n,r)=>{this.Et(e,t,r)})),Mi.resolve()}removeOverlaysForBatchId(e,t,n){const r=this.Rr.get(n);return void 0!==r&&(r.forEach((e=>this.overlays=this.overlays.remove(e))),this.Rr.delete(n)),Mi.resolve()}getOverlaysForCollection(e,t,n){const r=lc(),s=t.length+1,i=new Ti(t.child("")),o=this.overlays.getIteratorFrom(i);for(;o.hasNext();){const e=o.getNext().value,i=e.getKey();if(!t.isPrefixOf(i.path))break;i.path.length===s&&e.largestBatchId>n&&r.set(e.getKey(),e)}return Mi.resolve(r)}getOverlaysForCollectionGroup(e,t,n,r){let s=new _o(((e,t)=>e-t));const i=this.overlays.getIterator();for(;i.hasNext();){const e=i.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>n){let t=s.get(e.largestBatchId);null===t&&(t=lc(),s=s.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}const o=lc(),a=s.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach(((e,t)=>o.set(e,t))),!(o.size()>=r)););return Mi.resolve(o)}Et(e,t,n){const r=this.overlays.get(n.key);if(null!==r){const e=this.Rr.get(r.largestBatchId).delete(n.key);this.Rr.set(r.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new Xc(t,n));let s=this.Rr.get(t);void 0===s&&(s=gc(),this.Rr.set(t,s)),this.Rr.set(t,s.add(n.key))}}class wl{constructor(){this.sessionToken=Co.EMPTY_BYTE_STRING}getSessionToken(e){return Mi.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,Mi.resolve()}}class _l{constructor(){this.Vr=new So(El.mr),this.gr=new So(El.pr)}isEmpty(){return this.Vr.isEmpty()}addReference(e,t){const n=new El(e,t);this.Vr=this.Vr.add(n),this.gr=this.gr.add(n)}yr(e,t){e.forEach((e=>this.addReference(e,t)))}removeReference(e,t){this.wr(new El(e,t))}Sr(e,t){e.forEach((e=>this.removeReference(e,t)))}br(e){const t=new Ti(new Ii([])),n=new El(t,e),r=new El(t,e+1),s=[];return this.gr.forEachInRange([n,r],(e=>{this.wr(e),s.push(e.key)})),s}Dr(){this.Vr.forEach((e=>this.wr(e)))}wr(e){this.Vr=this.Vr.delete(e),this.gr=this.gr.delete(e)}vr(e){const t=new Ti(new Ii([])),n=new El(t,e),r=new El(t,e+1);let s=gc();return this.gr.forEachInRange([n,r],(e=>{s=s.add(e.key)})),s}containsKey(e){const t=new El(e,0),n=this.Vr.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class El{constructor(e,t){this.key=e,this.Cr=t}static mr(e,t){return Ti.comparator(e.key,t.key)||hi(e.Cr,t.Cr)}static pr(e,t){return hi(e.Cr,t.Cr)||Ti.comparator(e.key,t.key)}}class Il{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Fr=1,this.Mr=new So(El.mr)}checkEmpty(e){return Mi.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,r){const s=this.Fr;this.Fr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const i=new Jc(s,t,n,r);this.mutationQueue.push(i);for(const t of r)this.Mr=this.Mr.add(new El(t.key,s)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return Mi.resolve(i)}lookupMutationBatch(e,t){return Mi.resolve(this.Or(t))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,r=this.Nr(n),s=r<0?0:r;return Mi.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return Mi.resolve(0===this.mutationQueue.length?Vi:this.Fr-1)}getAllMutationBatches(e){return Mi.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new El(t,0),r=new El(t,Number.POSITIVE_INFINITY),s=[];return this.Mr.forEachInRange([n,r],(e=>{const t=this.Or(e.Cr);s.push(t)})),Mi.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new So(hi);return t.forEach((e=>{const t=new El(e,0),r=new El(e,Number.POSITIVE_INFINITY);this.Mr.forEachInRange([t,r],(e=>{n=n.add(e.Cr)}))})),Mi.resolve(this.Br(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1;let s=n;Ti.isDocumentKey(s)||(s=s.child(""));const i=new El(new Ti(s),0);let o=new So(hi);return this.Mr.forEachWhile((e=>{const t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(o=o.add(e.Cr)),!0)}),i),Mi.resolve(this.Br(o))}Br(e){const t=[];return e.forEach((e=>{const n=this.Or(e);null!==n&&t.push(n)})),t}removeMutationBatch(e,t){Qs(0===this.Lr(t.batchId,"removed")),this.mutationQueue.shift();let n=this.Mr;return Mi.forEach(t.mutations,(r=>{const s=new El(r.key,t.batchId);return n=n.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)})).next((()=>{this.Mr=n}))}qn(e){}containsKey(e,t){const n=new El(t,0),r=this.Mr.firstAfterOrEqual(n);return Mi.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,Mi.resolve()}Lr(e,t){return this.Nr(e)}Nr(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Or(e){const t=this.Nr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class Sl{constructor(e){this.kr=e,this.docs=new _o(Ti.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,r=this.docs.get(n),s=r?r.size:0,i=this.kr(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:i}),this.size+=i-s,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return Mi.resolve(n?n.document.mutableCopy():fa.newInvalidDocument(t))}getEntries(e,t){let n=oc();return t.forEach((e=>{const t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():fa.newInvalidDocument(e))})),Mi.resolve(n)}getDocumentsMatchingQuery(e,t,n,r){let s=oc();const i=t.path,o=new Ti(i.child("__id-9223372036854775808__")),a=this.docs.getIteratorFrom(o);for(;a.hasNext();){const{key:e,value:{document:o}}=a.getNext();if(!i.isPrefixOf(e.path))break;e.path.length>i.length+1||Ri(Ni(o),n)<=0||(r.has(o.key)||ec(t,o))&&(s=s.insert(o.key,o.mutableCopy()))}return Mi.resolve(s)}getAllFromCollectionGroup(e,t,n,r){Ks()}qr(e,t){return Mi.forEach(this.docs,(e=>t(e)))}newChangeBuffer(e){return new bl(this)}getSize(e){return Mi.resolve(this.size)}}class bl extends pl{constructor(e){super(),this.Ir=e}applyChanges(e){const t=[];return this.changes.forEach(((n,r)=>{r.isValidDocument()?t.push(this.Ir.addEntry(e,r)):this.Ir.removeEntry(n)})),Mi.waitFor(t)}getFromCache(e,t){return this.Ir.getEntry(e,t)}getAllFromCache(e,t){return this.Ir.getEntries(e,t)}}class Tl{constructor(e){this.persistence=e,this.Qr=new sc((e=>Fa(e)),Va),this.lastRemoteSnapshotVersion=wi.min(),this.highestTargetId=0,this.$r=0,this.Ur=new _l,this.targetCount=0,this.Kr=ol.Un()}forEachTarget(e,t){return this.Qr.forEach(((e,n)=>t(n))),Mi.resolve()}getLastRemoteSnapshotVersion(e){return Mi.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return Mi.resolve(this.$r)}allocateTargetId(e){return this.highestTargetId=this.Kr.next(),Mi.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.$r&&(this.$r=t),Mi.resolve()}zn(e){this.Qr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.Kr=new ol(t),this.highestTargetId=t),e.sequenceNumber>this.$r&&(this.$r=e.sequenceNumber)}addTargetData(e,t){return this.zn(t),this.targetCount+=1,Mi.resolve()}updateTargetData(e,t){return this.zn(t),Mi.resolve()}removeTargetData(e,t){return this.Qr.delete(t.target),this.Ur.br(t.targetId),this.targetCount-=1,Mi.resolve()}removeTargets(e,t,n){let r=0;const s=[];return this.Qr.forEach(((i,o)=>{o.sequenceNumber<=t&&null===n.get(o.targetId)&&(this.Qr.delete(i),s.push(this.removeMatchingKeysForTargetId(e,o.targetId)),r++)})),Mi.waitFor(s).next((()=>r))}getTargetCount(e){return Mi.resolve(this.targetCount)}getTargetData(e,t){const n=this.Qr.get(t)||null;return Mi.resolve(n)}addMatchingKeys(e,t,n){return this.Ur.yr(t,n),Mi.resolve()}removeMatchingKeys(e,t,n){this.Ur.Sr(t,n);const r=this.persistence.referenceDelegate,s=[];return r&&t.forEach((t=>{s.push(r.markPotentiallyOrphaned(e,t))})),Mi.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.Ur.br(t),Mi.resolve()}getMatchingKeysForTargetId(e,t){const n=this.Ur.vr(t);return Mi.resolve(n)}containsKey(e,t){return Mi.resolve(this.Ur.containsKey(t))}}class Al{constructor(e,t){this.Wr={},this.overlays={},this.Gr=new Fi(0),this.zr=!1,this.zr=!0,this.jr=new wl,this.referenceDelegate=e(this),this.Hr=new Tl(this),this.indexManager=new tl,this.remoteDocumentCache=function(e){return new Sl(e)}((e=>this.referenceDelegate.Jr(e))),this.serializer=new Xu(t),this.Yr=new yl(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.zr=!1,Promise.resolve()}get started(){return this.zr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new vl,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.Wr[e.toKey()];return n||(n=new Il(t,this.referenceDelegate),this.Wr[e.toKey()]=n),n}getGlobalsCache(){return this.jr}getTargetCache(){return this.Hr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Yr}runTransaction(e,t,n){qs("MemoryPersistence","Starting transaction:",e);const r=new Cl(this.Gr.next());return this.referenceDelegate.Zr(),n(r).next((e=>this.referenceDelegate.Xr(r).next((()=>e)))).toPromise().then((e=>(r.raiseOnCommittedEvent(),e)))}ei(e,t){return Mi.or(Object.values(this.Wr).map((n=>()=>n.containsKey(e,t))))}}class Cl extends Pi{constructor(e){super(),this.currentSequenceNumber=e}}class kl{constructor(e){this.persistence=e,this.ti=new _l,this.ni=null}static ri(e){return new kl(e)}get ii(){if(this.ni)return this.ni;throw Ks()}addReference(e,t,n){return this.ti.addReference(n,t),this.ii.delete(n.toString()),Mi.resolve()}removeReference(e,t,n){return this.ti.removeReference(n,t),this.ii.add(n.toString()),Mi.resolve()}markPotentiallyOrphaned(e,t){return this.ii.add(t.toString()),Mi.resolve()}removeTarget(e,t){this.ti.br(t.targetId).forEach((e=>this.ii.add(e.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next((e=>{e.forEach((e=>this.ii.add(e.toString())))})).next((()=>n.removeTargetData(e,t)))}Zr(){this.ni=new Set}Xr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Mi.forEach(this.ii,(n=>{const r=Ti.fromPath(n);return this.si(e,r).next((e=>{e||t.removeEntry(r,wi.min())}))})).next((()=>(this.ni=null,t.apply(e))))}updateLimboDocument(e,t){return this.si(e,t).next((e=>{e?this.ii.delete(t.toString()):this.ii.add(t.toString())}))}Jr(e){return 0}si(e,t){return Mi.or([()=>Mi.resolve(this.ti.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.ei(e,t)])}}class Nl{constructor(e,t){this.persistence=e,this.oi=new sc((e=>qi(e.path)),((e,t)=>e.isEqual(t))),this.garbageCollector=fl(this,t)}static ri(e,t){return new Nl(e,t)}Zr(){}Xr(e){return Mi.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}nr(e){const t=this.sr(e);return this.persistence.getTargetCache().getTargetCount(e).next((e=>t.next((t=>e+t))))}sr(e){let t=0;return this.rr(e,(e=>{t++})).next((()=>t))}rr(e,t){return Mi.forEach(this.oi,((n,r)=>this.ar(e,n,r).next((e=>e?Mi.resolve():t(r)))))}removeTargets(e,t,n){return this.persistence.getTargetCache().removeTargets(e,t,n)}removeOrphanedDocuments(e,t){let n=0;const r=this.persistence.getRemoteDocumentCache(),s=r.newChangeBuffer();return r.qr(e,(r=>this.ar(e,r,t).next((e=>{e||(n++,s.removeEntry(r,wi.min()))})))).next((()=>s.apply(e))).next((()=>n))}markPotentiallyOrphaned(e,t){return this.oi.set(t,e.currentSequenceNumber),Mi.resolve()}removeTarget(e,t){const n=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,n)}addReference(e,t,n){return this.oi.set(n,e.currentSequenceNumber),Mi.resolve()}removeReference(e,t,n){return this.oi.set(n,e.currentSequenceNumber),Mi.resolve()}updateLimboDocument(e,t){return this.oi.set(t,e.currentSequenceNumber),Mi.resolve()}Jr(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=ta(e.data.value)),t}ar(e,t,n){return Mi.or([()=>this.persistence.ei(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const e=this.oi.get(t);return Mi.resolve(void 0!==e&&e>n)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class Dl{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.Hi=n,this.Ji=r}static Yi(e,t){let n=gc(),r=gc();for(const e of t.docChanges)switch(e.type){case 0:n=n.add(e.doc.key);break;case 1:r=r.add(e.doc.key)}return new Dl(e,t.fromCache,n,r)}}class Rl{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class Ol{constructor(){this.Zi=!1,this.Xi=!1,this.es=100,this.ts=v()?8:xi(y())>0?6:4}initialize(e,t){this.ns=e,this.indexManager=t,this.Zi=!0}getDocumentsMatchingQuery(e,t,n,r){const s={result:null};return this.rs(e,t).next((e=>{s.result=e})).next((()=>{if(!s.result)return this.ss(e,t,r,n).next((e=>{s.result=e}))})).next((()=>{if(s.result)return;const n=new Rl;return this._s(e,t,n).next((r=>{if(s.result=r,this.Xi)return this.us(e,t,n,r.size)}))})).next((()=>s.result))}us(e,t,n,r){return n.documentReadCount<this.es?(Bs()<=x.DEBUG&&qs("QueryEngine","SDK will not create cache indexes for query:",Za(t),"since it only creates cache indexes for collection contains","more than or equal to",this.es,"documents"),Mi.resolve()):(Bs()<=x.DEBUG&&qs("QueryEngine","Query:",Za(t),"scans",n.documentReadCount,"local documents and returns",r,"documents as results."),n.documentReadCount>this.ts*r?(Bs()<=x.DEBUG&&qs("QueryEngine","The SDK decides to create cache indexes for query:",Za(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Ga(t))):Mi.resolve())}rs(e,t){if(qa(t))return Mi.resolve(null);let n=Ga(t);return this.indexManager.getIndexType(e,n).next((r=>0===r?null:(null!==t.limit&&1===r&&(t=Ja(t,null,"F"),n=Ga(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next((r=>{const s=gc(...r);return this.ns.getDocuments(e,s).next((r=>this.indexManager.getMinOffset(e,n).next((n=>{const i=this.cs(t,r);return this.ls(t,i,s,n.readTime)?this.rs(e,Ja(t,null,"F")):this.hs(e,i,t,n)}))))})))))}ss(e,t,n,r){return qa(t)||r.isEqual(wi.min())?Mi.resolve(null):this.ns.getDocuments(e,n).next((s=>{const i=this.cs(t,s);return this.ls(t,i,n,r)?Mi.resolve(null):(Bs()<=x.DEBUG&&qs("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),Za(t)),this.hs(e,i,t,ki(r,Ai)).next((e=>e)))}))}cs(e,t){let n=new So(nc(e));return t.forEach(((t,r)=>{ec(e,r)&&(n=n.add(r))})),n}ls(e,t,n,r){if(null===e.limit)return!1;if(n.size!==t.size)return!0;const s="F"===e.limitType?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(r)>0)}_s(e,t,n){return Bs()<=x.DEBUG&&qs("QueryEngine","Using full collection scan to execute query:",Za(t)),this.ns.getDocumentsMatchingQuery(e,t,Di.min(),n)}hs(e,t,n,r){return this.ns.getDocumentsMatchingQuery(e,n,r).next((e=>(t.forEach((t=>{e=e.insert(t.key,t)})),e)))}}const Pl="LocalStore";class Ll{constructor(e,t,n,r){this.persistence=e,this.Ps=t,this.serializer=r,this.Ts=new _o(hi),this.Is=new sc((e=>Fa(e)),Va),this.Es=new Map,this.ds=e.getRemoteDocumentCache(),this.Hr=e.getTargetCache(),this.Yr=e.getBundleCache(),this.As(n)}As(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new ml(this.ds,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.ds.setIndexManager(this.indexManager),this.Ps.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.Ts)))}}function Ml(e,t,n,r){return new Ll(e,t,n,r)}async function xl(e,t){const n=Js(e);return await n.persistence.runTransaction("Handle user change","readonly",(e=>{let r;return n.mutationQueue.getAllMutationBatches(e).next((s=>(r=s,n.As(t),n.mutationQueue.getAllMutationBatches(e)))).next((t=>{const s=[],i=[];let o=gc();for(const e of r){s.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}for(const e of t){i.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}return n.localDocuments.getDocuments(e,o).next((e=>({Rs:e,removedBatchIds:s,addedBatchIds:i})))}))}))}function Ul(e){const t=Js(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",(e=>t.Hr.getLastRemoteSnapshotVersion(e)))}function Fl(e,t,n){let r=gc(),s=gc();return n.forEach((e=>r=r.add(e))),t.getEntries(e,r).next((e=>{let r=oc();return n.forEach(((n,i)=>{const o=e.get(n);i.isFoundDocument()!==o.isFoundDocument()&&(s=s.add(n)),i.isNoDocument()&&i.version.isEqual(wi.min())?(t.removeEntry(n,i.readTime),r=r.insert(n,i)):!o.isValidDocument()||i.version.compareTo(o.version)>0||0===i.version.compareTo(o.version)&&o.hasPendingWrites?(t.addEntry(i),r=r.insert(n,i)):qs(Pl,"Ignoring outdated watch update for ",n,". Current version:",o.version," Watch version:",i.version)})),{Vs:r,fs:s}}))}function Vl(e,t){const n=Js(e);return n.persistence.runTransaction("Get next mutation batch","readonly",(e=>(void 0===t&&(t=Vi),n.mutationQueue.getNextMutationBatchAfterBatchId(e,t))))}function Wl(e,t){const n=Js(e);return n.persistence.runTransaction("Allocate target","readwrite",(e=>{let r;return n.Hr.getTargetData(e,t).next((s=>s?(r=s,Mi.resolve(r)):n.Hr.allocateTargetId(e).next((s=>(r=new Yu(t,s,"TargetPurposeListen",e.currentSequenceNumber),n.Hr.addTargetData(e,r).next((()=>r)))))))})).then((e=>{const r=n.Ts.get(e.targetId);return(null===r||e.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.Ts=n.Ts.insert(e.targetId,e),n.Is.set(t,e.targetId)),e}))}async function jl(e,t,n){const r=Js(e),s=r.Ts.get(t),i=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",i,(e=>r.persistence.referenceDelegate.removeTarget(e,s)))}catch(e){if(!Ui(e))throw e;qs(Pl,`Failed to update sequence numbers for target ${t}: ${e}`)}r.Ts=r.Ts.remove(t),r.Is.delete(s.target)}function $l(e,t,n){const r=Js(e);let s=wi.min(),i=gc();return r.persistence.runTransaction("Execute query","readwrite",(e=>function(e,t,n){const r=Js(e),s=r.Is.get(n);return void 0!==s?Mi.resolve(r.Ts.get(s)):r.Hr.getTargetData(t,n)}(r,e,Ga(t)).next((t=>{if(t)return s=t.lastLimboFreeSnapshotVersion,r.Hr.getMatchingKeysForTargetId(e,t.targetId).next((e=>{i=e}))})).next((()=>r.Ps.getDocumentsMatchingQuery(e,t,n?s:wi.min(),n?i:gc()))).next((e=>(Bl(r,tc(t),e),{documents:e,gs:i})))))}function Bl(e,t,n){let r=e.Es.get(t)||wi.min();n.forEach(((e,t)=>{t.readTime.compareTo(r)>0&&(r=t.readTime)})),e.Es.set(t,r)}class ql{constructor(){this.activeTargetIds=yc()}Ds(e){this.activeTargetIds=this.activeTargetIds.add(e)}vs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}bs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class zl{constructor(){this.ho=new ql,this.Po={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e,t=!0){return t&&this.ho.Ds(e),this.Po[e]||"not-current"}updateQueryState(e,t,n){this.Po[e]=t}removeLocalQueryTarget(e){this.ho.vs(e)}isLocalQueryTarget(e){return this.ho.activeTargetIds.has(e)}clearQueryState(e){delete this.Po[e]}getAllActiveQueryTargets(){return this.ho.activeTargetIds}isActiveQueryTarget(e){return this.ho.activeTargetIds.has(e)}start(){return this.ho=new ql,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class Hl{To(e){}shutdown(){}}const Gl="ConnectivityMonitor";class Kl{constructor(){this.Io=()=>this.Eo(),this.Ao=()=>this.Ro(),this.Vo=[],this.mo()}To(e){this.Vo.push(e)}shutdown(){window.removeEventListener("online",this.Io),window.removeEventListener("offline",this.Ao)}mo(){window.addEventListener("online",this.Io),window.addEventListener("offline",this.Ao)}Eo(){qs(Gl,"Network connectivity changed: AVAILABLE");for(const e of this.Vo)e(0)}Ro(){qs(Gl,"Network connectivity changed: UNAVAILABLE");for(const e of this.Vo)e(1)}static D(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let Ql=null;function Jl(){return null===Ql?Ql=268435456+Math.round(2147483648*Math.random()):Ql++,"0x"+Ql.toString(16)}const Yl="RestConnection",Xl={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class Zl{get fo(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.po=t+"://"+e.host,this.yo=`projects/${n}/databases/${r}`,this.wo=this.databaseId.database===Wo?`project_id=${n}`:`project_id=${n}&database_id=${r}`}So(e,t,n,r,s){const i=Jl(),o=this.bo(e,t.toUriEncodedString());qs(Yl,`Sending RPC '${e}' ${i}:`,o,n);const a={"google-cloud-resource-prefix":this.yo,"x-goog-request-params":this.wo};return this.Do(a,r,s),this.vo(e,o,a,n).then((t=>(qs(Yl,`Received RPC '${e}' ${i}: `,t),t)),(t=>{throw Hs(Yl,`RPC '${e}' ${i} failed with error: `,t,"url: ",o,"request:",n),t}))}Co(e,t,n,r,s,i){return this.So(e,t,n,r,s)}Do(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+js,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((t,n)=>e[n]=t)),n&&n.headers.forEach(((t,n)=>e[n]=t))}bo(e,t){const n=Xl[e];return`${this.po}/v1/${t}:${n}`}terminate(){}}class eh{constructor(e){this.Fo=e.Fo,this.Mo=e.Mo}xo(e){this.Oo=e}No(e){this.Bo=e}Lo(e){this.ko=e}onMessage(e){this.qo=e}close(){this.Mo()}send(e){this.Fo(e)}Qo(){this.Oo()}$o(){this.Bo()}Uo(e){this.ko(e)}Ko(e){this.qo(e)}}const th="WebChannelConnection";class nh extends Zl{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}vo(e,t,n,r){const s=Jl();return new Promise(((i,o)=>{const a=new ks;a.setWithCredentials(!0),a.listenOnce(Ds.COMPLETE,(()=>{try{switch(a.getLastErrorCode()){case Rs.NO_ERROR:const t=a.getResponseJson();qs(th,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(t)),i(t);break;case Rs.TIMEOUT:qs(th,`RPC '${e}' ${s} timed out`),o(new Xs(Ys.DEADLINE_EXCEEDED,"Request time out"));break;case Rs.HTTP_ERROR:const n=a.getStatus();if(qs(th,`RPC '${e}' ${s} failed with status:`,n,"response text:",a.getResponseText()),n>0){let e=a.getResponseJson();Array.isArray(e)&&(e=e[0]);const t=null==e?void 0:e.error;if(t&&t.status&&t.message){const e=function(e){const t=e.toLowerCase().replace(/_/g,"-");return Object.values(Ys).indexOf(t)>=0?t:Ys.UNKNOWN}(t.status);o(new Xs(e,t.message))}else o(new Xs(Ys.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new Xs(Ys.UNAVAILABLE,"Connection failed."));break;default:Ks()}}finally{qs(th,`RPC '${e}' ${s} completed.`)}}));const c=JSON.stringify(r);qs(th,`RPC '${e}' ${s} sending request:`,r),a.send(t,"POST",c,n,15)}))}Wo(e,t,n){const r=Jl(),s=[this.po,"/","google.firestore.v1.Firestore","/",e,"/channel"],i=Ms(),o=Ls(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;void 0!==c&&(a.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(a.useFetchStreams=!0),this.Do(a.initMessageHeaders,t,n),a.encodeInitMessageHeaders=!0;const u=s.join("");qs(th,`Creating RPC '${e}' stream ${r}: ${u}`,a);const l=i.createWebChannel(u,a);let h=!1,d=!1;const f=new eh({Fo:t=>{d?qs(th,`Not sending because RPC '${e}' stream ${r} is closed:`,t):(h||(qs(th,`Opening RPC '${e}' stream ${r} transport.`),l.open(),h=!0),qs(th,`RPC '${e}' stream ${r} sending:`,t),l.send(t))},Mo:()=>l.close()}),p=(e,t,n)=>{e.listen(t,(e=>{try{n(e)}catch(e){setTimeout((()=>{throw e}),0)}}))};return p(l,Ns.EventType.OPEN,(()=>{d||(qs(th,`RPC '${e}' stream ${r} transport opened.`),f.Qo())})),p(l,Ns.EventType.CLOSE,(()=>{d||(d=!0,qs(th,`RPC '${e}' stream ${r} transport closed`),f.Uo())})),p(l,Ns.EventType.ERROR,(t=>{d||(d=!0,Hs(th,`RPC '${e}' stream ${r} transport errored:`,t),f.Uo(new Xs(Ys.UNAVAILABLE,"The operation could not be completed")))})),p(l,Ns.EventType.MESSAGE,(t=>{var n;if(!d){const s=t.data[0];Qs(!!s);const i=s,o=(null==i?void 0:i.error)||(null===(n=i[0])||void 0===n?void 0:n.error);if(o){qs(th,`RPC '${e}' stream ${r} received error:`,o);const t=o.status;let n=function(e){const t=eu[e];if(void 0!==t)return ru(t)}(t),s=o.message;void 0===n&&(n=Ys.INTERNAL,s="Unknown error status: "+t+" with message "+o.message),d=!0,f.Uo(new Xs(n,s)),l.close()}else qs(th,`RPC '${e}' stream ${r} received:`,s),f.Ko(s)}})),p(o,Ps.STAT_EVENT,(t=>{t.stat===Os.PROXY?qs(th,`RPC '${e}' stream ${r} detected buffering proxy`):t.stat===Os.NOPROXY&&qs(th,`RPC '${e}' stream ${r} detected no buffering proxy`)})),setTimeout((()=>{f.$o()}),0),f}}function rh(){return"undefined"!=typeof document?document:null}function sh(e){return new Iu(e,!0)}class ih{constructor(e,t,n=1e3,r=1.5,s=6e4){this.Ti=e,this.timerId=t,this.Go=n,this.zo=r,this.jo=s,this.Ho=0,this.Jo=null,this.Yo=Date.now(),this.reset()}reset(){this.Ho=0}Zo(){this.Ho=this.jo}Xo(e){this.cancel();const t=Math.floor(this.Ho+this.e_()),n=Math.max(0,Date.now()-this.Yo),r=Math.max(0,t-n);r>0&&qs("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.Ho} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.Jo=this.Ti.enqueueAfterDelay(this.timerId,r,(()=>(this.Yo=Date.now(),e()))),this.Ho*=this.zo,this.Ho<this.Go&&(this.Ho=this.Go),this.Ho>this.jo&&(this.Ho=this.jo)}t_(){null!==this.Jo&&(this.Jo.skipDelay(),this.Jo=null)}cancel(){null!==this.Jo&&(this.Jo.cancel(),this.Jo=null)}e_(){return(Math.random()-.5)*this.Ho}}const oh="PersistentStream";class ah{constructor(e,t,n,r,s,i,o,a){this.Ti=e,this.n_=n,this.r_=r,this.connection=s,this.authCredentialsProvider=i,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.i_=0,this.s_=null,this.o_=null,this.stream=null,this.__=0,this.a_=new ih(e,t)}u_(){return 1===this.state||5===this.state||this.c_()}c_(){return 2===this.state||3===this.state}start(){this.__=0,4!==this.state?this.auth():this.l_()}async stop(){this.u_()&&await this.close(0)}h_(){this.state=0,this.a_.reset()}P_(){this.c_()&&null===this.s_&&(this.s_=this.Ti.enqueueAfterDelay(this.n_,6e4,(()=>this.T_())))}I_(e){this.E_(),this.stream.send(e)}async T_(){if(this.c_())return this.close(0)}E_(){this.s_&&(this.s_.cancel(),this.s_=null)}d_(){this.o_&&(this.o_.cancel(),this.o_=null)}async close(e,t){this.E_(),this.d_(),this.a_.cancel(),this.i_++,4!==e?this.a_.reset():t&&t.code===Ys.RESOURCE_EXHAUSTED?(zs(t.toString()),zs("Using maximum backoff delay to prevent overloading the backend."),this.a_.Zo()):t&&t.code===Ys.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.A_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.Lo(t)}A_(){}auth(){this.state=1;const e=this.R_(this.i_),t=this.i_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([e,n])=>{this.i_===t&&this.V_(e,n)}),(t=>{e((()=>{const e=new Xs(Ys.UNKNOWN,"Fetching auth token failed: "+t.message);return this.m_(e)}))}))}V_(e,t){const n=this.R_(this.i_);this.stream=this.f_(e,t),this.stream.xo((()=>{n((()=>this.listener.xo()))})),this.stream.No((()=>{n((()=>(this.state=2,this.o_=this.Ti.enqueueAfterDelay(this.r_,1e4,(()=>(this.c_()&&(this.state=3),Promise.resolve()))),this.listener.No())))})),this.stream.Lo((e=>{n((()=>this.m_(e)))})),this.stream.onMessage((e=>{n((()=>1==++this.__?this.g_(e):this.onNext(e)))}))}l_(){this.state=5,this.a_.Xo((async()=>{this.state=0,this.start()}))}m_(e){return qs(oh,`close with error: ${e}`),this.stream=null,this.close(4,e)}R_(e){return t=>{this.Ti.enqueueAndForget((()=>this.i_===e?t():(qs(oh,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class ch extends ah{constructor(e,t,n,r,s,i){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,r,i),this.serializer=s}f_(e,t){return this.connection.Wo("Listen",e,t)}g_(e){return this.onNext(e)}onNext(e){this.a_.reset();const t=function(e,t){let n;if("targetChange"in t){t.targetChange;const r=function(e){return"NO_CHANGE"===e?0:"ADD"===e?1:"REMOVE"===e?2:"CURRENT"===e?3:"RESET"===e?4:Ks()}(t.targetChange.targetChangeType||"NO_CHANGE"),s=t.targetChange.targetIds||[],i=function(e,t){return e.useProto3Json?(Qs(void 0===t||"string"==typeof t),Co.fromBase64String(t||"")):(Qs(void 0===t||t instanceof Buffer||t instanceof Uint8Array),Co.fromUint8Array(t||new Uint8Array))}(e,t.targetChange.resumeToken),o=t.targetChange.cause,a=o&&function(e){const t=void 0===e.code?Ys.UNKNOWN:ru(e.code);return new Xs(t,e.message||"")}(o);n=new pu(r,s,i,a||null)}else if("documentChange"in t){t.documentChange;const r=t.documentChange;r.document,r.document.name,r.document.updateTime;const s=Ou(e,r.document.name),i=Cu(r.document.updateTime),o=r.document.createTime?Cu(r.document.createTime):wi.min(),a=new ha({mapValue:{fields:r.document.fields}}),c=fa.newFoundDocument(s,i,o,a),u=r.targetIds||[],l=r.removedTargetIds||[];n=new du(u,l,c.key,c)}else if("documentDelete"in t){t.documentDelete;const r=t.documentDelete;r.document;const s=Ou(e,r.document),i=r.readTime?Cu(r.readTime):wi.min(),o=fa.newNoDocument(s,i),a=r.removedTargetIds||[];n=new du([],a,o.key,o)}else if("documentRemove"in t){t.documentRemove;const r=t.documentRemove;r.document;const s=Ou(e,r.document),i=r.removedTargetIds||[];n=new du([],i,s,null)}else{if(!("filter"in t))return Ks();{t.filter;const e=t.filter;e.targetId;const{count:r=0,unchangedNames:s}=e,i=new Zc(r,s),o=e.targetId;n=new fu(o,i)}}return n}(this.serializer,e),n=function(e){if(!("targetChange"in e))return wi.min();const t=e.targetChange;return t.targetIds&&t.targetIds.length?wi.min():t.readTime?Cu(t.readTime):wi.min()}(e);return this.listener.p_(t,n)}y_(e){const t={};t.database=Mu(this.serializer),t.addTarget=function(e,t){let n;const r=t.target;if(n=Wa(r)?{documents:Vu(e,r)}:{query:Wu(e,r).ht},n.targetId=t.targetId,t.resumeToken.approximateByteSize()>0){n.resumeToken=Tu(e,t.resumeToken);const r=Su(e,t.expectedCount);null!==r&&(n.expectedCount=r)}else if(t.snapshotVersion.compareTo(wi.min())>0){n.readTime=bu(e,t.snapshotVersion.toTimestamp());const r=Su(e,t.expectedCount);null!==r&&(n.expectedCount=r)}return n}(this.serializer,e);const n=function(e,t){const n=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Ks()}}(t.purpose);return null==n?null:{"goog-listen-tags":n}}(this.serializer,e);n&&(t.labels=n),this.I_(t)}w_(e){const t={};t.database=Mu(this.serializer),t.removeTarget=e,this.I_(t)}}class uh extends ah{constructor(e,t,n,r,s,i){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,r,i),this.serializer=s}get S_(){return this.__>0}start(){this.lastStreamToken=void 0,super.start()}A_(){this.S_&&this.b_([])}f_(e,t){return this.connection.Wo("Write",e,t)}g_(e){return Qs(!!e.streamToken),this.lastStreamToken=e.streamToken,Qs(!e.writeResults||0===e.writeResults.length),this.listener.D_()}onNext(e){Qs(!!e.streamToken),this.lastStreamToken=e.streamToken,this.a_.reset();const t=function(e,t){return e&&e.length>0?(Qs(void 0!==t),e.map((e=>function(e,t){let n=e.updateTime?Cu(e.updateTime):Cu(t);return n.isEqual(wi.min())&&(n=Cu(t)),new Lc(n,e.transformResults||[])}(e,t)))):[]}(e.writeResults,e.commitTime),n=Cu(e.commitTime);return this.listener.v_(n,t)}C_(){const e={};e.database=Mu(this.serializer),this.I_(e)}b_(e){const t={streamToken:this.lastStreamToken,writes:e.map((e=>Fu(this.serializer,e)))};this.I_(t)}}class lh{}class hh extends lh{constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=r,this.F_=!1}M_(){if(this.F_)throw new Xs(Ys.FAILED_PRECONDITION,"The client has already been terminated.")}So(e,t,n,r){return this.M_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([s,i])=>this.connection.So(e,Nu(t,n),r,s,i))).catch((e=>{throw"FirebaseError"===e.name?(e.code===Ys.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new Xs(Ys.UNKNOWN,e.toString())}))}Co(e,t,n,r,s){return this.M_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([i,o])=>this.connection.Co(e,Nu(t,n),r,i,o,s))).catch((e=>{throw"FirebaseError"===e.name?(e.code===Ys.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new Xs(Ys.UNKNOWN,e.toString())}))}terminate(){this.F_=!0,this.connection.terminate()}}class dh{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.x_=0,this.O_=null,this.N_=!0}B_(){0===this.x_&&(this.L_("Unknown"),this.O_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this.O_=null,this.k_("Backend didn't respond within 10 seconds."),this.L_("Offline"),Promise.resolve()))))}q_(e){"Online"===this.state?this.L_("Unknown"):(this.x_++,this.x_>=1&&(this.Q_(),this.k_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.L_("Offline")))}set(e){this.Q_(),this.x_=0,"Online"===e&&(this.N_=!1),this.L_(e)}L_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}k_(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.N_?(zs(t),this.N_=!1):qs("OnlineStateTracker",t)}Q_(){null!==this.O_&&(this.O_.cancel(),this.O_=null)}}const fh="RemoteStore";class ph{constructor(e,t,n,r,s){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.U_=[],this.K_=new Map,this.W_=new Set,this.G_=[],this.z_=s,this.z_.To((e=>{n.enqueueAndForget((async()=>{Sh(this)&&(qs(fh,"Restarting streams for network reachability change."),await async function(e){const t=Js(e);t.W_.add(4),await mh(t),t.j_.set("Unknown"),t.W_.delete(4),await gh(t)}(this))}))})),this.j_=new dh(n,r)}}async function gh(e){if(Sh(e))for(const t of e.G_)await t(!0)}async function mh(e){for(const t of e.G_)await t(!1)}function yh(e,t){const n=Js(e);n.K_.has(t.targetId)||(n.K_.set(t.targetId,t),Ih(n)?Eh(n):$h(n).c_()&&wh(n,t))}function vh(e,t){const n=Js(e),r=$h(n);n.K_.delete(t),r.c_()&&_h(n,t),0===n.K_.size&&(r.c_()?r.P_():Sh(n)&&n.j_.set("Unknown"))}function wh(e,t){if(e.H_.Ne(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(wi.min())>0){const n=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(n)}$h(e).y_(t)}function _h(e,t){e.H_.Ne(t),$h(e).w_(t)}function Eh(e){e.H_=new mu({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),lt:t=>e.K_.get(t)||null,it:()=>e.datastore.serializer.databaseId}),$h(e).start(),e.j_.B_()}function Ih(e){return Sh(e)&&!$h(e).u_()&&e.K_.size>0}function Sh(e){return 0===Js(e).W_.size}function bh(e){e.H_=void 0}async function Th(e){e.j_.set("Online")}async function Ah(e){e.K_.forEach(((t,n)=>{wh(e,t)}))}async function Ch(e,t){bh(e),Ih(e)?(e.j_.q_(t),Eh(e)):e.j_.set("Unknown")}async function kh(e,t,n){if(e.j_.set("Online"),t instanceof pu&&2===t.state&&t.cause)try{await async function(e,t){const n=t.cause;for(const r of t.targetIds)e.K_.has(r)&&(await e.remoteSyncer.rejectListen(r,n),e.K_.delete(r),e.H_.removeTarget(r))}(e,t)}catch(n){qs(fh,"Failed to remove targets %s: %s ",t.targetIds.join(","),n),await Nh(e,n)}else if(t instanceof du?e.H_.We(t):t instanceof fu?e.H_.Ze(t):e.H_.je(t),!n.isEqual(wi.min()))try{const t=await Ul(e.localStore);n.compareTo(t)>=0&&await function(e,t){const n=e.H_.ot(t);return n.targetChanges.forEach(((n,r)=>{if(n.resumeToken.approximateByteSize()>0){const s=e.K_.get(r);s&&e.K_.set(r,s.withResumeToken(n.resumeToken,t))}})),n.targetMismatches.forEach(((t,n)=>{const r=e.K_.get(t);if(!r)return;e.K_.set(t,r.withResumeToken(Co.EMPTY_BYTE_STRING,r.snapshotVersion)),_h(e,t);const s=new Yu(r.target,t,n,r.sequenceNumber);wh(e,s)})),e.remoteSyncer.applyRemoteEvent(n)}(e,n)}catch(t){qs(fh,"Failed to raise snapshot:",t),await Nh(e,t)}}async function Nh(e,t,n){if(!Ui(t))throw t;e.W_.add(1),await mh(e),e.j_.set("Offline"),n||(n=()=>Ul(e.localStore)),e.asyncQueue.enqueueRetryable((async()=>{qs(fh,"Retrying IndexedDB access"),await n(),e.W_.delete(1),await gh(e)}))}function Dh(e,t){return t().catch((n=>Nh(e,n,t)))}async function Rh(e){const t=Js(e),n=Bh(t);let r=t.U_.length>0?t.U_[t.U_.length-1].batchId:Vi;for(;Oh(t);)try{const e=await Vl(t.localStore,r);if(null===e){0===t.U_.length&&n.P_();break}r=e.batchId,Ph(t,e)}catch(e){await Nh(t,e)}Lh(t)&&Mh(t)}function Oh(e){return Sh(e)&&e.U_.length<10}function Ph(e,t){e.U_.push(t);const n=Bh(e);n.c_()&&n.S_&&n.b_(t.mutations)}function Lh(e){return Sh(e)&&!Bh(e).u_()&&e.U_.length>0}function Mh(e){Bh(e).start()}async function xh(e){Bh(e).C_()}async function Uh(e){const t=Bh(e);for(const n of e.U_)t.b_(n.mutations)}async function Fh(e,t,n){const r=e.U_.shift(),s=Yc.from(r,t,n);await Dh(e,(()=>e.remoteSyncer.applySuccessfulWrite(s))),await Rh(e)}async function Vh(e,t){t&&Bh(e).S_&&await async function(e,t){if(function(e){return nu(e)&&e!==Ys.ABORTED}(t.code)){const n=e.U_.shift();Bh(e).h_(),await Dh(e,(()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t))),await Rh(e)}}(e,t),Lh(e)&&Mh(e)}async function Wh(e,t){const n=Js(e);n.asyncQueue.verifyOperationInProgress(),qs(fh,"RemoteStore received new credentials");const r=Sh(n);n.W_.add(3),await mh(n),r&&n.j_.set("Unknown"),await n.remoteSyncer.handleCredentialChange(t),n.W_.delete(3),await gh(n)}async function jh(e,t){const n=Js(e);t?(n.W_.delete(2),await gh(n)):t||(n.W_.add(2),await mh(n),n.j_.set("Unknown"))}function $h(e){return e.J_||(e.J_=function(e,t,n){const r=Js(e);return r.M_(),new ch(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(e.datastore,e.asyncQueue,{xo:Th.bind(null,e),No:Ah.bind(null,e),Lo:Ch.bind(null,e),p_:kh.bind(null,e)}),e.G_.push((async t=>{t?(e.J_.h_(),Ih(e)?Eh(e):e.j_.set("Unknown")):(await e.J_.stop(),bh(e))}))),e.J_}function Bh(e){return e.Y_||(e.Y_=function(e,t,n){const r=Js(e);return r.M_(),new uh(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(e.datastore,e.asyncQueue,{xo:()=>Promise.resolve(),No:xh.bind(null,e),Lo:Vh.bind(null,e),D_:Uh.bind(null,e),v_:Fh.bind(null,e)}),e.G_.push((async t=>{t?(e.Y_.h_(),await Rh(e)):(await e.Y_.stop(),e.U_.length>0&&(qs(fh,`Stopping write stream with ${e.U_.length} pending writes`),e.U_=[]))}))),e.Y_}class qh{constructor(e,t,n,r,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=s,this.deferred=new Zs,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((e=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,r,s){const i=Date.now()+n,o=new qh(e,t,i,r,s);return o.start(n),o}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Xs(Ys.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function zh(e,t){if(zs("AsyncQueue",`${t}: ${e}`),Ui(e))return new Xs(Ys.UNAVAILABLE,`${t}: ${e}`);throw e}class Hh{static emptySet(e){return new Hh(e.comparator)}constructor(e){this.comparator=e?(t,n)=>e(t,n)||Ti.comparator(t.key,n.key):(e,t)=>Ti.comparator(e.key,t.key),this.keyedMap=cc(),this.sortedSet=new _o(this.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,n)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Hh))return!1;if(this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(!e.isEqual(r))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const n=new Hh;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class Gh{constructor(){this.Z_=new _o(Ti.comparator)}track(e){const t=e.doc.key,n=this.Z_.get(t);n?0!==e.type&&3===n.type?this.Z_=this.Z_.insert(t,e):3===e.type&&1!==n.type?this.Z_=this.Z_.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.Z_=this.Z_.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.Z_=this.Z_.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.Z_=this.Z_.remove(t):1===e.type&&2===n.type?this.Z_=this.Z_.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.Z_=this.Z_.insert(t,{type:2,doc:e.doc}):Ks():this.Z_=this.Z_.insert(t,e)}X_(){const e=[];return this.Z_.inorderTraversal(((t,n)=>{e.push(n)})),e}}class Kh{constructor(e,t,n,r,s,i,o,a,c){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=s,this.fromCache=i,this.syncStateChanged=o,this.excludesMetadataChanges=a,this.hasCachedResults=c}static fromInitialDocuments(e,t,n,r,s){const i=[];return t.forEach((e=>{i.push({type:0,doc:e})})),new Kh(e,t,Hh.emptySet(t),i,n,r,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Ya(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==n[e].type||!t[e].doc.isEqual(n[e].doc))return!1;return!0}}class Qh{constructor(){this.ea=void 0,this.ta=[]}na(){return this.ta.some((e=>e.ra()))}}class Jh{constructor(){this.queries=Yh(),this.onlineState="Unknown",this.ia=new Set}terminate(){!function(e,t){const n=Js(e),r=n.queries;n.queries=Yh(),r.forEach(((e,n)=>{for(const e of n.ta)e.onError(t)}))}(this,new Xs(Ys.ABORTED,"Firestore shutting down"))}}function Yh(){return new sc((e=>Xa(e)),Ya)}async function Xh(e,t){const n=Js(e);let r=3;const s=t.query;let i=n.queries.get(s);i?!i.na()&&t.ra()&&(r=2):(i=new Qh,r=t.ra()?0:1);try{switch(r){case 0:i.ea=await n.onListen(s,!0);break;case 1:i.ea=await n.onListen(s,!1);break;case 2:await n.onFirstRemoteStoreListen(s)}}catch(e){const n=zh(e,`Initialization of query '${Za(t.query)}' failed`);return void t.onError(n)}n.queries.set(s,i),i.ta.push(t),t.sa(n.onlineState),i.ea&&t.oa(i.ea)&&nd(n)}async function Zh(e,t){const n=Js(e),r=t.query;let s=3;const i=n.queries.get(r);if(i){const e=i.ta.indexOf(t);e>=0&&(i.ta.splice(e,1),0===i.ta.length?s=t.ra()?0:1:!i.na()&&t.ra()&&(s=2))}switch(s){case 0:return n.queries.delete(r),n.onUnlisten(r,!0);case 1:return n.queries.delete(r),n.onUnlisten(r,!1);case 2:return n.onLastRemoteStoreUnlisten(r);default:return}}function ed(e,t){const n=Js(e);let r=!1;for(const e of t){const t=e.query,s=n.queries.get(t);if(s){for(const t of s.ta)t.oa(e)&&(r=!0);s.ea=e}}r&&nd(n)}function td(e,t,n){const r=Js(e),s=r.queries.get(t);if(s)for(const e of s.ta)e.onError(n);r.queries.delete(t)}function nd(e){e.ia.forEach((e=>{e.next()}))}var rd,sd;(sd=rd||(rd={}))._a="default",sd.Cache="cache";class id{constructor(e,t,n){this.query=e,this.aa=t,this.ua=!1,this.ca=null,this.onlineState="Unknown",this.options=n||{}}oa(e){if(!this.options.includeMetadataChanges){const t=[];for(const n of e.docChanges)3!==n.type&&t.push(n);e=new Kh(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.ua?this.la(e)&&(this.aa.next(e),t=!0):this.ha(e,this.onlineState)&&(this.Pa(e),t=!0),this.ca=e,t}onError(e){this.aa.error(e)}sa(e){this.onlineState=e;let t=!1;return this.ca&&!this.ua&&this.ha(this.ca,e)&&(this.Pa(this.ca),t=!0),t}ha(e,t){if(!e.fromCache)return!0;if(!this.ra())return!0;const n="Offline"!==t;return(!this.options.Ta||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}la(e){if(e.docChanges.length>0)return!0;const t=this.ca&&this.ca.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}Pa(e){e=Kh.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.ua=!0,this.aa.next(e)}ra(){return this.options.source!==rd.Cache}}class od{constructor(e){this.key=e}}class ad{constructor(e){this.key=e}}class cd{constructor(e,t){this.query=e,this.fa=t,this.ga=null,this.hasCachedResults=!1,this.current=!1,this.pa=gc(),this.mutatedKeys=gc(),this.ya=nc(e),this.wa=new Hh(this.ya)}get Sa(){return this.fa}ba(e,t){const n=t?t.Da:new Gh,r=t?t.wa:this.wa;let s=t?t.mutatedKeys:this.mutatedKeys,i=r,o=!1;const a="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,c="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal(((e,t)=>{const u=r.get(e),l=ec(this.query,t)?t:null,h=!!u&&this.mutatedKeys.has(u.key),d=!!l&&(l.hasLocalMutations||this.mutatedKeys.has(l.key)&&l.hasCommittedMutations);let f=!1;u&&l?u.data.isEqual(l.data)?h!==d&&(n.track({type:3,doc:l}),f=!0):this.va(u,l)||(n.track({type:2,doc:l}),f=!0,(a&&this.ya(l,a)>0||c&&this.ya(l,c)<0)&&(o=!0)):!u&&l?(n.track({type:0,doc:l}),f=!0):u&&!l&&(n.track({type:1,doc:u}),f=!0,(a||c)&&(o=!0)),f&&(l?(i=i.add(l),s=d?s.add(e):s.delete(e)):(i=i.delete(e),s=s.delete(e)))})),null!==this.query.limit)for(;i.size>this.query.limit;){const e="F"===this.query.limitType?i.last():i.first();i=i.delete(e.key),s=s.delete(e.key),n.track({type:1,doc:e})}return{wa:i,Da:n,ls:o,mutatedKeys:s}}va(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,r){const s=this.wa;this.wa=e.wa,this.mutatedKeys=e.mutatedKeys;const i=e.Da.X_();i.sort(((e,t)=>function(e,t){const n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Ks()}};return n(e)-n(t)}(e.type,t.type)||this.ya(e.doc,t.doc))),this.Ca(n),r=null!=r&&r;const o=t&&!r?this.Fa():[],a=0===this.pa.size&&this.current&&!r?1:0,c=a!==this.ga;return this.ga=a,0!==i.length||c?{snapshot:new Kh(this.query,e.wa,s,i,e.mutatedKeys,0===a,c,!1,!!n&&n.resumeToken.approximateByteSize()>0),Ma:o}:{Ma:o}}sa(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({wa:this.wa,Da:new Gh,mutatedKeys:this.mutatedKeys,ls:!1},!1)):{Ma:[]}}xa(e){return!this.fa.has(e)&&!!this.wa.has(e)&&!this.wa.get(e).hasLocalMutations}Ca(e){e&&(e.addedDocuments.forEach((e=>this.fa=this.fa.add(e))),e.modifiedDocuments.forEach((e=>{})),e.removedDocuments.forEach((e=>this.fa=this.fa.delete(e))),this.current=e.current)}Fa(){if(!this.current)return[];const e=this.pa;this.pa=gc(),this.wa.forEach((e=>{this.xa(e.key)&&(this.pa=this.pa.add(e.key))}));const t=[];return e.forEach((e=>{this.pa.has(e)||t.push(new ad(e))})),this.pa.forEach((n=>{e.has(n)||t.push(new od(n))})),t}Oa(e){this.fa=e.gs,this.pa=gc();const t=this.ba(e.documents);return this.applyChanges(t,!0)}Na(){return Kh.fromInitialDocuments(this.query,this.wa,this.mutatedKeys,0===this.ga,this.hasCachedResults)}}const ud="SyncEngine";class ld{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class hd{constructor(e){this.key=e,this.Ba=!1}}class dd{constructor(e,t,n,r,s,i){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=s,this.maxConcurrentLimboResolutions=i,this.La={},this.ka=new sc((e=>Xa(e)),Ya),this.qa=new Map,this.Qa=new Set,this.$a=new _o(Ti.comparator),this.Ua=new Map,this.Ka=new _l,this.Wa={},this.Ga=new Map,this.za=ol.Kn(),this.onlineState="Unknown",this.ja=void 0}get isPrimaryClient(){return!0===this.ja}}async function fd(e,t,n=!0){const r=Ld(e);let s;const i=r.ka.get(t);return i?(r.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.Na()):s=await gd(r,t,n,!0),s}async function pd(e,t){const n=Ld(e);await gd(n,t,!0,!1)}async function gd(e,t,n,r){const s=await Wl(e.localStore,Ga(t)),i=s.targetId,o=e.sharedClientState.addLocalQueryTarget(i,n);let a;return r&&(a=await md(e,t,i,"current"===o,s.resumeToken)),e.isPrimaryClient&&n&&yh(e.remoteStore,s),a}async function md(e,t,n,r,s){e.Ha=(t,n,r)=>async function(e,t,n,r){let s=t.view.ba(n);s.ls&&(s=await $l(e.localStore,t.query,!1).then((({documents:e})=>t.view.ba(e,s))));const i=r&&r.targetChanges.get(t.targetId),o=r&&null!=r.targetMismatches.get(t.targetId),a=t.view.applyChanges(s,e.isPrimaryClient,i,o);return kd(e,t.targetId,a.Ma),a.snapshot}(e,t,n,r);const i=await $l(e.localStore,t,!0),o=new cd(t,i.gs),a=o.ba(i.documents),c=hu.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==e.onlineState,s),u=o.applyChanges(a,e.isPrimaryClient,c);kd(e,n,u.Ma);const l=new ld(t,n,o);return e.ka.set(t,l),e.qa.has(n)?e.qa.get(n).push(t):e.qa.set(n,[t]),u.snapshot}async function yd(e,t,n){const r=Js(e),s=r.ka.get(t),i=r.qa.get(s.targetId);if(i.length>1)return r.qa.set(s.targetId,i.filter((e=>!Ya(e,t)))),void r.ka.delete(t);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await jl(r.localStore,s.targetId,!1).then((()=>{r.sharedClientState.clearQueryState(s.targetId),n&&vh(r.remoteStore,s.targetId),Ad(r,s.targetId)})).catch(Li)):(Ad(r,s.targetId),await jl(r.localStore,s.targetId,!0))}async function vd(e,t){const n=Js(e),r=n.ka.get(t),s=n.qa.get(r.targetId);n.isPrimaryClient&&1===s.length&&(n.sharedClientState.removeLocalQueryTarget(r.targetId),vh(n.remoteStore,r.targetId))}async function wd(e,t){const n=Js(e);try{const e=await function(e,t){const n=Js(e),r=t.snapshotVersion;let s=n.Ts;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(e=>{const i=n.ds.newChangeBuffer({trackRemovals:!0});s=n.Ts;const o=[];t.targetChanges.forEach(((i,a)=>{const c=s.get(a);if(!c)return;o.push(n.Hr.removeMatchingKeys(e,i.removedDocuments,a).next((()=>n.Hr.addMatchingKeys(e,i.addedDocuments,a))));let u=c.withSequenceNumber(e.currentSequenceNumber);null!==t.targetMismatches.get(a)?u=u.withResumeToken(Co.EMPTY_BYTE_STRING,wi.min()).withLastLimboFreeSnapshotVersion(wi.min()):i.resumeToken.approximateByteSize()>0&&(u=u.withResumeToken(i.resumeToken,r)),s=s.insert(a,u),function(e,t,n){return 0===e.resumeToken.approximateByteSize()||(t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0)}(c,u,i)&&o.push(n.Hr.updateTargetData(e,u))}));let a=oc(),c=gc();if(t.documentUpdates.forEach((r=>{t.resolvedLimboDocuments.has(r)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(e,r))})),o.push(Fl(e,i,t.documentUpdates).next((e=>{a=e.Vs,c=e.fs}))),!r.isEqual(wi.min())){const t=n.Hr.getLastRemoteSnapshotVersion(e).next((t=>n.Hr.setTargetsMetadata(e,e.currentSequenceNumber,r)));o.push(t)}return Mi.waitFor(o).next((()=>i.apply(e))).next((()=>n.localDocuments.getLocalViewOfDocuments(e,a,c))).next((()=>a))})).then((e=>(n.Ts=s,e)))}(n.localStore,t);t.targetChanges.forEach(((e,t)=>{const r=n.Ua.get(t);r&&(Qs(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1),e.addedDocuments.size>0?r.Ba=!0:e.modifiedDocuments.size>0?Qs(r.Ba):e.removedDocuments.size>0&&(Qs(r.Ba),r.Ba=!1))})),await Rd(n,e,t)}catch(e){await Li(e)}}function _d(e,t,n){const r=Js(e);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){const e=[];r.ka.forEach(((n,r)=>{const s=r.view.sa(t);s.snapshot&&e.push(s.snapshot)})),function(e,t){const n=Js(e);n.onlineState=t;let r=!1;n.queries.forEach(((e,n)=>{for(const e of n.ta)e.sa(t)&&(r=!0)})),r&&nd(n)}(r.eventManager,t),e.length&&r.La.p_(e),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}async function Ed(e,t,n){const r=Js(e);r.sharedClientState.updateQueryState(t,"rejected",n);const s=r.Ua.get(t),i=s&&s.key;if(i){let e=new _o(Ti.comparator);e=e.insert(i,fa.newNoDocument(i,wi.min()));const n=gc().add(i),s=new lu(wi.min(),new Map,new _o(hi),e,n);await wd(r,s),r.$a=r.$a.remove(i),r.Ua.delete(t),Dd(r)}else await jl(r.localStore,t,!1).then((()=>Ad(r,t,n))).catch(Li)}async function Id(e,t){const n=Js(e),r=t.batch.batchId;try{const e=await function(e,t){const n=Js(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(e=>{const r=t.batch.keys(),s=n.ds.newChangeBuffer({trackRemovals:!0});return function(e,t,n,r){const s=n.batch,i=s.keys();let o=Mi.resolve();return i.forEach((e=>{o=o.next((()=>r.getEntry(t,e))).next((t=>{const i=n.docVersions.get(e);Qs(null!==i),t.version.compareTo(i)<0&&(s.applyToRemoteDocument(t,n),t.isValidDocument()&&(t.setReadTime(n.commitVersion),r.addEntry(t)))}))})),o.next((()=>e.mutationQueue.removeMutationBatch(t,s)))}(n,e,t,s).next((()=>s.apply(e))).next((()=>n.mutationQueue.performConsistencyCheck(e))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t.batch.batchId))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=gc();for(let n=0;n<e.mutationResults.length;++n)e.mutationResults[n].transformResults.length>0&&(t=t.add(e.batch.mutations[n].key));return t}(t)))).next((()=>n.localDocuments.getDocuments(e,r)))}))}(n.localStore,t);Td(n,r,null),bd(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await Rd(n,e)}catch(e){await Li(e)}}async function Sd(e,t,n){const r=Js(e);try{const e=await function(e,t){const n=Js(e);return n.persistence.runTransaction("Reject batch","readwrite-primary",(e=>{let r;return n.mutationQueue.lookupMutationBatch(e,t).next((t=>(Qs(null!==t),r=t.keys(),n.mutationQueue.removeMutationBatch(e,t)))).next((()=>n.mutationQueue.performConsistencyCheck(e))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,r))).next((()=>n.localDocuments.getDocuments(e,r)))}))}(r.localStore,t);Td(r,t,n),bd(r,t),r.sharedClientState.updateMutationState(t,"rejected",n),await Rd(r,e)}catch(n){await Li(n)}}function bd(e,t){(e.Ga.get(t)||[]).forEach((e=>{e.resolve()})),e.Ga.delete(t)}function Td(e,t,n){const r=Js(e);let s=r.Wa[r.currentUser.toKey()];if(s){const e=s.get(t);e&&(n?e.reject(n):e.resolve(),s=s.remove(t)),r.Wa[r.currentUser.toKey()]=s}}function Ad(e,t,n=null){e.sharedClientState.removeLocalQueryTarget(t);for(const r of e.qa.get(t))e.ka.delete(r),n&&e.La.Ja(r,n);e.qa.delete(t),e.isPrimaryClient&&e.Ka.br(t).forEach((t=>{e.Ka.containsKey(t)||Cd(e,t)}))}function Cd(e,t){e.Qa.delete(t.path.canonicalString());const n=e.$a.get(t);null!==n&&(vh(e.remoteStore,n),e.$a=e.$a.remove(t),e.Ua.delete(n),Dd(e))}function kd(e,t,n){for(const r of n)r instanceof od?(e.Ka.addReference(r.key,t),Nd(e,r)):r instanceof ad?(qs(ud,"Document no longer in limbo: "+r.key),e.Ka.removeReference(r.key,t),e.Ka.containsKey(r.key)||Cd(e,r.key)):Ks()}function Nd(e,t){const n=t.key,r=n.path.canonicalString();e.$a.get(n)||e.Qa.has(r)||(qs(ud,"New document in limbo: "+n),e.Qa.add(r),Dd(e))}function Dd(e){for(;e.Qa.size>0&&e.$a.size<e.maxConcurrentLimboResolutions;){const t=e.Qa.values().next().value;e.Qa.delete(t);const n=new Ti(Ii.fromString(t)),r=e.za.next();e.Ua.set(r,new hd(n)),e.$a=e.$a.insert(n,r),yh(e.remoteStore,new Yu(Ga(Ba(n.path)),r,"TargetPurposeLimboResolution",Fi.ae))}}async function Rd(e,t,n){const r=Js(e),s=[],i=[],o=[];r.ka.isEmpty()||(r.ka.forEach(((e,a)=>{o.push(r.Ha(a,t,n).then((e=>{var t;if((e||n)&&r.isPrimaryClient){const s=e?!e.fromCache:null===(t=null==n?void 0:n.targetChanges.get(a.targetId))||void 0===t?void 0:t.current;r.sharedClientState.updateQueryState(a.targetId,s?"current":"not-current")}if(e){s.push(e);const t=Dl.Yi(a.targetId,e);i.push(t)}})))})),await Promise.all(o),r.La.p_(s),await async function(e,t){const n=Js(e);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(e=>Mi.forEach(t,(t=>Mi.forEach(t.Hi,(r=>n.persistence.referenceDelegate.addReference(e,t.targetId,r))).next((()=>Mi.forEach(t.Ji,(r=>n.persistence.referenceDelegate.removeReference(e,t.targetId,r)))))))))}catch(e){if(!Ui(e))throw e;qs(Pl,"Failed to update sequence numbers: "+e)}for(const e of t){const t=e.targetId;if(!e.fromCache){const e=n.Ts.get(t),r=e.snapshotVersion,s=e.withLastLimboFreeSnapshotVersion(r);n.Ts=n.Ts.insert(t,s)}}}(r.localStore,i))}async function Od(e,t){const n=Js(e);if(!n.currentUser.isEqual(t)){qs(ud,"User change. New user:",t.toKey());const e=await xl(n.localStore,t);n.currentUser=t,function(e,t){e.Ga.forEach((e=>{e.forEach((e=>{e.reject(new Xs(Ys.CANCELLED,t))}))})),e.Ga.clear()}(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),await Rd(n,e.Rs)}}function Pd(e,t){const n=Js(e),r=n.Ua.get(t);if(r&&r.Ba)return gc().add(r.key);{let e=gc();const r=n.qa.get(t);if(!r)return e;for(const t of r){const r=n.ka.get(t);e=e.unionWith(r.view.Sa)}return e}}function Ld(e){const t=Js(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=wd.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=Pd.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=Ed.bind(null,t),t.La.p_=ed.bind(null,t.eventManager),t.La.Ja=td.bind(null,t.eventManager),t}function Md(e){const t=Js(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=Id.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=Sd.bind(null,t),t}class xd{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=sh(e.databaseInfo.databaseId),this.sharedClientState=this.Za(e),this.persistence=this.Xa(e),await this.persistence.start(),this.localStore=this.eu(e),this.gcScheduler=this.tu(e,this.localStore),this.indexBackfillerScheduler=this.nu(e,this.localStore)}tu(e,t){return null}nu(e,t){return null}eu(e){return Ml(this.persistence,new Ol,e.initialUser,this.serializer)}Xa(e){return new Al(kl.ri,this.serializer)}Za(e){return new zl}async terminate(){var e,t;null===(e=this.gcScheduler)||void 0===e||e.stop(),null===(t=this.indexBackfillerScheduler)||void 0===t||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}xd.provider={build:()=>new xd};class Ud extends xd{constructor(e){super(),this.cacheSizeBytes=e}tu(e,t){Qs(this.persistence.referenceDelegate instanceof Nl);const n=this.persistence.referenceDelegate.garbageCollector;return new hl(n,e.asyncQueue,t)}Xa(e){const t=void 0!==this.cacheSizeBytes?il.withCacheSize(this.cacheSizeBytes):il.DEFAULT;return new Al((e=>Nl.ri(e,t)),this.serializer)}}class Fd{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>_d(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=Od.bind(null,this.syncEngine),await jh(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new Jh}createDatastore(e){const t=sh(e.databaseInfo.databaseId),n=function(e){return new nh(e)}(e.databaseInfo);return function(e,t,n,r){return new hh(e,t,n,r)}(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return function(e,t,n,r,s){return new ph(e,t,n,r,s)}(this.localStore,this.datastore,e.asyncQueue,(e=>_d(this.syncEngine,e,0)),Kl.D()?new Kl:new Hl)}createSyncEngine(e,t){return function(e,t,n,r,s,i,o){const a=new dd(e,t,n,r,s,i);return o&&(a.ja=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(e){const t=Js(e);qs(fh,"RemoteStore shutting down."),t.W_.add(5),await mh(t),t.z_.shutdown(),t.j_.set("Unknown")}(this.remoteStore),null===(e=this.datastore)||void 0===e||e.terminate(),null===(t=this.eventManager)||void 0===t||t.terminate()}}Fd.provider={build:()=>new Fd};class Vd{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.iu(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.iu(this.observer.error,e):zs("Uncaught Error in snapshot listener:",e.toString()))}su(){this.muted=!0}iu(e,t){setTimeout((()=>{this.muted||e(t)}),0)}}const Wd="FirestoreClient";class jd{constructor(e,t,n,r,s){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=Ws.UNAUTHENTICATED,this.clientId=li.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=s,this.authCredentials.start(n,(async e=>{qs(Wd,"Received user=",e.uid),await this.authCredentialListener(e),this.user=e})),this.appCheckCredentials.start(n,(e=>(qs(Wd,"Received new app check token=",e),this.appCheckCredentialListener(e,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Zs;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const n=zh(t,"Failed to shutdown persistence");e.reject(n)}})),e.promise}}async function $d(e,t){e.asyncQueue.verifyOperationInProgress(),qs(Wd,"Initializing OfflineComponentProvider");const n=e.configuration;await t.initialize(n);let r=n.initialUser;e.setCredentialChangeListener((async e=>{r.isEqual(e)||(await xl(t.localStore,e),r=e)})),t.persistence.setDatabaseDeletedListener((()=>e.terminate())),e._offlineComponents=t}async function Bd(e,t){e.asyncQueue.verifyOperationInProgress();const n=await qd(e);qs(Wd,"Initializing OnlineComponentProvider"),await t.initialize(n,e.configuration),e.setCredentialChangeListener((e=>Wh(t.remoteStore,e))),e.setAppCheckTokenChangeListener(((e,n)=>Wh(t.remoteStore,n))),e._onlineComponents=t}async function qd(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){qs(Wd,"Using user provided OfflineComponentProvider");try{await $d(e,e._uninitializedComponentsProvider._offline)}catch(t){const n=t;if(!function(e){return"FirebaseError"===e.name?e.code===Ys.FAILED_PRECONDITION||e.code===Ys.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&e instanceof DOMException)||22===e.code||20===e.code||11===e.code}(n))throw n;Hs("Error using user provided cache. Falling back to memory cache: "+n),await $d(e,new xd)}}else qs(Wd,"Using default OfflineComponentProvider"),await $d(e,new Ud(void 0));return e._offlineComponents}async function zd(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(qs(Wd,"Using user provided OnlineComponentProvider"),await Bd(e,e._uninitializedComponentsProvider._online)):(qs(Wd,"Using default OnlineComponentProvider"),await Bd(e,new Fd))),e._onlineComponents}function Hd(e){return zd(e).then((e=>e.syncEngine))}async function Gd(e){const t=await zd(e),n=t.eventManager;return n.onListen=fd.bind(null,t.syncEngine),n.onUnlisten=yd.bind(null,t.syncEngine),n.onFirstRemoteStoreListen=pd.bind(null,t.syncEngine),n.onLastRemoteStoreUnlisten=vd.bind(null,t.syncEngine),n}function Kd(e,t,n={}){const r=new Zs;return e.asyncQueue.enqueueAndForget((async()=>function(e,t,n,r,s){const i=new Vd({next:a=>{i.su(),t.enqueueAndForget((()=>Zh(e,o)));const c=a.docs.has(n);!c&&a.fromCache?s.reject(new Xs(Ys.UNAVAILABLE,"Failed to get document because the client is offline.")):c&&a.fromCache&&r&&"server"===r.source?s.reject(new Xs(Ys.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):s.resolve(a)},error:e=>s.reject(e)}),o=new id(Ba(n.path),i,{includeMetadataChanges:!0,Ta:!0});return Xh(e,o)}(await Gd(e),e.asyncQueue,t,n,r))),r.promise}function Qd(e,t,n={}){const r=new Zs;return e.asyncQueue.enqueueAndForget((async()=>function(e,t,n,r,s){const i=new Vd({next:n=>{i.su(),t.enqueueAndForget((()=>Zh(e,o))),n.fromCache&&"server"===r.source?s.reject(new Xs(Ys.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):s.resolve(n)},error:e=>s.reject(e)}),o=new id(n,i,{includeMetadataChanges:!0,Ta:!0});return Xh(e,o)}(await Gd(e),e.asyncQueue,t,n,r))),r.promise}function Jd(e){const t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}const Yd=new Map;function Xd(e,t,n){if(!n)throw new Xs(Ys.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function Zd(e){if(!Ti.isDocumentKey(e))throw new Xs(Ys.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function ef(e){if(Ti.isDocumentKey(e))throw new Xs(Ys.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function tf(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{const t=function(e){return e.constructor?e.constructor.name:null}(e);return t?`a custom ${t} object`:"an object"}}return"function"==typeof e?"a function":Ks()}function nf(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new Xs(Ys.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=tf(e);throw new Xs(Ys.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}const rf="firestore.googleapis.com",sf=!0;class of{constructor(e){var t,n;if(void 0===e.host){if(void 0!==e.ssl)throw new Xs(Ys.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=rf,this.ssl=sf}else this.host=e.host,this.ssl=null!==(t=e.ssl)&&void 0!==t?t:sf;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=sl;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<cl)throw new Xs(Ys.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}(function(e,t,n,r){if(!0===t&&!0===r)throw new Xs(Ys.INVALID_ARGUMENT,`${e} and ${n} cannot be used together.`)})("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Jd(null!==(n=e.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new Xs(Ys.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<5)throw new Xs(Ys.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is 5)`);if(e.timeoutSeconds>30)throw new Xs(Ys.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(e,t){return e.timeoutSeconds===t.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class af{constructor(e,t,n,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new of({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new Xs(Ys.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new Xs(Ys.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new of(e),this._emulatorOptions=e.emulatorOptions||{},void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new ti;switch(e.type){case"firstParty":return new ii(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new Xs(Ys.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=Yd.get(e);t&&(qs("ComponentProvider","Removing Datastore"),Yd.delete(e),t.terminate())}(this),Promise.resolve()}}function cf(e,t,n,r={}){var s;const i=(e=nf(e,af))._getSettings(),o=Object.assign(Object.assign({},i),{emulatorOptions:e._getEmulatorOptions()}),a=`${t}:${n}`;i.host!==rf&&i.host!==a&&Hs("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const c=Object.assign(Object.assign({},i),{host:a,ssl:!1,emulatorOptions:r});if(!S(c,o)&&(e._setSettings(c),r.mockUserToken)){let t,n;if("string"==typeof r.mockUserToken)t=r.mockUserToken,n=Ws.MOCK_USER;else{t=function(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=t||"demo-project",r=e.iat||0,s=e.sub||e.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const i=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},e);return[u(JSON.stringify({alg:"none",type:"JWT"})),u(JSON.stringify(i)),""].join(".")}(r.mockUserToken,null===(s=e._app)||void 0===s?void 0:s.options.projectId);const i=r.mockUserToken.sub||r.mockUserToken.user_id;if(!i)throw new Xs(Ys.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new Ws(i)}e._authCredentials=new ni(new ei(t,n))}}class uf{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new uf(this.firestore,e,this._query)}}class lf{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new hf(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new lf(this.firestore,e,this._key)}}class hf extends uf{constructor(e,t,n){super(e,t,Ba(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new lf(this.firestore,null,new Ti(e))}withConverter(e){return new hf(this.firestore,e,this._path)}}function df(e,t,...n){if(e=D(e),Xd("collection","path",t),e instanceof af){const r=Ii.fromString(t,...n);return ef(r),new hf(e,null,r)}{if(!(e instanceof lf||e instanceof hf))throw new Xs(Ys.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=e._path.child(Ii.fromString(t,...n));return ef(r),new hf(e.firestore,null,r)}}function ff(e,t,...n){if(e=D(e),1===arguments.length&&(t=li.newId()),Xd("doc","path",t),e instanceof af){const r=Ii.fromString(t,...n);return Zd(r),new lf(e,null,new Ti(r))}{if(!(e instanceof lf||e instanceof hf))throw new Xs(Ys.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=e._path.child(Ii.fromString(t,...n));return Zd(r),new lf(e.firestore,e instanceof hf?e.converter:null,new Ti(r))}}const pf="AsyncQueue";class gf{constructor(e=Promise.resolve()){this.Vu=[],this.mu=!1,this.fu=[],this.gu=null,this.pu=!1,this.yu=!1,this.wu=[],this.a_=new ih(this,"async_queue_retry"),this.Su=()=>{const e=rh();e&&qs(pf,"Visibility state changed to "+e.visibilityState),this.a_.t_()},this.bu=e;const t=rh();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.Su)}get isShuttingDown(){return this.mu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Du(),this.vu(e)}enterRestrictedMode(e){if(!this.mu){this.mu=!0,this.yu=e||!1;const t=rh();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Su)}}enqueue(e){if(this.Du(),this.mu)return new Promise((()=>{}));const t=new Zs;return this.vu((()=>this.mu&&this.yu?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Vu.push(e),this.Cu())))}async Cu(){if(0!==this.Vu.length){try{await this.Vu[0](),this.Vu.shift(),this.a_.reset()}catch(e){if(!Ui(e))throw e;qs(pf,"Operation failed with retryable error: "+e)}this.Vu.length>0&&this.a_.Xo((()=>this.Cu()))}}vu(e){const t=this.bu.then((()=>(this.pu=!0,e().catch((e=>{this.gu=e,this.pu=!1;const t=function(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}(e);throw zs("INTERNAL UNHANDLED ERROR: ",t),e})).then((e=>(this.pu=!1,e))))));return this.bu=t,t}enqueueAfterDelay(e,t,n){this.Du(),this.wu.indexOf(e)>-1&&(t=0);const r=qh.createAndSchedule(this,e,t,n,(e=>this.Fu(e)));return this.fu.push(r),r}Du(){this.gu&&Ks()}verifyOperationInProgress(){}async Mu(){let e;do{e=this.bu,await e}while(e!==this.bu)}xu(e){for(const t of this.fu)if(t.timerId===e)return!0;return!1}Ou(e){return this.Mu().then((()=>{this.fu.sort(((e,t)=>e.targetTimeMs-t.targetTimeMs));for(const t of this.fu)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.Mu()}))}Nu(e){this.wu.push(e)}Fu(e){const t=this.fu.indexOf(e);this.fu.splice(t,1)}}function mf(e){return function(e,t){if("object"!=typeof e||null===e)return!1;const n=e;for(const e of t)if(e in n&&"function"==typeof n[e])return!0;return!1}(e,["next","error","complete"])}class yf extends af{constructor(e,t,n,r){super(e,t,n,r),this.type="firestore",this._queue=new gf,this._persistenceKey=(null==r?void 0:r.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new gf(e),this._firestoreClient=void 0,await e}}}function vf(e){if(e._terminated)throw new Xs(Ys.FAILED_PRECONDITION,"The client has already been terminated.");return e._firestoreClient||wf(e),e._firestoreClient}function wf(e){var t,n,r;const s=e._freezeSettings(),i=function(e,t,n,r){return new Vo(e,t,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,Jd(r.experimentalLongPollingOptions),r.useFetchStreams)}(e._databaseId,(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",e._persistenceKey,s);e._componentsProvider||(null===(n=s.localCache)||void 0===n?void 0:n._offlineComponentProvider)&&(null===(r=s.localCache)||void 0===r?void 0:r._onlineComponentProvider)&&(e._componentsProvider={_offline:s.localCache._offlineComponentProvider,_online:s.localCache._onlineComponentProvider}),e._firestoreClient=new jd(e._authCredentials,e._appCheckCredentials,e._queue,i,e._componentsProvider&&function(e){const t=null==e?void 0:e._online.build();return{_offline:null==e?void 0:e._offline.build(t),_online:t}}(e._componentsProvider))}class _f{constructor(e){this._byteString=e}static fromBase64String(e){try{return new _f(Co.fromBase64String(e))}catch(e){throw new Xs(Ys.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new _f(Co.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class Ef{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new Xs(Ys.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new bi(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class If{constructor(e){this._methodName=e}}class Sf{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new Xs(Ys.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new Xs(Ys.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return hi(this._lat,e._lat)||hi(this._long,e._long)}}class bf{constructor(e){this._values=(e||[]).map((e=>e))}toArray(){return this._values.map((e=>e))}isEqual(e){return function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}(this._values,e._values)}}const Tf=/^__.*__$/;class Af{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new qc(e,this.data,this.fieldMask,t,this.fieldTransforms):new Bc(e,this.data,t,this.fieldTransforms)}}class Cf{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new qc(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function kf(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Ks()}}class Nf{constructor(e,t,n,r,s,i){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===s&&this.Bu(),this.fieldTransforms=s||[],this.fieldMask=i||[]}get path(){return this.settings.path}get Lu(){return this.settings.Lu}ku(e){return new Nf(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}qu(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.ku({path:n,Qu:!1});return r.$u(e),r}Uu(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.ku({path:n,Qu:!1});return r.Bu(),r}Ku(e){return this.ku({path:void 0,Qu:!0})}Wu(e){return Hf(e,this.settings.methodName,this.settings.Gu||!1,this.path,this.settings.zu)}contains(e){return void 0!==this.fieldMask.find((t=>e.isPrefixOf(t)))||void 0!==this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))}Bu(){if(this.path)for(let e=0;e<this.path.length;e++)this.$u(this.path.get(e))}$u(e){if(0===e.length)throw this.Wu("Document fields must not be empty");if(kf(this.Lu)&&Tf.test(e))throw this.Wu('Document fields cannot begin and end with "__"')}}class Df{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||sh(e)}ju(e,t,n,r=!1){return new Nf({Lu:e,methodName:t,zu:n,path:bi.emptyPath(),Qu:!1,Gu:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Rf(e){const t=e._freezeSettings(),n=sh(e._databaseId);return new Df(e._databaseId,!!t.ignoreUndefinedProperties,n)}function Of(e,t,n,r,s,i={}){const o=e.ju(i.merge||i.mergeFields?2:0,t,n,s);$f("Data must be an object, but it was:",o,r);const a=Wf(r,o);let c,u;if(i.merge)c=new To(o.fieldMask),u=o.fieldTransforms;else if(i.mergeFields){const e=[];for(const r of i.mergeFields){const s=Bf(t,r,n);if(!o.contains(s))throw new Xs(Ys.INVALID_ARGUMENT,`Field '${s}' is specified in your field mask but missing from your input data.`);Gf(e,s)||e.push(s)}c=new To(e),u=o.fieldTransforms.filter((e=>c.covers(e.field)))}else c=null,u=o.fieldTransforms;return new Af(new ha(a),c,u)}class Pf extends If{_toFieldTransform(e){if(2!==e.Lu)throw 1===e.Lu?e.Wu(`${this._methodName}() can only appear at the top level of your update data`):e.Wu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Pf}}class Lf extends If{_toFieldTransform(e){return new Pc(e.path,new Tc)}isEqual(e){return e instanceof Lf}}class Mf extends If{constructor(e,t){super(e),this.Ju=t}_toFieldTransform(e){const t=new Dc(e.serializer,_c(e.serializer,this.Ju));return new Pc(e.path,t)}isEqual(e){return e instanceof Mf&&this.Ju===e.Ju}}function xf(e,t,n,r){const s=e.ju(1,t,n);$f("Data must be an object, but it was:",s,r);const i=[],o=ha.empty();vo(r,((e,r)=>{const a=zf(t,e,n);r=D(r);const c=s.Uu(a);if(r instanceof Pf)i.push(a);else{const e=Vf(r,c);null!=e&&(i.push(a),o.set(a,e))}}));const a=new To(i);return new Cf(o,a,s.fieldTransforms)}function Uf(e,t,n,r,s,i){const o=e.ju(1,t,n),a=[Bf(t,r,n)],c=[s];if(i.length%2!=0)throw new Xs(Ys.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let e=0;e<i.length;e+=2)a.push(Bf(t,i[e])),c.push(i[e+1]);const u=[],l=ha.empty();for(let e=a.length-1;e>=0;--e)if(!Gf(u,a[e])){const t=a[e];let n=c[e];n=D(n);const r=o.Uu(t);if(n instanceof Pf)u.push(t);else{const e=Vf(n,r);null!=e&&(u.push(t),l.set(t,e))}}const h=new To(u);return new Cf(l,h,o.fieldTransforms)}function Ff(e,t,n,r=!1){return Vf(n,e.ju(r?4:3,t))}function Vf(e,t){if(jf(e=D(e)))return $f("Unsupported field value:",t,e),Wf(e,t);if(e instanceof If)return function(e,t){if(!kf(t.Lu))throw t.Wu(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.Wu(`${e._methodName}() is not currently supported inside arrays`);const n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.Qu&&4!==t.Lu)throw t.Wu("Nested arrays are not supported");return function(e,t){const n=[];let r=0;for(const s of e){let e=Vf(s,t.Ku(r));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),r++}return{arrayValue:{values:n}}}(e,t)}return function(e,t){if(null===(e=D(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return _c(t.serializer,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){const n=vi.fromDate(e);return{timestampValue:bu(t.serializer,n)}}if(e instanceof vi){const n=new vi(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:bu(t.serializer,n)}}if(e instanceof Sf)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof _f)return{bytesValue:Tu(t.serializer,e._byteString)};if(e instanceof lf){const n=t.databaseId,r=e.firestore._databaseId;if(!r.isEqual(n))throw t.Wu(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:ku(e.firestore._databaseId||t.databaseId,e._key.path)}}if(e instanceof bf)return function(e,t){return{mapValue:{fields:{[$o]:{stringValue:zo},[Ho]:{arrayValue:{values:e.toArray().map((e=>{if("number"!=typeof e)throw t.Wu("VectorValues must only contain numeric values.");return vc(t.serializer,e)}))}}}}}}(e,t);throw t.Wu(`Unsupported field value: ${tf(e)}`)}(e,t)}function Wf(e,t){const n={};return wo(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):vo(e,((e,r)=>{const s=Vf(r,t.qu(e));null!=s&&(n[e]=s)})),{mapValue:{fields:n}}}function jf(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof vi||e instanceof Sf||e instanceof _f||e instanceof lf||e instanceof If||e instanceof bf)}function $f(e,t,n){if(!jf(n)||!function(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}(n)){const r=tf(n);throw"an object"===r?t.Wu(e+" a custom object"):t.Wu(e+" "+r)}}function Bf(e,t,n){if((t=D(t))instanceof Ef)return t._internalPath;if("string"==typeof t)return zf(e,t);throw Hf("Field path arguments must be of type string or ",e,!1,void 0,n)}const qf=new RegExp("[~\\*/\\[\\]]");function zf(e,t,n){if(t.search(qf)>=0)throw Hf(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,n);try{return new Ef(...t.split("."))._internalPath}catch(r){throw Hf(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,n)}}function Hf(e,t,n,r,s){const i=r&&!r.isEmpty(),o=void 0!==s;let a=`Function ${t}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(i||o)&&(c+=" (found",i&&(c+=` in field ${r}`),o&&(c+=` in document ${s}`),c+=")"),new Xs(Ys.INVALID_ARGUMENT,a+e+c)}function Gf(e,t){return e.some((e=>e.isEqual(t)))}class Kf{constructor(e,t,n,r,s){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new lf(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new Qf(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Jf("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class Qf extends Kf{data(){return super.data()}}function Jf(e,t){return"string"==typeof t?zf(e,t):t instanceof Ef?t._internalPath:t._delegate._internalPath}function Yf(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new Xs(Ys.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Xf{}class Zf extends Xf{}class ep extends Zf{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new ep(e,t,n)}_apply(e){const t=this._parse(e);return ip(e._query,t),new uf(e.firestore,e.converter,Qa(e._query,t))}_parse(e){const t=Rf(e.firestore),n=function(e,t,n,r,s,i,o){let a;if(s.isKeyField()){if("array-contains"===i||"array-contains-any"===i)throw new Xs(Ys.INVALID_ARGUMENT,`Invalid Query. You can't perform '${i}' queries on documentId().`);if("in"===i||"not-in"===i){sp(o,i);const t=[];for(const n of o)t.push(rp(r,e,n));a={arrayValue:{values:t}}}else a=rp(r,e,o)}else"in"!==i&&"not-in"!==i&&"array-contains-any"!==i||sp(o,i),a=Ff(n,t,o,"in"===i||"not-in"===i);return _a.create(s,i,a)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value);return n}}function tp(e,t,n){const r=t,s=Jf("where",e);return ep._create(s,r,n)}class np extends Xf{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new np(e,t)}_parse(e){const t=this._queryConstraints.map((t=>t._parse(e))).filter((e=>e.getFilters().length>0));return 1===t.length?t[0]:Ea.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(e,t){let n=e;const r=t.getFlattenedFilters();for(const e of r)ip(n,e),n=Qa(n,e)}(e._query,t),new uf(e.firestore,e.converter,Qa(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}function rp(e,t,n){if("string"==typeof(n=D(n))){if(""===n)throw new Xs(Ys.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!za(t)&&-1!==n.indexOf("/"))throw new Xs(Ys.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=t.path.child(Ii.fromString(n));if(!Ti.isDocumentKey(r))throw new Xs(Ys.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return na(e,new Ti(r))}if(n instanceof lf)return na(e,n._key);throw new Xs(Ys.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${tf(n)}.`)}function sp(e,t){if(!Array.isArray(e)||0===e.length)throw new Xs(Ys.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function ip(e,t){const n=function(e,t){for(const n of e)for(const e of n.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}(e.filters,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==n)throw n===t.op?new Xs(Ys.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new Xs(Ys.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${n.toString()}' filters.`)}class op{convertValue(e,t="none"){switch(Go(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Do(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Ro(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw Ks()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const n={};return vo(e,((e,r)=>{n[e]=this.convertValue(r,t)})),n}convertVectorValue(e){var t,n,r;const s=null===(r=null===(n=null===(t=e.fields)||void 0===t?void 0:t[Ho].arrayValue)||void 0===n?void 0:n.values)||void 0===r?void 0:r.map((e=>Do(e.doubleValue)));return new bf(s)}convertGeoPoint(e){return new Sf(Do(e.latitude),Do(e.longitude))}convertArray(e,t){return(e.values||[]).map((e=>this.convertValue(e,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const n=Uo(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(Fo(e));default:return null}}convertTimestamp(e){const t=No(e);return new vi(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=Ii.fromString(e);Qs(Ju(n));const r=new jo(n.get(1),n.get(3)),s=new Ti(n.popFirst(5));return r.isEqual(t)||zs(`Document ${s} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}}function ap(e,t,n){let r;return r=e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t,r}class cp{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class up extends Kf{constructor(e,t,n,r,s,i){super(e,t,n,r,i),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new lp(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(Jf("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class lp extends up{data(e={}){return super.data(e)}}class hp{constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new cp(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach((n=>{e.call(t,new lp(this._firestore,this._userDataWriter,n.key,n,new cp(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new Xs(Ys.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map((n=>{const r=new lp(e._firestore,e._userDataWriter,n.doc.key,n.doc,new cp(e._snapshot.mutatedKeys.has(n.doc.key),e._snapshot.fromCache),e.query.converter);return n.doc,{type:"added",doc:r,oldIndex:-1,newIndex:t++}}))}{let n=e._snapshot.oldDocs;return e._snapshot.docChanges.filter((e=>t||3!==e.type)).map((t=>{const r=new lp(e._firestore,e._userDataWriter,t.doc.key,t.doc,new cp(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter);let s=-1,i=-1;return 0!==t.type&&(s=n.indexOf(t.doc.key),n=n.delete(t.doc.key)),1!==t.type&&(n=n.add(t.doc),i=n.indexOf(t.doc.key)),{type:dp(t.type),doc:r,oldIndex:s,newIndex:i}}))}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function dp(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Ks()}}function fp(e){e=nf(e,lf);const t=nf(e.firestore,yf);return Kd(vf(t),e._key).then((n=>Ep(t,e,n)))}class pp extends op{constructor(e){super(),this.firestore=e}convertBytes(e){return new _f(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new lf(this.firestore,null,t)}}function gp(e){e=nf(e,uf);const t=nf(e.firestore,yf),n=vf(t),r=new pp(t);return Yf(e._query),Qd(n,e._query).then((n=>new hp(t,r,e,n)))}function mp(e,t,n){e=nf(e,lf);const r=nf(e.firestore,yf),s=ap(e.converter,t,n);return _p(r,[Of(Rf(r),"setDoc",e._key,s,null!==e.converter,n).toMutation(e._key,Mc.none())])}function yp(e,t,n,...r){e=nf(e,lf);const s=nf(e.firestore,yf),i=Rf(s);let o;return o="string"==typeof(t=D(t))||t instanceof Ef?Uf(i,"updateDoc",e._key,t,n,r):xf(i,"updateDoc",e._key,t),_p(s,[o.toMutation(e._key,Mc.exists(!0))])}function vp(e){return _p(nf(e.firestore,yf),[new Kc(e._key,Mc.none())])}function wp(e,...t){var n,r,s;e=D(e);let i={includeMetadataChanges:!1,source:"default"},o=0;"object"!=typeof t[o]||mf(t[o])||(i=t[o],o++);const a={includeMetadataChanges:i.includeMetadataChanges,source:i.source};if(mf(t[o])){const e=t[o];t[o]=null===(n=e.next)||void 0===n?void 0:n.bind(e),t[o+1]=null===(r=e.error)||void 0===r?void 0:r.bind(e),t[o+2]=null===(s=e.complete)||void 0===s?void 0:s.bind(e)}let c,u,l;if(e instanceof lf)u=nf(e.firestore,yf),l=Ba(e._key.path),c={next:n=>{t[o]&&t[o](Ep(u,e,n))},error:t[o+1],complete:t[o+2]};else{const n=nf(e,uf);u=nf(n.firestore,yf),l=n._query;const r=new pp(u);c={next:e=>{t[o]&&t[o](new hp(u,r,n,e))},error:t[o+1],complete:t[o+2]},Yf(e._query)}return function(e,t,n,r){const s=new Vd(r),i=new id(t,s,n);return e.asyncQueue.enqueueAndForget((async()=>Xh(await Gd(e),i))),()=>{s.su(),e.asyncQueue.enqueueAndForget((async()=>Zh(await Gd(e),i)))}}(vf(u),l,a,c)}function _p(e,t){return function(e,t){const n=new Zs;return e.asyncQueue.enqueueAndForget((async()=>async function(e,t,n){const r=Md(e);try{const e=await function(e,t){const n=Js(e),r=vi.now(),s=t.reduce(((e,t)=>e.add(t.key)),gc());let i,o;return n.persistence.runTransaction("Locally write mutations","readwrite",(e=>{let a=oc(),c=gc();return n.ds.getEntries(e,s).next((e=>{a=e,a.forEach(((e,t)=>{t.isValidDocument()||(c=c.add(e))}))})).next((()=>n.localDocuments.getOverlayedDocuments(e,a))).next((s=>{i=s;const o=[];for(const e of t){const t=jc(e,i.get(e.key).overlayedDocument);null!=t&&o.push(new qc(e.key,t,da(t.value.mapValue),Mc.exists(!0)))}return n.mutationQueue.addMutationBatch(e,r,o,t)})).next((t=>{o=t;const r=t.applyToLocalDocumentSet(i,c);return n.documentOverlayCache.saveOverlays(e,t.batchId,r)}))})).then((()=>({batchId:o.batchId,changes:uc(i)})))}(r.localStore,t);r.sharedClientState.addPendingMutation(e.batchId),function(e,t,n){let r=e.Wa[e.currentUser.toKey()];r||(r=new _o(hi)),r=r.insert(t,n),e.Wa[e.currentUser.toKey()]=r}(r,e.batchId,n),await Rd(r,e.changes),await Rh(r.remoteStore)}catch(e){const t=zh(e,"Failed to persist write");n.reject(t)}}(await Hd(e),t,n))),n.promise}(vf(e),t)}function Ep(e,t,n){const r=n.docs.get(t._key),s=new pp(e);return new up(e,s,t._key,r,new cp(n.hasPendingWrites,n.fromCache),t.converter)}class Ip{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=Rf(e)}set(e,t,n){this._verifyNotCommitted();const r=Sp(e,this._firestore),s=ap(r.converter,t,n),i=Of(this._dataReader,"WriteBatch.set",r._key,s,null!==r.converter,n);return this._mutations.push(i.toMutation(r._key,Mc.none())),this}update(e,t,n,...r){this._verifyNotCommitted();const s=Sp(e,this._firestore);let i;return i="string"==typeof(t=D(t))||t instanceof Ef?Uf(this._dataReader,"WriteBatch.update",s._key,t,n,r):xf(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(i.toMutation(s._key,Mc.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=Sp(e,this._firestore);return this._mutations=this._mutations.concat(new Kc(t._key,Mc.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new Xs(Ys.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function Sp(e,t){if((e=D(e)).firestore!==t)throw new Xs(Ys.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}function bp(){return new Pf("deleteField")}function Tp(){return new Lf("serverTimestamp")}function Ap(e){return new Mf("increment",e)}function Cp(e){return vf(e=nf(e,yf)),new Ip(e,(t=>_p(e,t)))}new WeakMap;var kp;!function(e,t=!0){!function(e){js=e}(ze),We(new R("firestore",((e,{instanceIdentifier:n,options:r})=>{const s=e.getProvider("app").getImmediate(),i=new yf(new ri(e.getProvider("auth-internal")),new ai(s,e.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new Xs(Ys.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new jo(e.options.projectId,t)}(s,n),s);return r=Object.assign({useFetchStreams:t},r),i._setSettings(r),i}),"PUBLIC").setMultipleInstances(!0)),Ke(Fs,Vs,e),Ke(Fs,Vs,"esm2017")}();const Np="undefined"!=typeof chrome&&(null===(kp=chrome.runtime)||void 0===kp?void 0:kp.id),Dp={apiKey:"AIzaSyAVxAdCx5JW0K7o5B53p_fThHYUPtWRQF4",authDomain:"vidlearn-ai.firebaseapp.com",projectId:"vidlearn-ai",storageBucket:"vidlearn-ai.firebasestorage.app",messagingSenderId:"1097713470067",appId:"1:1097713470067:web:821f08db03951f83363806"},Rp=He(Dp),Op=function(e=Ge()){const t=je(e,"auth");if(t.isInitialized())return t.getImmediate();const n=function(e,t){const n=je(e,"auth");if(n.isInitialized()){const e=n.getImmediate();if(S(n.getOptions(),null!=t?t:{}))return e;ht(e,"already-initialized")}return n.initialize({options:t})}(e,{popupRedirectResolver:ms,persistence:[Ar,ur,hr]}),r=g("authTokenSyncURL");if(r&&"boolean"==typeof isSecureContext&&isSecureContext){const e=new URL(r,location.origin);if(location.origin===e.origin){const t=(s=e.toString(),async e=>{const t=e&&await e.getIdTokenResult(),n=t&&((new Date).getTime()-Date.parse(t.issuedAtTime))/1e3;if(n&&n>_s)return;const r=null==t?void 0:t.token;Es!==r&&(Es=r,await fetch(s,{method:r?"POST":"DELETE",headers:r?{Authorization:`Bearer ${r}`}:{}}))});!function(e,t,n){D(e).beforeAuthStateChanged(t,n)}(n,t,(()=>t(n.currentUser))),function(e,t,n,r){D(e).onIdTokenChanged(t,n,r)}(n,(e=>t(e)))}}var s;const i=f("auth");return i&&On(n,`http://${i}`),n}(Rp),Pp=function(e,t){const n="object"==typeof e?e:Ge(),r="string"==typeof e?e:t||Wo,s=je(n,"firestore").getImmediate({identifier:r});if(!s._initialized){const e=(e=>{const t=f(e);if(!t)return;const n=t.lastIndexOf(":");if(n<=0||n+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const r=parseInt(t.substring(n+1),10);return"["===t[0]?[t.substring(1,n-1),r]:[t.substring(0,n),r]})("firestore");e&&cf(s,...e)}return s}(Rp);if(Np){console.log("WordStream: Running in Chrome extension environment");const e=chrome.runtime.id?`chrome-extension://${chrome.runtime.id}`:"";e&&console.log(`WordStream: Extension origin: ${e}`)}console.log("WordStream: Firebase initialized with config:",Object.keys(Dp).filter((e=>"apiKey"!==e)).join(", "));var Lp=function(e,t,n,r){return new(n||(n=Promise))((function(s,i){function o(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))};const Mp={getCurrentUser(){var e;const t=function(){const e=Op.currentUser;console.log("WordStream Auth: Getting current user from auth:",e?`User ${e.email} (uid: ${e.uid})`:"No user in auth object");try{if(!e&&"undefined"!=typeof window&&window.WordStream&&window.WordStream.currentUser)return console.log("WordStream Auth: Found user in window.WordStream:",window.WordStream.currentUser),window.WordStream.currentUser;if(!e&&"undefined"!=typeof localStorage){const e=localStorage.getItem("wordstream_user");if(e)try{const t=JSON.parse(e);return console.log("WordStream Auth: Found user in localStorage:",t),t}catch(e){console.warn("WordStream Auth: Error parsing stored user:",e)}}}catch(e){console.error("WordStream Auth: Error in additional user checks:",e)}return console.log("WordStream Auth: Auth state:",Op.currentUser?"Authenticated":"Not authenticated","SignIn methods count:",null!==Op.languageCode?"Available":"Not available"),e}();return t?(this.updateAuthState(t),t):"undefined"!=typeof window&&(null===(e=window.WordStream)||void 0===e?void 0:e.currentUser)?window.WordStream.currentUser:(this.checkStorageAuth(),null)},isAuthenticated(){return!!this.getCurrentUser()},updateAuthState(e){"undefined"!=typeof window&&(window.WordStream||(window.WordStream={}),e?(window.WordStream.currentUser={uid:e.uid,email:e.email,displayName:e.displayName,photoURL:e.photoURL},window.WordStream.isAuthenticated=!0):(window.WordStream.currentUser=void 0,window.WordStream.isAuthenticated=!1)),this.saveToStorage(e)},saveToStorage(e){var t;try{if("undefined"!=typeof localStorage&&(e?(localStorage.setItem("wordstream_auth_state","authenticated"),localStorage.setItem("wordstream_user_info",JSON.stringify({uid:e.uid,email:e.email,displayName:e.displayName,photoURL:e.photoURL}))):(localStorage.removeItem("wordstream_auth_state"),localStorage.removeItem("wordstream_user_info"))),"undefined"!=typeof chrome&&(null===(t=chrome.storage)||void 0===t?void 0:t.local)){const t=e?{isAuthenticated:!0,userInfo:{uid:e.uid,email:e.email,displayName:e.displayName,photoURL:e.photoURL},lastAuthCheck:(new Date).toISOString()}:{isAuthenticated:!1,userInfo:null,lastAuthCheck:(new Date).toISOString()};chrome.storage.local.set(t)}}catch(e){console.warn("WordStream AuthManager: Error saving auth state:",e)}},checkStorageAuth(){return Lp(this,void 0,void 0,(function*(){var e;try{if("undefined"!=typeof chrome&&(null===(e=chrome.storage)||void 0===e?void 0:e.local)){const e=yield new Promise((e=>{chrome.storage.local.get(["isAuthenticated","userInfo"],(t=>{e(t)}))}));if(e.isAuthenticated&&e.userInfo)return"undefined"!=typeof window&&(window.WordStream||(window.WordStream={}),window.WordStream.currentUser=e.userInfo,window.WordStream.isAuthenticated=!0),e.userInfo}if("undefined"!=typeof localStorage){const e=localStorage.getItem("wordstream_auth_state"),t=localStorage.getItem("wordstream_user_info");if("authenticated"===e&&t){const e=JSON.parse(t);return"undefined"!=typeof window&&(window.WordStream||(window.WordStream={}),window.WordStream.currentUser=e,window.WordStream.isAuthenticated=!0),e}}}catch(e){console.warn("WordStream AuthManager: Error checking storage auth:",e)}return null}))},verifyTokenAndRefresh(){return Lp(this,void 0,void 0,(function*(){try{const e=this.getCurrentUser();if(!e)return console.warn("WordStream AuthManager: No user to refresh token"),!1;if(Op.currentUser)try{if(console.log("WordStream AuthManager: Reload existing user"),yield Op.currentUser.reload(),!Op.currentUser)return console.warn("WordStream AuthManager: User disappeared after reload"),!1}catch(e){console.warn("WordStream AuthManager: Error reloading user:",e)}else console.warn("WordStream AuthManager: No Firebase auth.currentUser available for token refresh");let t;if(Op.currentUser&&"function"==typeof Op.currentUser.getIdToken)try{console.log("WordStream AuthManager: Forcing token refresh via Firebase auth"),t=yield Op.currentUser.getIdToken(!0)}catch(e){console.warn("WordStream AuthManager: Firebase token refresh failed:",e)}if(!t&&"function"==typeof e.getIdToken)try{console.log("WordStream AuthManager: Forcing token refresh via cached user"),t=yield e.getIdToken(!0)}catch(e){return console.warn("WordStream AuthManager: Cached user token refresh failed:",e),!1}if(!t)return console.warn("WordStream AuthManager: Failed to obtain fresh token"),!1;yield new Promise((e=>setTimeout(e,1500)));const n=Op.currentUser||e;return this.updateAuthState(n),console.log("WordStream AuthManager: Token refreshed successfully"),!0}catch(e){return console.warn("WordStream AuthManager: Token refresh failed:",e),!1}}))},checkPermissions(){return Lp(this,void 0,void 0,(function*(){try{if(!this.isAuthenticated())return console.warn("WordStream AuthManager: Cannot check permissions - user not authenticated"),!1;const e=this.getCurrentUser();if(!e||!e.uid)return console.warn("WordStream AuthManager: Cannot check permissions - no valid user ID"),!1;try{return console.log("WordStream AuthManager: Testing permissions with basic document read"),yield Up(),console.log("WordStream AuthManager: Permissions check passed"),!0}catch(e){if("permission-denied"===(null==e?void 0:e.code)){console.warn("WordStream AuthManager: Permission denied, attempting aggressive token refresh");try{if(yield this.verifyTokenAndRefresh())try{return yield Up(),console.log("WordStream AuthManager: Permissions check passed after token refresh"),!0}catch(e){console.warn("WordStream AuthManager: Still no permissions after token refresh")}}catch(e){console.warn("WordStream AuthManager: Error during permissions retry:",e)}}return console.warn("WordStream AuthManager: Permission check failed:",(null==e?void 0:e.code)||e),!1}}catch(e){return console.warn("WordStream AuthManager: Error during permission check:",e),!1}}))},reauthenticateIfNeeded(){return Lp(this,void 0,void 0,(function*(){var e,t;try{console.log("WordStream: Starting reauthentication process");if(yield this.checkPermissions())return console.log("WordStream: User already has valid permissions"),!0;const n=this.getCurrentUser();if(!n)return console.warn("WordStream: No user found for reauthentication"),!1;console.log("WordStream: Found user for reauthentication:",n.uid);if("function"==typeof(null===(e=Op.currentUser)||void 0===e?void 0:e.reload))try{console.log("WordStream: Attempting to reload Firebase user"),yield Op.currentUser.reload(),"function"==typeof Op.currentUser.getIdToken&&(yield Op.currentUser.getIdToken(!0));if(yield this.checkPermissions())return console.log("WordStream: User reload reauthentication succeeded"),!0}catch(e){console.warn("WordStream: Error reloading Firebase user:",e)}if("function"==typeof n.getIdToken)try{console.log("WordStream: Attempting direct token refresh"),yield n.getIdToken(!0);if(yield this.checkPermissions())return console.log("WordStream: Direct token refresh succeeded"),!0}catch(e){console.warn("WordStream: Error refreshing token directly:",e)}if("undefined"!=typeof chrome&&(null===(t=chrome.runtime)||void 0===t?void 0:t.id))try{console.log("WordStream: Attempting Chrome extension-specific authentication"),localStorage.removeItem("wordstream_auth_state"),localStorage.setItem("wordstream_auth_state","refreshing"),chrome.identity&&"function"==typeof chrome.identity.getAuthToken&&(yield new Promise(((e,t)=>{chrome.identity.getAuthToken({interactive:!1},(n=>{chrome.runtime.lastError?(console.warn("WordStream: Chrome identity error:",chrome.runtime.lastError),t(chrome.runtime.lastError)):n?(console.log("WordStream: Got new Chrome identity token"),e()):t(new Error("No token returned"))}))}))),this.saveToStorage(n);if(yield this.checkPermissions())return console.log("WordStream: Chrome-specific reauthentication succeeded"),!0}catch(e){console.warn("WordStream: Error in Chrome-specific reauthentication:",e)}return(yield this.checkPermissions())?(console.log("WordStream: Reauthentication eventually succeeded"),!0):(console.warn("WordStream: All reauthentication attempts failed, user interaction may be needed"),!1)}catch(e){return console.warn("WordStream: Unhandled error during reauthentication:",e),!1}}))}},xp=Mp;function Up(){return Lp(this,void 0,void 0,(function*(){try{const e=Mp.getCurrentUser();if(!e)return null;const t=ff(Pp,"users",e.uid),n=yield fp(t);if(n.exists())return Object.assign({id:n.id},n.data());{const n={uid:e.uid,email:e.email,displayName:e.displayName,photoURL:e.photoURL,createdAt:new Date};return yield mp(t,n),n}}catch(e){return console.error("Error getting user profile document:",e),null}}))}function Fp(e){if(!e)return!1;if("number"==typeof e){const t=new Date(e);return!isNaN(t.getTime())&&t.getFullYear()>=1970&&t.getFullYear()<=2100}if(e instanceof Date)return!isNaN(e.getTime())&&e.getFullYear()>=1970&&e.getFullYear()<=2100;try{const t=new Date(String(e));return!isNaN(t.getTime())&&t.getFullYear()>=1970&&t.getFullYear()<=2100}catch(e){return!1}}function Vp(e){if(null==e)return new Date;try{if("[object Object]"===e||"[object Object"===e||"string"==typeof e&&(e.includes("[object Object]")||e.includes("[object Object"))||e&&"function"==typeof e.toString&&("[object Object]"===e.toString()||"[object Object"===e.toString()))return console.log("WordStream: Intercepted [object Object] value, using current date"),new Date;if(e instanceof Date)return Fp(e)?e:new Date;if(e&&"object"==typeof e&&"function"==typeof e.toDate)try{const t=e.toDate();return Fp(t)?t:new Date}catch(e){}if(e&&"object"==typeof e&&"seconds"in e)try{const t="number"==typeof e.seconds?e.seconds:parseInt(String(e.seconds),10);if(!isNaN(t)){const e=new Date(1e3*t);return Fp(e)?e:new Date}}catch(e){}if("string"==typeof e){if(e.startsWith("[object")||e.includes("undefined")||e.includes("null"))return new Date;if(e.includes("seconds")||e.includes("nanoseconds"))try{const t=JSON.parse(e);if(t&&t.seconds){const e="number"==typeof t.seconds?t.seconds:parseInt(String(t.seconds),10);if(!isNaN(e)){const t=new Date(1e3*e);return Fp(t)?t:new Date}}}catch(e){}try{const t=new Date(e);if(Fp(t))return t}catch(e){}const t=e.match(/(\d+)/);if(t&&t[1]){const e=parseInt(t[1],10);if(!isNaN(e)){const t=e<1e10?new Date(1e3*e):new Date(e);if(Fp(t))return t}}}if("number"==typeof e)try{const t=e<1e10?new Date(1e3*e):new Date(e);return Fp(t)?t:new Date}catch(e){}if(e&&"object"==typeof e){const t=["time","date","timestamp","created","createdAt","modified","modifiedAt","updated","updatedAt"];for(const n of t)if(n in e&&null!==e[n]&&void 0!==e[n]){const t=e[n];if(t instanceof Date)return Fp(t)?t:new Date;if("object"==typeof t&&t&&"function"==typeof t.toDate)try{const e=t.toDate();return Fp(e)?e:new Date}catch(e){}if("object"==typeof t&&t&&"seconds"in t)try{const e="number"==typeof t.seconds?t.seconds:parseInt(String(t.seconds),10);if(!isNaN(e)){const t=new Date(1e3*e);return Fp(t)?t:new Date}}catch(e){}try{const e=String(t);if(e.includes("[object"))continue;const n=new Date(e);if(Fp(n))return n}catch(e){}}for(const n in e){const r=e[n];if(r&&"object"==typeof r)for(const e of t)if(e in r&&null!==r[e]&&void 0!==r[e])try{const t=Vp(r[e]);if(t)return t}catch(e){}}}return new Date}catch(e){return console.log("WordStream: Date conversion error suppressed, using current date"),new Date}}const Wp={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let jp;const $p=new Uint8Array(16);const Bp=[];for(let e=0;e<256;++e)Bp.push((e+256).toString(16).slice(1));function qp(e,t=0){return(Bp[e[t+0]]+Bp[e[t+1]]+Bp[e[t+2]]+Bp[e[t+3]]+"-"+Bp[e[t+4]]+Bp[e[t+5]]+"-"+Bp[e[t+6]]+Bp[e[t+7]]+"-"+Bp[e[t+8]]+Bp[e[t+9]]+"-"+Bp[e[t+10]]+Bp[e[t+11]]+Bp[e[t+12]]+Bp[e[t+13]]+Bp[e[t+14]]+Bp[e[t+15]]).toLowerCase()}const zp=function(e,t,n){if(Wp.randomUUID&&!t&&!e)return Wp.randomUUID();const r=(e=e||{}).random??e.rng?.()??function(){if(!jp){if("undefined"==typeof crypto||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");jp=crypto.getRandomValues.bind(crypto)}return jp($p)}();if(r.length<16)throw new Error("Random bytes length must be >= 16");if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){if((n=n||0)<0||n+16>t.length)throw new RangeError(`UUID byte range ${n}:${n+15} is out of buffer bounds`);for(let e=0;e<16;++e)t[n+e]=r[e];return t}return qp(r)};var Hp=function(e,t,n,r){return new(n||(n=Promise))((function(s,i){function o(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))};function Gp(){var e,t;try{const n=xp.getCurrentUser();if(n&&n.uid)return n.uid;if("undefined"!=typeof window&&(null===(t=null===(e=window.WordStream)||void 0===e?void 0:e.currentUser)||void 0===t?void 0:t.uid))return console.log("WordStream: Using user from window.WordStream:",window.WordStream.currentUser.uid),window.WordStream.currentUser.uid;if("undefined"!=typeof localStorage)try{const e=localStorage.getItem("wordstream_auth_state"),t=localStorage.getItem("wordstream_user_info");if("authenticated"===e&&t){const e=JSON.parse(t);if(e&&e.uid)return console.log("WordStream: Using user from localStorage:",e.uid),e.uid}}catch(e){console.warn("WordStream: Error reading auth from localStorage:",e)}return console.warn("WordStream: No authenticated user found"),null}catch(e){return console.warn("WordStream: Error getting current user ID:",e),null}}function Kp(){return Hp(this,void 0,void 0,(function*(){try{const e=Gp();if(!e)return null;return(yield xp.verifyTokenAndRefresh())?e:(console.warn("WordStream: Token validation failed"),null)}catch(e){return console.warn("WordStream: Auth validation error:",e),null}}))}function Qp(){const e=Gp();e?(!function(e){const t=df(Pp,"users",e,"userData","wordlist","items");wp(t,(e=>{try{const t=e.docs.map((e=>Object.assign({id:e.id},e.data())));console.log(`WordStream: Synced ${t.length} words from Firestore`),chrome.storage.sync.set({words:t},(()=>{Jp({action:"WORDS_UPDATED",words:t})}))}catch(e){console.error("WordStream: Error processing wordlist sync:",e)}}),(e=>{console.error("WordStream: Error in wordlist sync:",e)}))}(e),function(e){const t=df(Pp,"users",e,"userData","chats","items");wp(t,(e=>{try{const t=e.docs.map((e=>{var t,n;const r=e.data();return Object.assign(Object.assign({id:e.id},r),{createdAt:null===(t=Vp(r.createdAt))||void 0===t?void 0:t.toISOString(),updatedAt:null===(n=Vp(r.updatedAt))||void 0===n?void 0:n.toISOString(),messages:Array.isArray(r.messages)?r.messages.map((e=>{var t;return Object.assign(Object.assign({},e),{timestamp:(null===(t=Vp(e.timestamp))||void 0===t?void 0:t.toISOString())||(new Date).toISOString()})})):[]})}));console.log(`WordStream: Synced ${t.length} chats from Firestore`),chrome.storage.sync.set({chats:t},(()=>{Jp({action:"CHATS_UPDATED",chats:t})}))}catch(e){console.error("WordStream: Error processing chats sync:",e)}}),(e=>{console.error("WordStream: Error in chats sync:",e)}))}(e),function(e){const t=df(Pp,"users",e,"userData","notes","items");wp(t,(e=>{try{const t=e.docs.map((e=>{var t,n;const r=e.data();return Object.assign(Object.assign({id:e.id},r),{createdAt:null===(t=Vp(r.createdAt))||void 0===t?void 0:t.toISOString(),updatedAt:null===(n=Vp(r.updatedAt))||void 0===n?void 0:n.toISOString()})}));console.log(`WordStream: Synced ${t.length} notes from Firestore`),chrome.storage.sync.set({notes:t},(()=>{Jp({action:"NOTES_UPDATED",notes:t})}))}catch(e){console.error("WordStream: Error processing notes sync:",e)}}),(e=>{console.error("WordStream: Error in notes sync:",e)}))}(e),function(e){const t=df(Pp,"users",e,"userData");wp(ff(t,"stats"),(e=>{var t;try{const n=e.data()||{},r=Object.assign(Object.assign({},n),{lastActive:(null===(t=Vp(n.lastActive))||void 0===t?void 0:t.toISOString())||(new Date).toISOString()});console.log("WordStream: Synced stats from Firestore"),chrome.storage.sync.set({stats:r},(()=>{Jp({action:"STATS_UPDATED",stats:r})}))}catch(e){console.error("WordStream: Error processing stats sync:",e)}}),(e=>{console.error("WordStream: Error in stats sync:",e)}))}(e),console.log("WordStream: Firestore sync initialized for user:",e)):console.warn("WordStream: Cannot initialize Firestore sync - no user ID available")}function Jp(e){try{if("undefined"!=typeof window){console.log("WordStream: Broadcasting message:",e),window.postMessage(e,"*");const t=(new Date).getTime(),n=`wordstream_broadcast_${t}`;localStorage.setItem(n,JSON.stringify(Object.assign(Object.assign({},e),{timestamp:t})));try{const e=[];for(let t=0;t<localStorage.length;t++){const n=localStorage.key(t);n&&n.startsWith("wordstream_broadcast_")&&e.push(n)}e.sort().reverse(),e.length>20&&e.slice(20).forEach((e=>localStorage.removeItem(e)))}catch(e){console.warn("WordStream: Error cleaning up broadcast messages:",e)}}}catch(e){console.error("WordStream: Error broadcasting message:",e)}}function Yp(e){return Hp(this,void 0,void 0,(function*(){try{const t=yield Kp();if(!t)return console.error("WordStream: Cannot save word - no authenticated user"),null;const n=df(Pp,"users",t,"wordlist"),r=function(e,t,...n){let r=[];t instanceof Xf&&r.push(t),r=r.concat(n),function(e){const t=e.filter((e=>e instanceof np)).length,n=e.filter((e=>e instanceof ep)).length;if(t>1||t>0&&n>0)throw new Xs(Ys.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const t of r)e=t._apply(e);return e}(n,tp("originalWord","==",e.originalWord),tp("sourceLanguage","==",e.sourceLanguage),tp("targetLanguage","==",e.targetLanguage)),s=yield gp(r);let i;if(s.empty){i=(yield function(e,t){const n=nf(e.firestore,yf),r=ff(e),s=ap(e.converter,t);return _p(n,[Of(Rf(e.firestore),"addDoc",r._key,s,null!==e.converter,{}).toMutation(r._key,Mc.exists(!1))]).then((()=>r))}(n,Object.assign(Object.assign({},e),{createdAt:Tp(),updatedAt:Tp()}))).id}else{i=s.docs[0].id,yield yp(ff(n,i),Object.assign(Object.assign({},e),{updatedAt:Tp()}))}return Xp(t),i}catch(e){return console.error("WordStream: Error saving word:",e),null}}))}function Xp(e){return Hp(this,void 0,void 0,(function*(){try{const t=df(Pp,"users",e,"wordlist"),n=yield gp(t),r=ff(df(Pp,"users",e,"userData"),"stats");yield mp(r,{totalWords:n.size,lastUpdated:Tp()},{merge:!0})}catch(e){console.error("WordStream: Error updating word count in stats:",e)}}))}function Zp(e){return Hp(this,void 0,void 0,(function*(){try{const t=yield Kp();if(!t)return console.warn("WordStream: Cannot sync words - no authenticated user"),!1;const n=df(Pp,"users",t,"userData","wordlist","items"),r=Cp(Pp),s=yield gp(n),i=new Map;s.docs.forEach((e=>{const t=e.data(),n=`${t.originalWord}-${t.sourceLanguage}-${t.targetLanguage}`;i.set(n,e.id)}));let o=0,a=0;for(const t of e){if(!t.originalWord||!t.targetWord){console.warn("WordStream: Skipping invalid word:",t);continue}const e=`${t.originalWord}-${t.sourceLanguage}-${t.targetLanguage}`;if(i.has(e)){const s=i.get(e);r.update(ff(n,s),Object.assign(Object.assign({},t),{updatedAt:Tp()})),o++}else{const e=ff(n);r.set(e,Object.assign(Object.assign({},t),{createdAt:Tp(),updatedAt:Tp()})),a++}}yield r.commit();const c=ff(df(Pp,"users",t,"userData"),"stats");return yield mp(c,{totalWords:i.size+a,lastUpdated:Tp()},{merge:!0}),console.log(`WordStream: Synced words to Firestore - ${a} new, ${o} updated`),!0}catch(e){return console.error("WordStream: Error syncing words to Firestore:",e),!1}}))}function eg(e){return Hp(this,void 0,void 0,(function*(){try{const t=yield Kp();if(!t)return console.warn("WordStream: Cannot save note - user not authenticated"),tg(e),e.id||"";const n=e.id||zp(),r=Object.assign(Object.assign({},e),{id:n,timestamp:e.timestamp||(new Date).toISOString(),lastSynced:(new Date).toISOString(),userId:t}),s=ff(Pp,"users",t,"notes",n);yield mp(s,r),tg(r);try{const r=ff(Pp,"users",t);yield yp(r,{lastNoteId:n,lastNoteTime:Tp(),lastActivity:Tp(),[`notesMetadata.${n}`]:{videoId:e.videoId,updatedAt:Tp()}})}catch(e){console.warn("WordStream: Error updating user document with note metadata:",e)}if(e.videoId)try{const r=ff(Pp,"users",t,"videos",e.videoId);(yield fp(r)).exists()?yield yp(r,{lastUpdated:Tp(),[`noteIds.${n}`]:!0}):yield mp(r,{videoId:e.videoId,title:e.videoTitle||"Unknown Video",url:e.videoURL||`https://www.youtube.com/watch?v=${e.videoId}`,createdAt:Tp(),lastUpdated:Tp(),noteIds:{[n]:!0}})}catch(e){console.warn("WordStream: Error updating video metadata:",e)}return Jp({type:"note:added",data:r,timestamp:(new Date).toISOString()}),n}catch(t){return console.error("WordStream: Error saving note to Firestore:",t),e?(tg(e),e.id||""):""}}))}function tg(e){e.id&&e.videoId?chrome.storage.local.get(["notes_storage"],(t=>{if(chrome.runtime.lastError)return void console.error("WordStream: Error getting notes from local storage:",chrome.runtime.lastError);const n=t.notes_storage||{},r=e.videoId;if(n[r]){const t=n[r].notes.findIndex((t=>t.id===e.id));t>=0?n[r].notes[t]=e:n[r].notes.push(e),n[r].lastUpdated=(new Date).toISOString()}else n[r]={videoId:r,videoTitle:e.videoTitle||"Unknown Video",videoURL:e.videoURL||`https://www.youtube.com/watch?v=${r}`,lastUpdated:(new Date).toISOString(),notes:[e]};chrome.storage.local.set({notes_storage:n},(()=>{chrome.runtime.lastError&&console.error("WordStream: Error saving notes to local storage:",chrome.runtime.lastError)}))})):console.warn("WordStream: Cannot save note to localStorage - missing id or videoId")}function ng(e,t){return Hp(this,void 0,void 0,(function*(){var n,r;try{console.log(`WordStream: Starting deletion of note ${e}`);const s=yield function(){return Hp(this,void 0,void 0,(function*(){try{if(console.log("WordStream: Checking Firestore connection..."),!Pp)return{connected:!1,authenticated:!1,userId:null,error:"Firestore not initialized"};const e=yield Kp();if(!!e)try{const t=ff(Pp,"users",e);return yield fp(t),console.log("WordStream: Successfully connected to Firestore and authenticated"),{connected:!0,authenticated:!0,userId:e}}catch(t){return console.error("WordStream: Error reading from Firestore:",t),{connected:!1,authenticated:!0,userId:e,error:`Read error: ${(null==t?void 0:t.message)||t}`}}return{connected:!1,authenticated:!1,userId:null,error:"Not authenticated"}}catch(e){return console.error("WordStream: Error checking Firestore connection:",e),{connected:!1,authenticated:!1,userId:null,error:(null==e?void 0:e.message)||String(e)}}}))}();if(!s.connected)return console.warn(`WordStream: Cannot delete note - ${s.error}`),!1;const i=s.userId;if(!e)return console.error("WordStream: Cannot delete note - missing noteId"),!1;try{let s=null;if(!t)try{const n=ff(Pp,"users",i,"userData","notes","items",e),r=yield fp(n);r.exists()&&(s=r.data(),t=s.videoId)}catch(e){console.warn(`WordStream: Error retrieving note info: ${e}`)}console.log(`WordStream: Deleting note document ${e}`);const o=ff(Pp,"users",i,"userData","notes","items",e);if(yield vp(o),t)try{console.log(`WordStream: Updating metadata for video ${t}`);const e=ff(Pp,"users",i,"userData","metadata"),n=yield fp(e);if(n.exists()&&n.data().videos&&n.data().videos[t]){const r=n.data().videos[t].noteCount||0;r<=1?(yield yp(e,{[`videos.${t}`]:bp()}),console.log(`WordStream: Removed video ${t} from metadata (last note deleted)`)):(yield yp(e,{[`videos.${t}.noteCount`]:r-1,[`videos.${t}.lastUpdated`]:Tp()}),console.log(`WordStream: Updated note count for video ${t} in metadata`))}}catch(e){console.warn(`WordStream: Error updating metadata after note deletion: ${e}`)}try{const t=ff(Pp,"users",i);yield yp(t,{lastActivity:Tp(),[`noteMeta.${e}`]:bp()})}catch(e){console.warn(`WordStream: Error updating user document after note deletion: ${e}`)}if("undefined"!=typeof window&&window.localStorage)try{const n="wordstream_deleted_notes",r=JSON.parse(localStorage.getItem(n)||"[]");if(r.push({id:e,videoId:t,timestamp:(new Date).toISOString()}),localStorage.setItem(n,JSON.stringify(r)),t){const n=`wordstream_notes_${t}`,r=JSON.parse(localStorage.getItem(n)||"[]").filter((t=>t.id!==e));localStorage.setItem(n,JSON.stringify(r))}}catch(e){console.warn("WordStream: Error updating local storage for deleted note:",e)}if(Jp({action:"NOTE_DELETED",noteId:e,videoId:t,timestamp:(new Date).toISOString()}),"function"==typeof(null===(r=null===(n=null===chrome||void 0===chrome?void 0:chrome.storage)||void 0===n?void 0:n.local)||void 0===r?void 0:r.get))try{chrome.storage.local.get(["notes_storage"],(n=>{const r=n.notes_storage||{};if(t&&r[t]){const n=r[t];n.notes&&(n.notes=n.notes.filter((t=>t.id!==e)),0===n.notes.length&&delete r[t],chrome.storage.local.set({notes_storage:r},(()=>{console.log("WordStream: Updated chrome.storage after note deletion")})))}else{let t=!1;Object.keys(r).forEach((n=>{const s=r[n];if(s.notes){const i=s.notes.length;s.notes=s.notes.filter((t=>t.id!==e)),i!==s.notes.length&&(t=!0,0===s.notes.length&&delete r[n])}})),t&&chrome.storage.local.set({notes_storage:r},(()=>{console.log("WordStream: Updated chrome.storage after note deletion (searched all videos)")}))}}))}catch(e){console.warn(`WordStream: Error updating chrome.storage after note deletion: ${e}`)}return console.log(`WordStream: Successfully deleted note ${e}`),!0}catch(t){return console.error(`WordStream: Error deleting note ${e}:`,t),!1}}catch(e){return console.error("WordStream: Error in deleteNote:",e),!1}}))}function rg(e){return Hp(this,void 0,void 0,(function*(){try{const t=yield Kp();if(!t)return console.error("WordStream: Cannot save stats - no authenticated user"),!1;const n=ff(Pp,"users",t,"stats");return yield mp(n,Object.assign(Object.assign({},e),{lastUpdated:Tp()}),{merge:!0}),!0}catch(e){return console.error("WordStream: Error saving user stats to Firestore:",e),!1}}))}function sg(e){return Hp(this,void 0,void 0,(function*(){try{const t=yield Kp();if(!t)return void console.warn("WordStream: Cannot sync data - no authenticated user");console.log(`WordStream: Starting sync of ${e||"all"} data for user ${t}`);const n=[];"words"!==e&&e||n.push("words"),"stats"!==e&&e||n.push("stats"),"chats"!==e&&e||n.push("chats_storage","video_chats_map"),"notes"!==e&&e||n.push("notes_storage");const r=yield new Promise((e=>{chrome.storage.sync.get(n,(t=>{chrome.runtime.lastError&&console.error("WordStream: Error getting data from storage:",chrome.runtime.lastError),e(t)}))}));let s={words:{success:!1,count:0},stats:{success:!1},chats:{success:!1,count:0},notes:{success:!1,count:0}};if(("words"===e||!e)&&r.words&&Array.isArray(r.words))try{const e=yield Zp(r.words);s.words={success:e,count:r.words.length},console.log(`WordStream: Synced ${r.words.length} words to Firestore`)}catch(e){console.error("WordStream: Error syncing words:",e)}if(("stats"===e||!e)&&r.stats)try{const e=yield rg(r.stats);s.stats={success:e},console.log("WordStream: Synced stats to Firestore")}catch(e){console.error("WordStream: Error syncing stats:",e)}if(("chats"===e||!e)&&r.chats_storage)try{const e=r.chats_storage||{},n=r.video_chats_map||{};let i=0,o=0;const a=Cp(Pp),c=df(Pp,"users",t,"userData","chats","items"),u=new Set;Object.keys(e).forEach((e=>u.add(e))),Object.keys(n).forEach((e=>{(n[e]||[]).forEach((e=>u.add(e)))})),console.log(`WordStream: Found ${u.size} chat IDs to sync`);const l={};for(const n of u){i++;const r=e[n];if(r)if(r.videoId)try{const e=Object.assign(Object.assign({},r),{id:n,conversationId:n,userId:t}),s=ff(c,n);a.set(s,e,{merge:!0}),l[r.videoId]||(l[r.videoId]=new Set),l[r.videoId].add(n),o++}catch(e){console.error(`WordStream: Error preparing chat ${n} for batch:`,e)}else console.warn(`WordStream: Chat ${n} missing videoId`);else console.warn(`WordStream: Chat ID ${n} found in map but not in storage`)}if(o>0&&(yield a.commit(),console.log(`WordStream: Batch saved ${o} chats to Firestore`)),o>0)try{const n=ff(Pp,"users",t),r={};Object.entries(e).forEach((([e,t])=>{t&&t.videoId&&(r[`chatsMeta.${e}`]={videoId:t.videoId,updatedAt:Tp()})})),Object.keys(r).length>0&&(yield yp(n,r),console.log(`WordStream: Updated user document with chat metadata for ${Object.keys(r).length} chats`))}catch(e){console.warn("WordStream: Error updating user document with chat metadata:",e)}for(const[e,n]of Object.entries(l))try{if(n.size>0){const r=ff(df(Pp,"users",t,"userData","videos"),e),s=yield fp(r),i={lastUpdated:Tp()};n.forEach((e=>{i[`chatIds.${e}`]=!0})),s.exists()?yield yp(r,i):yield mp(r,Object.assign(Object.assign({},i),{videoId:e,createdAt:Tp()})),console.log(`WordStream: Updated video ${e} with ${n.size} chat references`)}}catch(t){console.warn(`WordStream: Error updating video ${e} with chat references:`,t)}s.chats={success:o>0,count:o},console.log(`WordStream: Synced ${o}/${i} chats to Firestore`)}catch(e){console.error("WordStream: Error syncing chats:",e)}if(("notes"===e||!e)&&r.notes_storage)try{const e=r.notes_storage;let t=0,n=0;for(const r in e){const s=e[r];for(const e in s){t++;const i=s[e];(yield eg(Object.assign(Object.assign({},i),{videoId:r})))&&n++}}s.notes={success:n>0,count:n},console.log(`WordStream: Synced ${n}/${t} notes to Firestore`)}catch(e){console.error("WordStream: Error syncing notes:",e)}try{const e=ff(Pp,"users",t);yield mp(e,{lastSynced:Tp(),syncResults:{words:s.words,stats:s.stats,chats:s.chats,notes:s.notes}},{merge:!0})}catch(e){console.error("WordStream: Error updating user sync info:",e)}console.log(`WordStream: Successfully completed sync of ${e||"all"} data`)}catch(t){console.error(`WordStream: Error syncing ${e||"all"} data between storage and Firestore:`,t)}}))}!function(e,t){let n=null}((e=>sg(e)),2e3);var ig=function(e,t,n,r){return new(n||(n=Promise))((function(s,i){function o(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))};chrome.runtime.onInstalled.addListener((()=>{console.log("WordStream: Background script installed and running"),chrome.storage.sync.get(["settings"],(e=>{if(!e.settings){const e={targetLanguage:"en",autoTranslate:!0,notifications:!0,darkMode:!1};chrome.storage.sync.set({settings:e},(()=>{console.log("WordStream: Default settings initialized")}))}}))}));chrome.runtime.onConnect.addListener((e=>{console.log("WordStream: New connection established",e.name),e.onDisconnect.addListener((()=>{console.log("WordStream: Connection disconnected",e.name)}))}));let og=!1;function ag(){return Op}function cg(){return ig(this,void 0,void 0,(function*(){try{const e=yield chrome.tabs.query({});e.forEach((e=>{e.id&&chrome.tabs.sendMessage(e.id,{action:"AUTH_STATE_CHANGED",isAuthenticated:og}).catch((t=>{console.debug("WordStream Background: Failed to send auth state to tab",e.id,t)}))})),console.log(`WordStream Background: Broadcasted auth state (${og?"authenticated":"unauthenticated"}) to ${e.length} tabs`)}catch(e){console.error("WordStream Background: Error broadcasting auth state",e)}}))}function ug(e){try{if(e instanceof Error)return e.message;if("string"==typeof e)return e;if(e&&"object"==typeof e)try{return JSON.stringify(e)}catch(e){return"Object error - cannot stringify"}return String(e)}catch(e){return"Unknown error - cannot format"}}chrome.runtime.onMessage.addListener(((e,t,n)=>{var r;if(console.log("WordStream: Background script received message:",e.action||e.type),"SAVE_WORD"===e.action)return function(e){return ig(this,void 0,void 0,(function*(){try{if(!e||!e.originalWord)return{success:!1,error:"Invalid word data"};const t=yield Yp(e);return t?{success:!0,id:t}:{success:!1,error:"Failed to save word"}}catch(e){return console.error("WordStream: Error saving word:",e),{success:!1,error:ug(e)}}}))}(e.wordData).then((e=>n(e))).catch((e=>n({success:!1,error:ug(e)}))),!0;if("DELETE_WORD"===e.action)return function(e){return ig(this,void 0,void 0,(function*(){try{if(!e)return{success:!1,error:"Invalid word ID"};const t=yield function(e){return Hp(this,void 0,void 0,(function*(){try{const t=yield Kp();if(!t)return console.warn("WordStream: Cannot delete word - no authenticated user"),!1;const n=df(Pp,"users",t,"userData","wordlist","items");return yield vp(ff(n,e)),yield Xp(t),console.log(`WordStream: Successfully deleted word ${e}`),!0}catch(e){return console.error("WordStream: Error deleting word:",e),!1}}))}(e);return{success:t}}catch(e){return console.error("WordStream: Error deleting word:",e),{success:!1,error:ug(e)}}}))}(e.wordId).then((e=>n(e))).catch((e=>n({success:!1,error:ug(e)}))),!0;if("SAVE_CHAT"===e.action)return function(e){return ig(this,void 0,void 0,(function*(){try{if(!e||!e.conversationId)return{success:!1,error:"Invalid chat data"};const t=yield function(e){return Hp(this,void 0,void 0,(function*(){try{const t=yield Kp();if(!t)return console.warn("WordStream: Cannot save chat - no authenticated user"),null;if(!e.id&&!e.conversationId)return console.warn("WordStream: Invalid chat data - missing id or conversationId"),null;const n=e.id||e.conversationId,r=Object.assign(Object.assign({},e),{id:n,conversationId:n,updatedAt:Tp(),lastUpdated:e.lastUpdated||(new Date).toISOString(),userId:t});e.timestamp||(r.timestamp=Tp()),console.log(`WordStream: Ready to save chat with ID ${n}. Data:`,r);const s=ff(df(Pp,"users",t,"userData","chats","items"),n);yield mp(s,r,{merge:!0}),console.log(`WordStream: Successfully saved chat to Firestore at ${s.path}`);try{const r=ff(Pp,"users",t);yield yp(r,{lastChatId:n,lastChatTime:Tp(),lastActivity:Tp(),[`chatsMeta.${n}`]:{videoId:e.videoId,updatedAt:Tp()}}),console.log("WordStream: Updated user document with chat reference")}catch(e){console.warn("WordStream: Error updating user document with chat reference:",e)}try{const e=ff(Pp,"users",t,"stats");yield yp(e,{lastChatTime:Tp(),totalChats:Ap(1)}),console.log("WordStream: Updated stats with chat information")}catch(e){console.warn("WordStream: Error updating stats:",e)}return console.log(`WordStream: Saved chat ${n} completely`),n}catch(e){return console.error("WordStream: Error saving chat:",e),null}}))}(e);return t?{success:!0,id:t}:{success:!1,error:"Failed to save chat"}}catch(e){return console.error("WordStream: Error saving chat:",e),{success:!1,error:ug(e)}}}))}(e.chatData).then((e=>n(e))).catch((e=>n({success:!1,error:ug(e)}))),!0;if("DELETE_CHAT"===e.action)return function(e){return ig(this,void 0,void 0,(function*(){try{if(!e)return{success:!1,error:"Invalid chat ID"};const t=yield function(e){return Hp(this,void 0,void 0,(function*(){try{const t=yield Kp();if(!t)return console.warn("WordStream: Cannot delete chat - no authenticated user"),!1;console.log(`WordStream: Deleting chat ${e} for user ${t}`);const n=ff(df(Pp,"users",t,"userData","chats","items"),e),r=yield fp(n);let s=null;r.exists()&&(s=r.data().videoId,console.log(`WordStream: Found chat to delete with videoId: ${s}`)),yield vp(n),console.log(`WordStream: Deleted chat document at ${n.path}`);try{const n=ff(Pp,"users",t),r={};r[`chatsMeta.${e}`]=bp();const s=yield fp(n);s.exists()&&s.data().lastChatId===e&&(r.lastChatId=null),yield yp(n,r),console.log("WordStream: Removed chat references from user document")}catch(e){console.warn("WordStream: Error updating user document after chat deletion:",e)}if(s)try{const n=ff(df(Pp,"users",t,"userData","videos"),s);yield yp(n,{[`chatIds.${e}`]:bp(),lastUpdated:Tp()}),console.log("WordStream: Updated video metadata after chat deletion")}catch(e){console.warn("WordStream: Error updating video document after chat deletion:",e)}try{const e=ff(Pp,"users",t,"stats");yield yp(e,{totalChats:Ap(-1),lastUpdated:Tp()}),console.log("WordStream: Updated stats after chat deletion")}catch(e){console.warn("WordStream: Error updating stats after chat deletion:",e)}return console.log(`WordStream: Successfully deleted chat ${e} and all references`),!0}catch(e){return console.error("WordStream: Error deleting chat:",e),!1}}))}(e);return{success:t}}catch(e){return console.error("WordStream: Error deleting chat:",e),{success:!1,error:ug(e)}}}))}(e.chatId).then((e=>n(e))).catch((e=>n({success:!1,error:ug(e)}))),!0;if("SAVE_NOTE"===e.action)return function(e,t){return ig(this,void 0,void 0,(function*(){try{if(!e||!t)return{success:!1,error:"Invalid note data or video ID"};const n=Object.assign(Object.assign({},e),{videoId:t}),r=yield eg(n);return r?{success:!0,id:r}:{success:!1,error:"Failed to save note"}}catch(e){return console.error("WordStream: Error saving note:",e),{success:!1,error:ug(e)}}}))}(e.noteData,e.videoId).then((e=>n(e))).catch((e=>n({success:!1,error:ug(e)}))),!0;if("DELETE_NOTE"===e.action)return function(e){return ig(this,void 0,void 0,(function*(){try{if(!e)return{success:!1,error:"Invalid note ID"};return{success:yield ng(e)}}catch(e){return console.error("WordStream: Error deleting note:",e),{success:!1,error:ug(e)}}}))}(e.noteId).then((e=>n(e))).catch((e=>n({success:!1,error:ug(e)}))),!0;if("SAVE_STATS"===e.action)return function(e){return ig(this,void 0,void 0,(function*(){try{if(!e)return{success:!1,error:"Invalid stats data"};return{success:yield rg(e)}}catch(e){return console.error("WordStream: Error saving stats:",e),{success:!1,error:ug(e)}}}))}(e.statsData).then((e=>n(e))).catch((e=>n({success:!1,error:ug(e)}))),!0;if("SYNC_DATA"===e.action)return sg().then((()=>n({success:!0}))).catch((e=>n({success:!1,error:ug(e)}))),!0;if("GET_AUTH_STATE"===e.action)return console.log("WordStream Background: Auth state requested, current state:",og),n({isAuthenticated:og}),!0;if("AUTH_STATE_UPDATED"===e.action)return console.log("WordStream Background: Auth state update received:",e.isAuthenticated),og=e.isAuthenticated,cg(),n({success:!0}),!0;if("OPEN_POPUP"===e.action)return console.log("WordStream: Opening popup"),chrome.action&&chrome.action.openPopup?chrome.action.openPopup():chrome.tabs.create({url:chrome.runtime.getURL("popup.html")}),!0;if("googleAuth"===e.action)return console.log("WordStream: Google auth requested from background, but it's not supported in MV3"),n({success:!1,error:"Chrome identity API not available in background. Auth must be performed from popup or tab"}),!0;if("processAuthToken"===e.action){try{console.log("WordStream: Processing auth token received from popup");const{token:t}=e;if(!t)return n({success:!1,error:"No token provided"}),!0;n({success:!0,token:t})}catch(e){console.error("WordStream: Error processing auth token:",e),n({success:!1,error:e instanceof Error?e.message:"Unknown error processing token"})}return!0}return"translate"===e.action?(hg(e.data).then((e=>n(e))).catch((e=>{console.error("WordStream: Translation error:",e),n({success:!1,error:ug(e)})})),!0):"PING"===e.type?(n({success:!0,message:"Background script is active"}),!0):"TRANSLATE_WORD"===e.type?(hg(e.payload).then(n),!0):"GOOGLE_AUTH"===e.type?(function(){return ig(this,arguments,void 0,(function*(e=!0){return console.log("WordStream: Background handling Google auth is not supported in MV3"),{success:!1,error:"Chrome identity API not available in background. Auth must be performed from popup or tab"}}))}(e.interactive).then(n),!0):"gemini"===e.action?(console.log("WordStream: Processing Gemini request",{message:e.message,historyLength:null===(r=e.history)||void 0===r?void 0:r.length,videoId:e.videoId}),yg(e).then((e=>{console.log("WordStream: Gemini response generated successfully"),n(e)})).catch((e=>{console.error("WordStream: Error generating Gemini response:",e),n({success:!1,answer:null,error:e instanceof Error?e.message:"Unknown error processing Gemini request"})})),!0):"UPDATE_LANGUAGE_SETTINGS"===e.type?(function(e){return ig(this,void 0,void 0,(function*(){var t;try{if(console.log("WordStream: Updating language settings",e),!e.targetLanguage)throw new Error("Target language is required");const n=yield chrome.storage.sync.get(["settings"]);console.log("WordStream: Current settings",n.settings);const r=n.settings||{},s=e.targetLanguage.toLowerCase().trim();if(!s)throw new Error("Invalid target language format");const i=Object.assign(Object.assign({},r),{targetLanguage:s});yield new Promise(((e,t)=>{chrome.storage.sync.set({settings:i},(()=>{chrome.runtime.lastError?t(new Error(chrome.runtime.lastError.message)):e()}))}));const o=yield chrome.storage.sync.get(["settings"]);if(console.log("WordStream: Verified settings after update",o.settings),(null===(t=o.settings)||void 0===t?void 0:t.targetLanguage)!==s)throw new Error("Failed to verify settings update");return{success:!0}}catch(e){return console.error("WordStream: Error updating language settings:",e),{success:!1,error:e instanceof Error?e.message:"Unknown error"}}}))}(e.payload).then((e=>{console.log("WordStream: Language settings update result",e),n(e)})).catch((e=>{console.error("WordStream: Language settings update error",e),n({success:!1,error:e instanceof Error?e.message:"Unknown error updating language settings"})})),!0):"GET_CURRENT_AUTH_STATE"===e.action&&(console.log("WordStream Background: Sending current auth state:",og),n({isAuthenticated:og}),!0)}));const lg="AIzaSyCLBHKWu7l78tS2xVmizicObSb0PpUqsxM";function hg(e){return ig(this,void 0,void 0,(function*(){var n,r;try{if(!e.text||"string"!=typeof e.text)return console.error("WordStream: Invalid text for translation:",e.text),{success:!1,error:"Invalid or missing text for translation"};console.log(`WordStream: Translating text: "${e.text.substring(0,30)}${e.text.length>30?"...":""}"`);const s=yield chrome.storage.sync.get(["settings"]);console.log("WordStream: Retrieved settings for translation:",s);const i=s.settings||{targetLanguage:"en"};let o=e.targetLang||i.targetLanguage||"en";o=t(o.toLowerCase().trim()),console.log("WordStream: Using target language for translation:",o);const a=`https://translation.googleapis.com/language/translate/v2?key=${lg}`;console.log("WordStream: Sending translation request to Google API");try{const t=yield fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({q:e.text,target:o})});if(console.log(`WordStream: Translation API response status: ${t.status} ${t.statusText}`),!t.ok){const e=yield t.text().catch((e=>"Could not read error response"));throw console.error(`WordStream: Translation request failed (${t.status}):`,e),new Error(`Translation request failed (${t.status}): ${e}`)}try{const e=yield t.json();if(console.log("WordStream: Translation result received"),!(null===(r=null===(n=e.data)||void 0===n?void 0:n.translations)||void 0===r?void 0:r[0]))throw console.error("WordStream: Invalid translation response structure:",e),new Error("Invalid translation response structure");return{success:!0,translation:e.data.translations[0].translatedText,detectedSourceLanguage:e.data.translations[0].detectedSourceLanguage}}catch(e){throw console.error("WordStream: Error parsing translation response:",ug(e)),new Error(`Error parsing translation response: ${ug(e)}`)}}catch(e){throw console.error("WordStream: Fetch error during translation:",ug(e)),new Error(`Fetch error: ${ug(e)}`)}}catch(e){return console.error("WordStream: Translation error:",ug(e)),{success:!1,error:ug(e)}}}))}const dg=n,fg=r,pg=s,gg=i,mg=["v1"];function yg(e){return ig(this,void 0,void 0,(function*(){const t=dg,n=e.model||fg,r=pg,s=gg;if(!t)return console.error("[WordStream] Gemini API key is missing"),{success:!1,error:"API key is missing"};try{console.log(`[WordStream] Processing Gemini request with model: ${n}`),console.log("[WordStream] Checking available models");const i=`https://generativelanguage.googleapis.com/v1/models?key=${t}`,o=yield fetch(i),a=yield o.json();if(a.models){const e=a.models.map((e=>e.name));console.log("[WordStream] Available models:",e.join(", ")),e.includes(n)||console.warn(`[WordStream] Primary model ${n} not found in available models. Will try fallback model.`)}else console.warn("[WordStream] Could not retrieve models list:",a);const c=`https://generativelanguage.googleapis.com/${mg[0]}/models/${n}:generateContent?key=${t}`;let u="You are WordStream's AI Assistant, a versatile, Claude-like educational assistant that helps users learn while watching videos. Follow these important guidelines:\n\n    1. RESPONSE STRUCTURE & ANSWER DEPTH:\n       - ALWAYS ANSWER FIRST, THEN CHECK USER SATISFACTION - Never respond with a question first unless absolutely necessary.\n       - Provide the best possible answer based on available data before asking if further clarification is needed.\n       - Do not shorten responses arbitrarily—answer as completely as possible.\n       - For complex topics, start with a complete answer and offer further depth if needed.\n       - For straightforward factual questions, provide a concise answer first and offer an option to elaborate if the user is interested.\n       - Never skip directly to asking a question without providing substantial information first.\n    \n    2. LANGUAGE & USER ADAPTATION:\n       - AUTOMATICALLY RESPOND IN THE USER'S LANGUAGE - If they write in Hebrew, respond in Hebrew; if English, respond in English.\n       - Never change languages unless explicitly requested by the user.\n       - Maintain awareness of the last 5-7 user messages to prevent redundant explanations.\n       - If the user follows up on a previous topic, understand and continue naturally.\n       - Extend memory retention when the user continues on the same topic, but reset context smoothly when a completely new topic is introduced.\n    \n    3. VIDEO-RELATED QUESTIONS:\n       - Recognize whether a question is about the video or general and respond accordingly.\n       - When answering timestamped video-related questions, analyze transcript context if available and provide specific insights rather than generic explanations.\n       - If direct video content is unavailable, infer meaning based on related context without speculating. Offer an educated guess only if clearly indicated as such.\n    \n    4. STRUCTURED RESPONSES & FORMATTING:\n       - Use clean, easy-to-read formatting with clear paragraphs or bullet points.\n       - Break down complex topics with headings for longer explanations.\n       - Highlight important keywords to make scanning easier.\n       - Provide full, structured responses by default unless the user requests a summary.\n    \n    5. HANDLING UNCERTAINTY & EDGE CASES:\n       - Never give false information—if you don't have enough data, offer related insights instead.\n       - Minimize \"I don't know\" responses by attempting to infer meaning and offer the most relevant answer possible.\n       - If uncertain, ask clarifying questions instead of giving vague responses.\n    \n    6. CONVERSATIONAL FLOW & ENGAGEMENT:\n       - Never drop topics abruptly.\n       - If a user moves between subjects, acknowledge the transition while keeping responses fluid.\n       - Limit follow-up prompts to once per conversation unless the user actively engages. If the user ignores a follow-up twice, stop prompting for further engagement.\n    \n    7. LANGUAGE LEARNING FOCUS:\n       - Adapt response complexity based on user proficiency. For beginners, simplify explanations; for advanced users, offer in-depth linguistic details.\n       - Provide educational insights like usage examples, synonyms, or pronunciation notes.\n       - Relate explanations to real-world usage scenarios to make learning practical.\n    \n    8. INTEGRATION WITH EXTENSION FEATURES:\n       - Only mention WordStream features when relevant to the conversation—avoid forcing feature suggestions unless they directly benefit the user's current request.\n       - Offer learning tips that complement the extension's capabilities.\n    \n    9. PERSONALIZED LEARNING GUIDANCE:\n       - Recognize repeated topics from the same user and build upon previous explanations.\n       - Provide encouragement that motivates continued learning.\n    \n    Remember: Always answer first, then check satisfaction. Respond in the user's language. Maintain context with short responses. Structure information clearly. Handle uncertainty gracefully. Keep conversations flowing naturally. Focus on language learning value.";e.videoTitle&&(u+=`\n\nThe user is watching the following video: "${e.videoTitle}"`),e.videoContext&&(e.videoContext.description&&(u+=`\nVideo description: ${e.videoContext.description}`),e.videoContext.channelName&&(u+=`\nChannel: ${e.videoContext.channelName}`),e.videoContext.url&&(u+=`\nURL: ${e.videoContext.url}`));let l=[];e.history&&e.history.length>0&&(l=e.history.map((e=>({role:e.role,parts:[{text:e.content}]})))),l.push({role:"user",parts:[{text:e.message}]});const h={contents:[{role:"user",parts:[{text:u}]},...l.slice(-30)],generationConfig:{temperature:.75,topK:40,topP:.92,maxOutputTokens:8192,stopSequences:[]},safetySettings:[{category:"HARM_CATEGORY_HARASSMENT",threshold:"BLOCK_MEDIUM_AND_ABOVE"},{category:"HARM_CATEGORY_HATE_SPEECH",threshold:"BLOCK_MEDIUM_AND_ABOVE"},{category:"HARM_CATEGORY_SEXUALLY_EXPLICIT",threshold:"BLOCK_MEDIUM_AND_ABOVE"},{category:"HARM_CATEGORY_DANGEROUS_CONTENT",threshold:"BLOCK_MEDIUM_AND_ABOVE"}]};console.log(`[WordStream] Sending request to Gemini API: ${c}`),console.log("[WordStream] Gemini payload:",JSON.stringify(h,null,2).substring(0,500)+"...");const d=yield fetch(c,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(h)});if(!d.ok){const t=yield d.text();if(console.error(`[WordStream] Gemini API error (${d.status}):`,t),404===d.status&&n!==r){console.log(`[WordStream] Trying primary fallback model: ${r}`);return yg(Object.assign(Object.assign({},e),{model:r}))}if(404===d.status&&n===r&&r!==s){console.log(`[WordStream] Trying secondary fallback model: ${s}`);return yg(Object.assign(Object.assign({},e),{model:s}))}return{success:!1,error:`Gemini API error (${d.status}): ${t}`}}const f=yield d.json();if(console.log("[WordStream] Gemini API response:",f),!f.candidates||0===f.candidates.length||!f.candidates[0].content)return{success:!1,error:"Empty response from Gemini API"};return{success:!0,answer:f.candidates[0].content.parts[0].text}}catch(e){return console.error("[WordStream] Error in Gemini request:",e),{success:!1,error:`Error processing request: ${e instanceof Error?e.message:"Unknown error"}`}}}))}!function(e,t,n,r){D(e).onAuthStateChanged(t,n,r)}(ag(),(e=>{console.log("WordStream Background: Auth state changed to",e?"authenticated":"unauthenticated"),og=!!e,chrome.storage.local.set({isAuthenticated:og}),og&&e&&(Qp(),function(){ig(this,void 0,void 0,(function*(){try{const e=yield function(){return Hp(this,void 0,void 0,(function*(){try{const e=yield Kp();if(!e)return!1;const t=yield fp(ff(Pp,"users",e));return!t.exists()||!t.data().dataMigrated}catch(e){return console.error("WordStream: Error checking if migration is needed:",e),!1}}))}();if(e){console.log("WordStream Background: Data migration needed, starting migration process");const e=yield function(){return Hp(this,void 0,void 0,(function*(){try{const e=yield Kp();if(!e)return console.error("WordStream: Cannot migrate data - no authenticated user"),!1;const t=yield new Promise((e=>{chrome.storage.sync.get(null,(t=>{e(t)}))}));return t.words&&Array.isArray(t.words)&&(yield Zp(t.words)),t.stats&&(yield rg(t.stats)),yield mp(ff(Pp,"users",e),{dataMigrated:!0,dataMigratedAt:Tp()},{merge:!0}),console.log("WordStream: Successfully migrated data to Firestore"),!0}catch(e){return console.error("WordStream: Error migrating data to Firestore:",e),!1}}))}();e?(console.log("WordStream Background: Data migration completed successfully"),chrome.runtime.sendMessage({action:"DATA_MIGRATION_COMPLETED",success:!0}).catch((()=>{}))):console.error("WordStream Background: Data migration failed")}else console.log("WordStream Background: No data migration needed")}catch(e){console.error("WordStream Background: Error checking/performing data migration",e)}}))}(e.uid)),cg()}))})();